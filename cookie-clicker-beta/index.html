<!DOCTYPE html>
<html>
<head>
<!--<script type="text/javascript">
    window.cookieconsent_options = {"message":"Unsurprisingly, this website uses cookies for ads and traffic analysis.","dismiss":"Got it!","learnMore":"Learn more","link":"https://orteil.dashnet.org/cookieconsentpolicy.html","target":"_blank","theme":"https://orteil.dashnet.org/cookieconsent.css","domain":"dashnet.org"};
</script>-->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"></script>

<title>Cookie Clicker</title>
<!--
Code and graphics copyright Orteil, 2023
Feel free to alter this code to your liking, but please do not re-host it, do not profit from it and do not present it as your own.

-TODO :
	-milk toys
	-temple building
	-dungeons
	-gambling
	-better tooltips
	-better prestige
	-add canvas support
	-timer bars for golden cookie effects
	-set event listeners instead of onclick
	-more zebras
-->

<link rel="shortcut icon" href="img/favicon.ico" />
<link href='https://fonts.googleapis.com/css?family=Merriweather:900&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
<style>
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}table{border-collapse:collapse;border-spacing:0}html,body{width:100%;height:100%}body{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:-moz-none;-moz-user-select:none;-ms-user-select:none;user-select:none;color:#fff;background:#000 url(img/darkNoise.png);font-family:Tahoma,Arial,sans-serif;font-size:13px}small{font-size:80%}a,a:visited{text-decoration:underline;cursor:pointer;color:#ccc}a:hover{text-shadow:0px 0px 3px #fff;color:#fff}a:active{opacity:0.8;background:transparent}.inset{box-shadow:0px 0px 12px #000 inset}.title,.section{font-family:'Merriweather', Georgia,serif;font-size:28px;text-shadow:0px 0px 4px #000;color:#fff}.section{padding:16px;width:100%;text-align:center}.subsection{padding:8px 0px;font-size:14px}.subsection div.title{font-size:22px;padding:8px 16px;width:100%;border-bottom:1px solid #999;margin-bottom:8px}.update .title{color:#69c}.update.small .title{font-size:16px;opacity:0.8;color:#fff}.listing{padding:3px 16px;font-size:13px}.listing b{font-weight:bold;opacity:0.6}.listing small{font-size:11px;opacity:0.9}.listing label{font-size:12px;border-bottom:1px solid #fff;opacity:0.5;padding-left:16px;padding-bottom:2px;position:relative;left:-4px;top:-2px}.hidden{visibility:hidden}.listing:hover .hidden{visibility:visible}a.option,.info a{display:inline-block;border:1px solid #ccc;background:#000;margin:2px 4px 2px 0px;color:#ccc;font-size:12px;padding:4px 8px;text-decoration:none}a.option:hover,.info a:hover{border-color:#fff;color:#fff;text-shadow:none}a.option:active,.info a:active{background-color:#333}a.option.warning:hover{border-color:#f33;color:#f33}a.option.warning:active{background-color:#300}.info a{border-color:#666;background:#eee;color:#666;padding:2px 6px}.info a:hover{border-color:#000;background-color:#fff;color:#000}.info a:active{background-color:#999}.warning,a.option.warning{color:#c00;border-color:#c00}#backgroundLayers,#backgroundLayers div{width:100%;height:100%;position:absolute;left:0px;top:0px}#backgroundLayer1{background:url(img/bgBlue.jpg)}#backgroundLayer2{background:#000 url(img/darkNoise.png)}#topBar{position:absolute;left:0px;top:0px;width:100%;height:32px;background:url(img/darkNoise.png);box-shadow:0px -4px 8px #666 inset;color:#ccc}#topBar div{margin:6px 8px}#topBar a{color:#fff}#javascriptError{position:absolute;left:0px;top:0px;right:0px;bottom:0px;background:url(img/darkNoise.png);text-align:center;z-index:100000000000;line-height:150%;font-size:20px}#game{position:absolute;left:0px;top:32px;right:0px;bottom:0px;overflow:hidden}#sectionLeft{position:absolute;left:0px;top:0px;width:30%;bottom:0px;min-width:100px;overflow:hidden}#sectionMiddle{position:absolute;left:30%;padding-left:16px;margin-right:15px;top:0px;right:318px;bottom:0px;min-width:100px;overflow-x:hidden;overflow-y:scroll}#game.onMenu #sectionMiddle{background:#000 url(img/darkNoise.png)}#sectionRight{height:100%;position:absolute;top:0px;right:0px;overflow-x:hidden;overflow-y:scroll}#sectionLeft .blackGradient{background:url(img/blackGradient.png) repeat-x bottom;position:absolute;left:0px;right:0px;top:300px;height:640px}#sectionLeft .blackFiller{background:#000;position:absolute;left:0px;right:0px;top:940px;bottom:0px}#tooltipAnchor{position:absolute;z-index:1000000000;display:none}#tooltip{position:absolute;background:#000 url(img/darkNoise.png);padding:4px 8px;margin:4px;border:3px ridge #d2e248;border-color:#c7cd6e #a48836 #845a36 #a48836;border-radius:3px;box-shadow:0px 0px 1px 2px rgba(0,0,0,0.5),0px 2px 4px rgba(0,0,0,0.25),0px 0px 6px 1px rgba(0,0,0,0.5) inset;text-shadow:0px 1px 1px #000;color:#ccc}#tooltip b{color:#fff;font-weight:bold}#tooltip .name{font-weight:bold;font-size:110%;color:#fff;margin:2px 0px}.description{margin:4px 0px}#tooltip q{display:block;position:relative;text-align:right;margin-top:8px;font-style:italic;opacity:0.7}q:before{display:inline-block;content:"\""}q:after{display:inline-block;content:"\""}.price{font-weight:bold;color:#6f6;padding-left:18px;position:relative}.price.disabled,.disabled .price{color:#f66}.price:before{content:'';display:block;position:absolute;left:0px;top:2px;background:url(img/money.png);width:16px;height:16px}.price.plain{color:#fff;display:inline-block}.price.plain:before{top:0px}#cookieAnchor{position:absolute;left:50%;top:40%}#bigCookie{width:256px;height:256px;position:absolute;left:-128px;top:-128px;background:url(img/perfectCookie.png);background-size:256px 256px;cursor:pointer;z-index:10;-webkit-transition:opacity 0.1s ease-out,-webkit-transform 0.1s ease-out;-moz-transition:opacity 0.1s ease-out,-moz-transform 0.1s ease-out;-ms-transition:opacity 0.1s ease-out,-ms-transform 0.1s ease-out;-o-transition:opacity 0.1s ease-out,-o-transform 0.1s ease-out;transition:opacity 0.1s ease-out,transform 0.1s ease-out}.elderWrath #bigCookie{background:url(img/imperfectCookie.png);background-size:256px 256px}#bigCookie:hover{-webkit-transform:scale(1.05,1.05);opacity:0.9;-moz-transform:scale(1.05,1.05);opacity:0.9;-ms-transform:scale(1.05,1.05);opacity:0.9;-o-transform:scale(1.05,1.05);opacity:0.9;transform:scale(1.05,1.05);opacity:0.9}#bigCookie:active{-webkit-transform:scale(0.98,0.98);opacity:1;-moz-transform:scale(0.98,0.98);opacity:1;-ms-transform:scale(0.98,0.98);opacity:1;-o-transform:scale(0.98,0.98);opacity:1;transform:scale(0.98,0.98);opacity:1}#cookieShine{width:512px;height:512px;position:absolute;left:-256px;top:-256px;background:url(img/shine.png);background-size:100%;z-index:5;opacity:0.5}#cookieNumbers{position:absolute;top:-80px}.cookieNumber{position:absolute;pointer-events:none;left:-100px;top:0px;width:200px;z-index:100;text-align:center;text-shadow:none}#cookieCursors{position:absolute;z-index:5}.cursor{width:32px;height:32px;position:absolute;background:url(img/cursor.png)}.cookieParticle{width:64px;height:64px;margin-left:-32px;margin-top:-32px;position:absolute;background:url(img/smallCookies.png);opacity:0}#particles{position:absolute;left:0px;top:0px}.particle{position:absolute;pointer-events:none;left:-200px;bottom:0px;width:400px;z-index:100000000;text-align:center;text-shadow:0px 0px 6px #000;font-size:24px}#cookieShower{position:absolute;width:100%;height:100%;z-index:2}#milk{width:100%;height:0%;position:absolute;left:0px;bottom:0px;z-index:100;opacity:0.9}.milkLayer{width:100%;height:100%;position:absolute;left:0px;top:0px;background-repeat:repeat-x}#cookies{position:absolute;left:0px;top:15%;width:100%;text-align:center;z-index:200;background:#000;background:rgba(0,0,0,0.4);padding:2px 0px}.separatorLeft,.separatorRight{width:16px;height:100%;background:url(img/panelVertical.png) repeat-y;position:absolute;top:0px;bottom:0px;z-index:100}.separatorLeft{left:30%}.separatorRight{right:317px}.separatorBottom{width:100%;height:16px;background:url(img/panelHorizontal.png) repeat-x;position:absolute;left:0px;bottom:0px}.button{background:#000 url(img/darkNoise.png);box-shadow:0px 0px 3px #666 inset,0px 0px 4px #000;position:absolute;z-index:100;width:64px;height:24px;text-align:center;font-size:18px;cursor:pointer;-webkit-transition:left 0.1s ease-out,right 0.1s ease-out,box-shadow 0.1s ease-out;-moz-transition:left 0.1s ease-out,right 0.1s ease-out,box-shadow 0.1s ease-out;-ms-transition:left 0.1s ease-out,right 0.1s ease-out,box-shadow 0.1s ease-out;-o-transition:left 0.1s ease-out,right 0.1s ease-out,box-shadow 0.1s ease-out;transition:left 0.1s ease-out,right 0.1s ease-out,box-shadow 0.1s ease-out}.button:hover{box-shadow:0px 0px 12px #ccc inset,0px 0px 4px #000;z-index:1000}#prefsButton:hover,#statsButton:hover{left:-8px}#prefsButton,#statsButton{padding:14px 0px 10px 16px}#prefsButton{top:0px;left:-16px}#statsButton{bottom:16px;left:-16px}#logButton:hover{right:-8px}#logButton{padding:14px 16px 10px 0px}#logButton{bottom:16px;right:-16px}#game.onMenu #menu{display:block}#game.onMenu .row{display:none}#menu{display:none;z-index:1000000;position:absolute;left:16px;right:0px;top:112px;bottom:0px}#comments{padding:16px;text-align:center;position:relative;padding-bottom:32px;font-size:16px;height:64px;overflow:hidden}#commentsText{padding:0px 64px}#commentsText q{font-style:italic}#commentsText sig{font-size:70%;display:block;text-align:center;opacity:0.7}#commentsText sig:before{content:"-";padding-left:64px}.row{height:128px;position:relative;padding-bottom:32px;display:none;overflow:hidden}.row.enabled{display:block}.row .content{width:100%;height:128px;position:absolute;overflow-x:scroll;overflow-y:hidden;padding-bottom:16px}.row .background{background:#999;position:absolute;left:0px;top:0px;height:100%;z-index:1;min-width:100%}.row .backgroundLeft,.row .backgroundRight{width:128px;height:128px;position:absolute;top:0px}.row .backgroundLeft{left:0px}.row .backgroundRight{right:0px}.row .objects{position:absolute;z-index:10}.row .special{position:absolute;z-index:1000000;width:100%;top:0px;bottom:16px;background:#000 url(img/mapBG.jpg) fixed;display:none}.row .specialButton{display:none;position:absolute;top:0px;left:0px;width:128px;height:128px;z-index:200000}.row .specialButtonPic{display:block;width:100%;height:100%;background:transparent 0px 8px no-repeat}.row .specialButtonText{display:block;position:absolute;left:0px;bottom:16px;width:100%;text-align:center;text-shadow:0px 0px 4px #000;font-weight:bold;font-size:10px}a.control{position:absolute;width:48px;height:48px;background:url(img/control.png) no-repeat;opacity:0.8}a.control:hover{opacity:1}a.control.west{left:0px;top:48px;background-position:0px -48px}a.control.east{left:96px;top:48px;background-position:-96px -48px}a.control.north{left:48px;top:0px;background-position:-48px 0px}a.control.south{left:48px;top:96px;background-position:-48px -96px}a.control.middle{left:48px;top:48px;background-position:-48px -48px}.map{position:absolute;left:0px;top:0px;overflow:hidden;background:#00061b}.map:after{content:'';pointer-events:none;display:block;position:absolute;left:0px;top:0px;width:144px;height:144px;z-index:100000;background:url(img/dungeonOverlay.png)}.map .tile,.map .thing{width:16px;height:16px;position:absolute;left:0px;top:0px}.map .tile{background:url(img/dungeonTiles.png) no-repeat;z-index:100}.map .thing{background:url(img/dungeonIcons.png) no-repeat;z-index:200}.dungeonName{position:absolute;top:24px;left:-32px;width:256px;opacity:0.6}.dungeonLog{position:absolute;right:0px;top:0px;width:200px;height:100%;overflow-y:scroll;z-index:100}.dungeonLog div{font-size:10px;padding:3px 2px;opacity:0.6;text-shadow:0px 1px 0px #000}.dungeonLog div.new{opacity:1}.dungeonLog div b{font-weight:bold}.mobSlot{width:96px;height:100%;position:absolute;left:0px;bottom:0px}.mobPic{width:96px;height:96px;background:transparent center bottom no-repeat;position:absolute;left:0px;bottom:32px}.mobName{position:absolute;width:200%;left:-50%;bottom:16px;text-align:center;font-size:12px}.hpBar{position:absolute;width:100%;left:0px;top:0px;height:100%;background:url(img/hpBar.png) repeat-x;-webkit-transition:width 0.1s ease-out;-moz-transition:width 0.1s ease-out;-ms-transition:width 0.1s ease-out;-o-transition:width 0.1s ease-out;transition:width 0.1s ease-out}.hpmBar{position:absolute;width:70%;left:15%;bottom:4px;height:8px;background:url(img/hpmBar.png) repeat-x;box-shadow:0px 0px 4px #000}.map .thing .mapInfo{display:none;position:absolute;left:0px;top:0px;z-index:1000000;background:#000;padding:4px 8px}.map .thing:hover .mapInfo{display:block}.special .fighter{position:absolute;width:96px;height:96px}.row .info,#sectionLeft .info,.row .specialButton{-webkit-transition:opacity 0.1s ease-out;-moz-transition:opacity 0.1s ease-out;-ms-transition:opacity 0.1s ease-out;-o-transition:opacity 0.1s ease-out;transition:opacity 0.1s ease-out;opacity:0}.row .info,#sectionLeft .info{position:absolute;top:0px;left:0px;height:112px;padding:8px;font-size:12px;line-height:125%;background:url(img/infoBG.png);color:#666;z-index:100000}.row .info:after{width:16px;height:128px;position:absolute;right:-16px;top:0px;background:url(img/infoBGfade.png) repeat-y;display:block;content:''}#sectionLeft .info{border-radius:16px;padding:24px 8px 8px 24px;left:-16px;top:-16px;height:auto}.row:hover .info,#sectionLeft:hover .info,.row:hover .specialButton{opacity:1}.row .object{position:absolute;width:64px;height:64px}#sectionLeftInfo{position:absolute;left:0px;top:0px;width:100%}#storeTitle{text-align:center;padding:8px;width:284px}#upgrades{height:60px;width:300px;position:relative;overflow-y:hidden}#upgrades:hover{height:auto;min-height:60px}.crate{width:60px;height:60px;display:inline-block;cursor:pointer;opacity:0.6;position:relative;background:#000;float:left}.crate:before{content:'';position:absolute;left:0px;top:0px;width:60px;height:60px;display:block;background:url(img/upgradeFrame.png);z-index:10}.icon{width:48px;height:48px;display:inline-block;margin:0px 4px}.icon,.crate{background-image:url(img/icons.png?v=1)}.achievement{opacity:0.4}.crate.enabled{opacity:1}.crate:hover:before{box-shadow:0px 0px 6px #fff inset,0px 0px 1px #000;z-index:20}.crate:hover{background-color:#200e0a}.product{width:300px;height:64px;cursor:pointer;opacity:0.6;background:url(img/storeTile.jpg);position:relative}.product:nth-child(4n-3){background-position:0px 64px}.product:nth-child(4n-2){background-position:0px 128px}.product:nth-child(4n-1){background-position:0px 192px}.product:hover{box-shadow:0px 0px 16px #fff inset,0px 0px 1px #000;z-index:20}.product.enabled:active{box-shadow:0px 0px 16px #000 inset}.product.enabled{opacity:1}.product .icon{width:64px;height:64px;position:absolute;left:0px;top:0px;background-repeat:no-repeat}.product .content{display:inline-block;position:absolute;left:64px;top:6px;right:0px;bottom:6px;padding:4px;text-shadow:0px 0px 6px #000,0px 1px 1px #000}.product .content .owned{position:absolute;right:12px;top:6px;font-size:40px;opacity:0.2;color:#000;text-shadow:0px 0px 8px #fff}.goldenCookie{width:96px;height:96px;background:url(img/goldCookie.png);cursor:pointer;position:absolute;z-index:10000000000;display:none}#versionNumber{position:absolute;left:0px;bottom:0px;opacity:0.5;margin:8px;font-size:22px;z-index:100000000}#alert{display:none;position:fixed;bottom:-16px;left:-16px;z-index:100000000000;padding:8px 8px 24px 24px;font-size:14px;background:#990;border-radius:16px;color:#fff;box-shadow:0px 0px 4px #000}#support{width:280px;text-align:center;margin:16px auto}#supportComment{opacity:0.5;margin:8px}#donateBox{z-index:10000000;position:absolute;right:0px;top:240px;text-align:center;width:120px;display:none}#donateBox.on{display:block}.noFancy *{text-shadow:none !important;box-shadow:none !important}.noFancy .price{text-shadow:0px 0px 4px #000,0px 1px 0px #000 !important}
</style>

<script>
var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=Base64._utf8_encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64;}else if(isNaN(chr3)){enc4=64;}
output=output+
this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+
this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4);}
return output;},decode:function(input){var output="";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=this._keyStr.indexOf(input.charAt(i++));enc2=this._keyStr.indexOf(input.charAt(i++));enc3=this._keyStr.indexOf(input.charAt(i++));enc4=this._keyStr.indexOf(input.charAt(i++));chr1=(enc1<<2)|(enc2>>4);chr2=((enc2&15)<<4)|(enc3>>2);chr3=((enc3&3)<<6)|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2);}
if(enc4!=64){output=output+String.fromCharCode(chr3);}}
output=Base64._utf8_decode(output);return output;},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}
else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}
else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}}
return utftext;},_utf8_decode:function(utftext){var string="";var i=0;var c=c1=c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++;}
else if((c>191)&&(c<224)){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c&31)<<6)|(c2&63));i+=2;}
else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));i+=3;}}
return string;}}
</script>
<script>
function ajax(url,callback){
	var ajaxRequest;
	try{ajaxRequest = new XMLHttpRequest();} catch (e){try{ajaxRequest=new ActiveXObject('Msxml2.XMLHTTP');} catch (e) {try{ajaxRequest=new ActiveXObject('Microsoft.XMLHTTP');} catch (e){alert("Something broke!");return false;}}}
	if (callback){ajaxRequest.onreadystatechange=function(){if(ajaxRequest.readyState==4){callback(ajaxRequest.responseText);}}}
	ajaxRequest.open('GET',url+'&nocache='+(new Date().getTime()),true);ajaxRequest.send(null);
}
</script>
<script>
if(1==1||undefined==Math.seedrandom)
{(function(a,b,c,d,e,f){function k(a){var b,c=a.length,e=this,f=0,g=e.i=e.j=0,h=e.S=[];for(c||(a=[c++]);d>f;)h[f]=f++;for(f=0;d>f;f++)h[f]=h[g=j&g+a[f%c]+(b=h[f])],h[g]=b;(e.g=function(a){for(var b,c=0,f=e.i,g=e.j,h=e.S;a--;)b=h[f=j&f+1],c=c*d+h[j&(h[f]=h[g=j&g+b])+(h[g]=b)];return e.i=f,e.j=g,c})(d)}function l(a,b){var e,c=[],d=(typeof a)[0];if(b&&"o"==d)for(e in a)try{c.push(l(a[e],b-1))}catch(f){}return c.length?c:"s"==d?a:a+"\0"}function m(a,b){for(var d,c=a+"",e=0;c.length>e;)b[j&e]=j&(d^=19*b[j&e])+c.charCodeAt(e++);return o(b)}function n(c){try{return a.crypto.getRandomValues(c=new Uint8Array(d)),o(c)}catch(e){return[+new Date,a,a.navigator.plugins,a.screen,o(b)]}}function o(a){return String.fromCharCode.apply(0,a)}var g=c.pow(d,e),h=c.pow(2,f),i=2*h,j=d-1;c.seedrandom=function(a,f){var j=[],p=m(l(f?[a,o(b)]:0 in arguments?a:n(),3),j),q=new k(j);return m(o(q.S),b),c.random=function(){for(var a=q.g(e),b=g,c=0;h>a;)a=(a+c)*d,b*=d,c=q.g(1);for(;a>=i;)a/=2,b/=2,c>>>=1;return(a+c)/b},p},m(c.random(),b)})(this,[],Math,256,6,52);}
if(1==1||undefined==choose){function choose(arr){if(arr.length==0)return 0;else return arr[Math.floor(Math.random()*arr.length)];}}
var DungeonGen=function()
{var TILE_EMPTY=0;var TILE_LIMIT=-100;var TILE_FLOOR_EDGE=100;var TILE_FLOOR_CENTER=110;var TILE_DOOR=200;var TILE_PILLAR=300;var TILE_WATER=400;var TILE_WALL=500;var TILE_WALL_CORNER=510;var TILE_ENTRANCE=250;var TILE_EXIT=260;var colors=[];colors[TILE_EMPTY]='000';colors[TILE_LIMIT]='900';colors[TILE_FLOOR_EDGE]='ffc';colors[TILE_FLOOR_CENTER]='ff9';colors[TILE_DOOR]='f9f';colors[TILE_PILLAR]='990';colors[TILE_WATER]='99f';colors[TILE_WALL]='960';colors[TILE_WALL_CORNER]='630';colors[TILE_ENTRANCE]='f9f';colors[TILE_EXIT]='f9f';var rand=function(a,b){return Math.floor(Math.random()*(b-a+1)+a);}
var Patterns=[];this.Pattern=function(name,func)
{this.name=name;this.func=func;Patterns.push(this);}
new this.Pattern('Pillars',function(x,y,room)
{if((x+room.x)%2==0&&(y+room.y)%2==0&&Math.random()<0.8)return TILE_PILLAR;return 0;});new this.Pattern('Large pillars',function(x,y,room)
{if((x+room.x)%3<2&&(y+room.y)%3<2&&Math.random()<0.8)return TILE_PILLAR;return 0;});new this.Pattern('Sparse pillars',function(x,y,room)
{if((x+room.x)%3==0&&(y+room.y)%3==0&&Math.random()<0.8)return TILE_PILLAR;return 0;});new this.Pattern('Lines',function(x,y,room)
{if(room.x%2==0)if((x+room.x)%2==0&&Math.random()<0.98)return TILE_PILLAR;if(room.x%2==1)if((y+room.y)%2==0&&Math.random()<0.98)return TILE_PILLAR;return 0;});var getRandomPattern=function()
{return choose(Patterns);}
var defaultGenerator=function(me)
{me.roomSize=10;me.corridorSize=5;me.fillRatio=1/3;me.corridorRatio=0.2;me.pillarRatio=0.2;me.waterRatio=0;me.branching=4;me.sizeVariance=0.2;me.fillRatio=0.1+Math.random()*0.4;me.roomSize=Math.ceil(rand(5,15)*me.fillRatio*2);me.corridorSize=Math.ceil(rand(1,7)*me.fillRatio*2);me.corridorRatio=Math.random()*0.8+0.1;me.pillarRatio=Math.random()*0.5+0.5;me.waterRatio=Math.pow(Math.random(),2);me.branching=Math.floor(Math.random()*6);me.sizeVariance=Math.random();}
this.Map=function(w,h,seed,params)
{if(undefined!=seed)this.seed=seed;else{Math.seedrandom();this.seed=Math.random();}
Math.seedrandom(this.seed);this.seedState=Math.random;this.w=w||20;this.h=h||20;this.roomsAreHidden=0;this.rooms=[];this.freeWalls=[];this.freeTiles=[];this.doors=[];this.tiles=this.w*this.h;this.tilesDug=0;this.digs=0;this.stuck=0;this.data=[];for(var x=0;x<this.w;x++)
{this.data[x]=[];for(var y=0;y<this.h;y++)
{this.data[x][y]=[TILE_EMPTY,-1,0];if(x==0||y==0||x==this.w-1||y==this.h-1)this.data[x][y]=[TILE_LIMIT,-1,0];}}
defaultGenerator(this);if(params)
{for(var i in params)
{this[i]=params[i];}}
Math.seedrandom();}
this.Map.prototype.getType=function(x,y){return this.data[x][y][0];}
this.Map.prototype.getRoom=function(x,y){if(this.data[x][y][1]!=-1)return this.rooms[this.data[x][y][1]];else return-1;}
this.Map.prototype.getTile=function(x,y){return this.rooms[this.data[x][y][2]];}
this.Map.prototype.isWall=function(x,y)
{var n=0;for(var i in this.freeWalls){if(this.freeWalls[i][0]==x&&this.freeWalls[i][1]==y)return n;else n++;}
return-1;}
this.Map.prototype.isFloor=function(x,y)
{var n=0;for(var i in this.freeTiles){if(this.freeTiles[i][0]==x&&this.freeTiles[i][1]==y)return n;else n++;}
return-1;}
this.Map.prototype.removeFreeTile=function(x,y)
{this.freeTiles.splice(this.isFloor(x,y),1);}
this.Map.prototype.fill=function(what)
{var func=0;if(typeof(what)=='function')func=1;for(var x=0;x<this.w;x++){for(var y=0;y<this.h;y++){if(func)this.data[x][y]=[what(this,x,y),-1,0];else this.data[x][y]=[what,-1,0];}}
this.rooms=[];}
this.Map.prototype.fillZone=function(X,Y,W,H,what)
{for(var x=X;x<X+W;x++){for(var y=Y;y<Y+H;y++){this.data[x][y][0]=what;}}}
this.Map.prototype.getRoomTile=function(room,x,y)
{var n=0;for(var i in room.tiles){if(room.tiles[i].x==x&&room.tiles[i].y==y)return n;else n++;}
return-1;}
this.Map.prototype.getFloorTileInRoom=function(room)
{var tiles=[];for(var i in room.tiles){if(room.tiles[i].type==TILE_FLOOR_EDGE||room.tiles[i].type==TILE_FLOOR_CENTER)tiles.push(room.tiles[i]);}
return choose(tiles);}
this.Map.prototype.canPlaceRoom=function(rx,ry,rw,rh)
{if(rx<2||ry<2||rx+rw>=this.w-1||ry+rh>=this.h-1)return false;for(var x=rx;x<rx+rw;x++)
{for(var y=ry;y<ry+rh;y++)
{var tile=this.getType(x,y);var room=this.getRoom(x,y);if(tile==TILE_LIMIT)return false;if(room!=-1)return false;}}
return true;}
this.Map.prototype.setRoomTile=function(room,x,y,tile)
{var oldTile=this.getRoomTile(room,x,y);var oldTileType=oldTile!=-1?room.tiles[oldTile].type:-1;if(oldTile!=-1&&((tile==TILE_WALL||tile==TILE_WALL_CORNER)||(tile==TILE_FLOOR_EDGE&&oldTileType==TILE_FLOOR_CENTER))){return false;}
else
{if(oldTile!=-1)room.tiles.splice(oldTile,1);room.tiles.push({x:x,y:y,type:tile,score:0});if((tile==TILE_FLOOR_EDGE||tile==TILE_FLOOR_CENTER)&&(oldTileType!=TILE_FLOOR_EDGE&&oldTileType!=TILE_FLOOR_CENTER))room.freeTiles++;else if(tile!=TILE_FLOOR_EDGE&&tile!=TILE_FLOOR_CENTER&&(oldTileType==TILE_FLOOR_EDGE||oldTileType==TILE_FLOOR_CENTER))room.freeTiles--;return true;}}
this.Map.prototype.expandRoom=function(room,rx,ry,rw,rh)
{var x=0;var y=0;for(var x=rx;x<rx+rw;x++){for(var y=ry;y<ry+rh;y++){this.setRoomTile(room,x,y,TILE_FLOOR_EDGE);}}
for(var x=rx+1;x<rx+rw-1;x++){for(var y=ry+1;y<ry+rh-1;y++){this.setRoomTile(room,x,y,TILE_FLOOR_CENTER);}}
y=ry-1;for(var x=rx;x<rx+rw;x++){this.setRoomTile(room,x,y,TILE_WALL);}
y=ry+rh;for(var x=rx;x<rx+rw;x++){this.setRoomTile(room,x,y,TILE_WALL);}
x=rx-1;for(var y=ry;y<ry+rh;y++){this.setRoomTile(room,x,y,TILE_WALL);}
x=rx+rw;for(var y=ry;y<ry+rh;y++){this.setRoomTile(room,x,y,TILE_WALL);}
x=rx-1;y=ry-1;this.setRoomTile(room,x,y,TILE_WALL_CORNER);x=rx+rw;y=ry-1;this.setRoomTile(room,x,y,TILE_WALL_CORNER);x=rx-1;y=ry+rh;this.setRoomTile(room,x,y,TILE_WALL_CORNER);x=rx+rw;y=ry+rh;this.setRoomTile(room,x,y,TILE_WALL_CORNER);var water=Math.random()<this.waterRatio?1:0;var pattern=Math.random()<this.pillarRatio?getRandomPattern():0;for(var x=rx;x<rx+rw;x++){for(var y=ry;y<ry+rh;y++){if(room.tiles[this.getRoomTile(room,x,y)].type==TILE_FLOOR_CENTER)
{var tile=0;if(water!=0)tile=TILE_WATER;if(pattern!=0)
{tile=pattern.func(x,y,room)||tile;}
if(tile!=0)this.setRoomTile(room,x,y,tile);}}}}
this.Map.prototype.newRoom=function(x,y,w,h,parent)
{var room={};room.id=this.rooms.length;room.w=w;room.h=h;room.x=x||rand(1,this.w-room.w-1);room.y=y||rand(1,this.h-room.h-1);room.tiles=[];room.freeTiles=0;room.parent=parent?parent:-1;room.children=[];room.gen=0;room.door=0;room.corridor=Math.random()<this.corridorRatio?1:0;room.hidden=this.roomsAreHidden;return room;}
this.Map.prototype.planRoom=function(room)
{var branches=this.branching+1;var forcedExpansions=[];var w=room.w;var h=room.h;while(w>0&&h>0)
{if(w>0){forcedExpansions.push(1,3);w--;}
if(h>0){forcedExpansions.push(2,4);h--;}}
for(var i=0;i<branches;i++)
{var steps=0;var expansions=[];if(!room.corridor)
{expansions=[1,2,3,4];steps=this.roomSize;}
else
{expansions=choose([[1,3],[2,4]]);steps=this.corridorSize;}
steps=Math.max(room.w+room.h,Math.ceil(steps*(1-Math.random()*this.sizeVariance)));if(room.tiles.length==0){var rx=room.x;var ry=room.y;var rw=1;var rh=1;}
else{var randomTile=this.getFloorTileInRoom(room);var rx=randomTile.x;var ry=randomTile.y;var rw=1;var rh=1;}
for(var ii=0;ii<steps;ii++)
{if(expansions.length==0)break;var xd=0;var yd=0;var wd=0;var hd=0;var side=choose(expansions);if(forcedExpansions.length>0)side=forcedExpansions[0];if(side==1){xd=-1;wd=1;}
else if(side==2){yd=-1;hd=1;}
else if(side==3){wd=1;}
else if(side==4){hd=1;}
if(this.canPlaceRoom(rx+xd,ry+yd,rw+wd,rh+hd)){rx+=xd;ry+=yd;rw+=wd;rh+=hd;}else expansions.splice(expansions.indexOf(side),1);if(forcedExpansions.length>0)forcedExpansions.splice(0,1);}
if(rw>1||rh>1)
{this.expandRoom(room,rx,ry,rw,rh);}}}
this.Map.prototype.carve=function(room)
{for(var i in room.tiles)
{var thisTile=room.tiles[i];var x=thisTile.x;var y=thisTile.y;var myType=this.data[x][y][0];var type=thisTile.type;if((type==TILE_WALL||type==TILE_WALL_CORNER)&&this.isWall(x,y)!=-1){this.freeWalls.splice(this.isWall(x,y),1);}
if(this.data[x][y][1]!=-1&&(type==TILE_WALL||type==TILE_WALL_CORNER)){}
else
{if(this.data[x][y][1]==-1)this.tilesDug++;this.data[x][y]=[thisTile.type,room.id,0];if(x>1&&y>1&&x<this.w-2&&y<this.h-2&&type==TILE_WALL)this.freeWalls.push([x,y]);if(type==TILE_FLOOR_EDGE||type==TILE_FLOOR_CENTER)this.freeTiles.push([x,y]);}
var pos=[x,y];}
this.rooms[room.id]=room;}
this.Map.prototype.newRandomRoom=function(params)
{var success=1;params=params||{};var door=choose(this.freeWalls);if(!door){success=0;}
else
{var parentRoom=this.getRoom(door[0],door[1]);var sides=[];if(this.getType(door[0]-1,door[1])==TILE_EMPTY)sides.push([-1,0]);if(this.getType(door[0]+1,door[1])==TILE_EMPTY)sides.push([1,0]);if(this.getType(door[0],door[1]-1)==TILE_EMPTY)sides.push([0,-1]);if(this.getType(door[0],door[1]+1)==TILE_EMPTY)sides.push([0,1]);var side=choose(sides);if(!side){success=0;this.freeWalls.splice(this.isWall(door[0],door[1]),1);}
else
{var room=this.newRoom(door[0]+side[0],door[1]+side[1],0,0,parentRoom);for(var i in params)
{room[i]=params[i];}
this.planRoom(room);if(room.tiles.length>0&&room.freeTiles>0)
{this.carve(room);this.data[door[0]][door[1]][0]=TILE_DOOR;room.door=[door[0],door[1]];this.data[door[0]][door[1]][1]=room.id;this.freeWalls.splice(this.isWall(door[0],door[1]),1);this.doors.push([door[0],door[1],room]);if(this.isFloor(door[0]+side[0],door[1]+side[1])!=-1)this.removeFreeTile(door[0]+side[0],door[1]+side[1]);if(this.isFloor(door[0]-side[0],door[1]-side[1])!=-1)this.removeFreeTile(door[0]-side[0],door[1]-side[1]);room.parent=parentRoom;parentRoom.children.push(room);room.gen=parentRoom.gen+1;}
else
{this.freeWalls.splice(this.isWall(door[0],door[1]),1);success=0;}}}
if(success)return room;else return 0;}
this.Map.prototype.getRandomSpotInRoom=function(room)
{var listOfTiles=[];for(var i in room.tiles)
{if((room.tiles[i].type==TILE_FLOOR_EDGE||room.tiles[i].type==TILE_FLOOR_CENTER)&&this.isFloor(room.tiles[i].x,room.tiles[i].y)!=-1)
{listOfTiles.push(room.tiles[i]);}}
if(listOfTiles.length==0)return-1;return choose(listOfTiles);}
this.Map.prototype.getBestSpotInRoom=function(room)
{var highest=-1;var listOfHighest=[];for(var i in room.tiles)
{if((room.tiles[i].type==TILE_FLOOR_EDGE||room.tiles[i].type==TILE_FLOOR_CENTER)&&this.isFloor(room.tiles[i].x,room.tiles[i].y)!=-1)
{if(room.tiles[i].score>highest)
{listOfHighest=[];highest=room.tiles[i].score;listOfHighest.push(room.tiles[i]);}
else if(room.tiles[i].score==highest)
{listOfHighest.push(room.tiles[i]);}}}
if(listOfHighest.length==0)return-1;return choose(listOfHighest);}
this.Map.prototype.getEarliestRoom=function()
{return this.rooms[0];}
this.Map.prototype.getDeepestRoom=function()
{var deepest=0;var deepestRoom=this.rooms[0];for(var i in this.rooms)
{if((this.rooms[i].gen+Math.sqrt(this.rooms[i].freeTiles)*0.05)>=deepest&&this.rooms[i].corridor==0&&this.rooms[i].freeTiles>4){deepest=(this.rooms[i].gen+Math.sqrt(this.rooms[i].freeTiles)*0.05);deepestRoom=this.rooms[i];}}
return deepestRoom;}
this.Map.prototype.dig=function()
{Math.random=this.seedState;var badDig=0;if(this.digs==0)
{var w=rand(3,7);var h=rand(3,7);var room=this.newRoom(Math.floor(this.w/2-w/2),Math.floor(this.h/2-h/2),w,h);room.corridor=0;this.planRoom(room);this.carve(room);}
else
{if(this.newRandomRoom()==0)badDig++;}
if(badDig>0)this.stuck++;this.digs++;var finished=0;if(this.tilesDug>=this.tiles*this.fillRatio)finished=1;if(this.stuck>100)finished=1;if(finished==1)
{for(var i=0;i<10;i++)
{var newRoom=this.newRandomRoom({corridor:0,w:rand(3,7),h:rand(3,7)});if(newRoom!=0&&newRoom.freeTiles>15)break;}}
Math.seedrandom();if(finished==1)return 1;else if(badDig>0)return-1;else return 0;}
this.Map.prototype.finish=function()
{for(var i in this.rooms)
{var pillars=Math.random()<this.pillarRatio;for(var ii in this.rooms[i].tiles)
{var x=this.rooms[i].tiles[ii].x;var y=this.rooms[i].tiles[ii].y;var me=this.data[x][y][0];var x1=this.data[x-1][y][0];var x2=this.data[x+1][y][0];var y1=this.data[x][y-1][0];var y2=this.data[x][y+1][0];var xy1=this.data[x-1][y-1][0];var xy2=this.data[x+1][y-1][0];var xy3=this.data[x-1][y+1][0];var xy4=this.data[x+1][y+1][0];var walls=0;if((x1==TILE_WALL||x1==TILE_WALL_CORNER))walls++;if((y1==TILE_WALL||y1==TILE_WALL_CORNER))walls++;if((x2==TILE_WALL||x2==TILE_WALL_CORNER))walls++;if((y2==TILE_WALL||y2==TILE_WALL_CORNER))walls++;if((xy1==TILE_WALL||xy1==TILE_WALL_CORNER))walls++;if((xy2==TILE_WALL||xy2==TILE_WALL_CORNER))walls++;if((xy3==TILE_WALL||xy3==TILE_WALL_CORNER))walls++;if((xy4==TILE_WALL||xy4==TILE_WALL_CORNER))walls++;var floors=0;if((x1==TILE_FLOOR_CENTER||x1==TILE_FLOOR_EDGE))floors++;if((y1==TILE_FLOOR_CENTER||y1==TILE_FLOOR_EDGE))floors++;if((x2==TILE_FLOOR_CENTER||x2==TILE_FLOOR_EDGE))floors++;if((y2==TILE_FLOOR_CENTER||y2==TILE_FLOOR_EDGE))floors++;if((xy1==TILE_FLOOR_CENTER||xy1==TILE_FLOOR_EDGE))floors++;if((xy2==TILE_FLOOR_CENTER||xy2==TILE_FLOOR_EDGE))floors++;if((xy3==TILE_FLOOR_CENTER||xy3==TILE_FLOOR_EDGE))floors++;if((xy4==TILE_FLOOR_CENTER||xy4==TILE_FLOOR_EDGE))floors++;var complete=0;if(walls+floors==8)complete=1;var angle=0;if(complete)
{var top=0;var left=0;var right=0;var bottom=0;if((xy1==TILE_WALL||xy1==TILE_WALL_CORNER)&&(y1==TILE_WALL||y1==TILE_WALL_CORNER)&&(xy2==TILE_WALL||xy2==TILE_WALL_CORNER))top=1;else if((xy1==TILE_FLOOR_CENTER||xy1==TILE_FLOOR_EDGE)&&(y1==TILE_FLOOR_CENTER||y1==TILE_FLOOR_EDGE)&&(xy2==TILE_FLOOR_CENTER||xy2==TILE_FLOOR_EDGE))top=-1;if((xy2==TILE_WALL||xy2==TILE_WALL_CORNER)&&(x2==TILE_WALL||x2==TILE_WALL_CORNER)&&(xy4==TILE_WALL||xy4==TILE_WALL_CORNER))right=1;else if((xy2==TILE_FLOOR_CENTER||xy2==TILE_FLOOR_EDGE)&&(x2==TILE_FLOOR_CENTER||x2==TILE_FLOOR_EDGE)&&(xy4==TILE_FLOOR_CENTER||xy4==TILE_FLOOR_EDGE))right=-1;if((xy1==TILE_WALL||xy1==TILE_WALL_CORNER)&&(x1==TILE_WALL||x1==TILE_WALL_CORNER)&&(xy3==TILE_WALL||xy3==TILE_WALL_CORNER))left=1;else if((xy1==TILE_FLOOR_CENTER||xy1==TILE_FLOOR_EDGE)&&(x1==TILE_FLOOR_CENTER||x1==TILE_FLOOR_EDGE)&&(xy3==TILE_FLOOR_CENTER||xy3==TILE_FLOOR_EDGE))left=-1;if((xy3==TILE_WALL||xy3==TILE_WALL_CORNER)&&(y2==TILE_WALL||y2==TILE_WALL_CORNER)&&(xy4==TILE_WALL||xy4==TILE_WALL_CORNER))bottom=1;else if((xy3==TILE_FLOOR_CENTER||xy3==TILE_FLOOR_EDGE)&&(y2==TILE_FLOOR_CENTER||y2==TILE_FLOOR_EDGE)&&(xy4==TILE_FLOOR_CENTER||xy4==TILE_FLOOR_EDGE))bottom=-1;if((top==1&&bottom==-1)||(top==-1&&bottom==1)||(left==1&&right==-1)||(left==-1&&right==1))angle=1;}
if(pillars&&Math.random()<0.8&&this.rooms[i].freeTiles>4)
{if((angle==1||(complete&&walls==7))&&me==TILE_FLOOR_EDGE&&x1!=TILE_DOOR&&x2!=TILE_DOOR&&y1!=TILE_DOOR&&y2!=TILE_DOOR)
{this.data[x][y][0]=TILE_PILLAR;me=TILE_PILLAR;this.removeFreeTile(x,y);this.rooms[i].freeTiles--;}}
if(top==1||bottom==1||left==1||right==1)
{this.rooms[i].tiles[ii].score+=2;}
if(walls>5||floors>5)
{this.rooms[i].tiles[ii].score+=1;}
if(walls==7||floors==8)
{this.rooms[i].tiles[ii].score+=5;}
if((me!=TILE_FLOOR_CENTER&&me!=TILE_FLOOR_EDGE)||x1==TILE_DOOR||x2==TILE_DOOR||y1==TILE_DOOR||y2==TILE_DOOR)this.rooms[i].tiles[ii].score=-1;}}
var entrance=this.getBestSpotInRoom(this.getEarliestRoom());this.data[entrance.x][entrance.y][0]=TILE_ENTRANCE;this.entrance=[entrance.x,entrance.y];entrance.score=0;this.removeFreeTile(entrance.x,entrance.y);var exit=this.getBestSpotInRoom(this.getDeepestRoom());this.data[exit.x][exit.y][0]=TILE_EXIT;this.exit=[exit.x,exit.y];this.removeFreeTile(exit.x,exit.y);exit.score=0;}
this.Map.prototype.isObstacle=function(x,y)
{var free=[TILE_FLOOR_EDGE,TILE_FLOOR_CENTER,TILE_DOOR,TILE_ENTRANCE,TILE_EXIT];for(var i in free)
{if(this.data[x][y][0]==free[i])return 0;}
return 1;}
var joinTile=function(map,x,y,joinWith)
{var p=1;var me=map.data[x][y][0];var x1=map.data[x-1][y][0];var x2=map.data[x+1][y][0];var y1=map.data[x][y-1][0];var y2=map.data[x][y+1][0];joinWith.push(me);var joinsX=0;for(var i in joinWith)
{if(x1==joinWith[i])joinsX++;if(x2==joinWith[i])joinsX++;}
var joinsY=0;for(var i in joinWith)
{if(y1==joinWith[i])joinsY++;if(y2==joinWith[i])joinsY++;}
if(joinsX==2&&joinsY==2)p=1;else if(joinsX==2)p=2;else if(joinsY==2)p=3;return p;}
this.Map.prototype.getPic=function(x,y)
{if(Tiles[this.data[x][y][2]])
{if(Tiles[this.data[x][y][2]].joinType=='join')
{var thisPic=Tiles[this.data[x][y][2]].pic;thisPic=[thisPic[0],thisPic[1]];var joinWith=[];if(this.data[x][y][0]==TILE_WALL)joinWith.push(TILE_WALL_CORNER);else if(this.data[x][y][0]==TILE_DOOR)joinWith.push(TILE_WALL,TILE_WALL_CORNER);thisPic[0]+=joinTile(this,x,y,joinWith)-1;return thisPic;}
else if(Tiles[this.data[x][y][2]].joinType=='random3')
{var thisPic=Tiles[this.data[x][y][2]].pic;thisPic=[thisPic[0],thisPic[1]];thisPic[0]+=Math.floor(Math.random()*3);return thisPic;}
return Tiles[this.data[x][y][2]].pic;}
return[0,0];}
var Tiles=[];var TilesByName=[];this.Tile=function(name,pic,joinType)
{this.name=name;this.pic=pic;this.joinType=joinType||'none';this.id=Tiles.length;Tiles[this.id]=this;TilesByName[this.name]=this;}
new this.Tile('void',[0,0]);this.loadTiles=function(tiles)
{for(var i in tiles)
{var name=tiles[i][0];var pic=tiles[i][1];var joinType=tiles[i][2];new this.Tile(name,pic,joinType);}}
var computeTile=function(tile,tiles,value,name)
{if(tile==value&&tiles[name])return TilesByName[tiles[name]];return 0;}
this.Map.prototype.assignTiles=function(room,tiles)
{for(var i in room.tiles)
{var type=Tiles[0];var me=room.tiles[i];var tile=this.data[me.x][me.y][0];type=computeTile(tile,tiles,TILE_WALL_CORNER,'wall corner')||type;type=computeTile(tile,tiles,TILE_WALL,'wall')||type;type=computeTile(tile,tiles,TILE_FLOOR_EDGE,'floor edges')||type;type=computeTile(tile,tiles,TILE_FLOOR_CENTER,'floor')||type;type=computeTile(tile,tiles,TILE_PILLAR,'pillar')||type;type=computeTile(tile,tiles,TILE_DOOR,'door')||type;type=computeTile(tile,tiles,TILE_WATER,'water')||type;type=computeTile(tile,tiles,TILE_ENTRANCE,'entrance')||type;type=computeTile(tile,tiles,TILE_EXIT,'exit')||type;this.data[me.x][me.y][2]=type.id;}}
this.Map.prototype.draw=function(size)
{var str='';var size=size||10;for(var y=0;y<this.h;y++){for(var x=0;x<this.w;x++){var text='';if(this.isFloor(x,y)!=-1)text='o';if(this.isWall(x,y)!=-1)text+='x';var room=this.getRoom(x,y);var opacity=Math.max(0.1,1-(this.getRoom(x,y).gen/10));var title=room.freeTiles;text='';str+='<div style="opacity:'+opacity+';width:'+size+'px;height:'+size+'px;position:absolute;left:'+(x*size)+'px;top:'+(y*size)+'px;display:block;padding:0px;margin:0px;background:#'+colors[this.data[x][y][0]]+';color:#999;" title="'+title+'">'+text+'</div>';}
str+='<br>';}
str='<div style="position:relative;width:'+(this.w*size)+'px;height:'+(this.h*size)+'px;background:#000;font-family:Courier;font-size:'+size+'px;float:left;margin:10px;">'+str+'</div>';return str;}
this.Map.prototype.drawDetailed=function()
{var str='';var size=16;for(var y=0;y<this.h;y++){for(var x=0;x<this.w;x++){var room=this.getRoom(x,y);var opacity=1;var title='void';if(room!=-1)
{opacity=Math.max(0.1,1-room.gen/5);if(this.data[x][y][0]==TILE_ENTRANCE||this.data[x][y][0]==TILE_EXIT)opacity=1;title=(room.corridor?'corridor':'room')+' '+room.id+' | depth : '+room.gen+' | children : '+room.children.length;}
var pic=this.getPic(x,y);str+='<div style="opacity:'+opacity+';width:'+size+'px;height:'+size+'px;position:absolute;left:'+(x*size)+'px;top:'+(y*size)+'px;display:block;padding:0px;margin:0px;background:#'+colors[this.data[x][y][0]]+' url(img/dungeonTiles.png) '+(-pic[0]*16)+'px '+(-pic[1]*16)+'px;color:#999;" title="'+title+'"></div>';}
str+='<br>';}
str='<div style="box-shadow:0px 0px 12px 6px #00061b;position:relative;width:'+(this.w*size)+'px;height:'+(this.h*size)+'px;background:#00061b;font-family:Courier;font-size:'+size+'px;float:left;margin:10px;">'+str+'</div>';return str;}
this.Map.prototype.getStr=function()
{var str='';var size=16;for(var y=0;y<this.h;y++){for(var x=0;x<this.w;x++){var room=this.getRoom(x,y);var opacity=1;var title='void';var pic=this.getPic(x,y);if(room!=-1)
{if(room.hidden)pic=[0,0];title=(room.corridor?'corridor':'room')+' '+room.id+' | depth : '+room.gen+' | children : '+room.children.length;}
str+='<div style="opacity:'+opacity+';width:'+size+'px;height:'+size+'px;position:absolute;left:'+(x*size)+'px;top:'+(y*size)+'px;display:block;padding:0px;margin:0px;background:#'+colors[this.data[x][y][0]]+' url(img/dungeonTiles.png) '+(-pic[0]*16)+'px '+(-pic[1]*16)+'px;color:#999;" title="'+title+'"></div>';}
str+='<br>';}
return str;}}
</script>
<script>
var LaunchDungeons=function()
{Game.GetWord=function(type)
{if(type=='secret')return choose(['hidden','secret','mysterious','forgotten','forbidden','lost','sunk','buried','concealed','shrouded','invisible','elder']);if(type=='ruined')return choose(['ancient','old','ruined','ravaged','destroyed','collapsed','demolished','burnt','torn-down','shattered','dilapidated','abandoned','crumbling','derelict','decaying']);if(type=='magical')return choose(['arcane','magical','mystical','sacred','honed','banished','unholy','holy','demonic','enchanted','necromantic','bewitched','haunted','occult','astral']);return'';}
Game.DungeonTypes=[];Game.DungeonType=function(name)
{this.name=name;this.nameGenerator=function(){return'Mysterious dungeon';};this.roomTypes=[];Game.DungeonTypes[this.name]=this;return this;};new Game.DungeonType('Factory').nameGenerator=function(){var str='';str+=Game.GetWord(choose(['secret','ruined','magical']))+' '+choose(['factory','factories','bakery','bakeries','confectionery','laboratory','research center','chocolate forge','chocolate foundry','manufactory','warehouse','machinery','works','bakeworks','workshop','assembly line']);return str;};new Game.DungeonType('Mine').nameGenerator=function(){var str='';str+=Game.GetWord(choose(['secret','ruined','magical']))+' '+choose(['chocolate','chocolate','chocolate','white chocolate','sugar','cacao'])+' '+choose(['mine','mines','pit','pits','quarry','excavation','tunnel','shaft','lode','trench','mountain','vein','cliff','peak','dome','crater','abyss','chasm','hole','burrow']);return str;};new Game.DungeonType('Portal').nameGenerator=function(){var str='';str+=Game.GetWord(choose(['secret','ruined','magical']))+' '+choose(['portal','gate','dimension','warpgate','door']);return str;};new Game.DungeonType('Secret zebra level').nameGenerator=function(){var str='';str+=Game.GetWord(choose(['secret']))+' '+choose(['zebra level']);return str;};var D=new DungeonGen();D.loadTiles([['wall',[1,0],'join'],['wall corner',[1,0]],['floor',[1,1],'random3'],['tiled floor',[1,2],'join'],['round pillar',[1,4]],['square pillar',[2,4]],['potted plant',[3,4]],['bookshelf',[4,5],'join'],['door',[1,3],'join'],['alt wall',[4,0],'join'],['alt wall corner',[4,0]],['alt floor',[4,1],'random3'],['alt tiled floor',[4,2],'join'],['alt round pillar',[4,4]],['alt square pillar',[5,4]],['alt potted plant',[6,4]],['alt bookshelf',[4,6],'join'],['alt door',[4,3],'join'],['water',[1,5]],['green water',[2,5]],['dark water',[3,5]],['wooden wall',[1,7],'join'],['wooden floor',[1,6],'random3'],['conveyor belt',[4,7],'join'],['entrance',[0,1]],['alt entrance',[0,3]],['exit',[0,2]],['alt exit',[0,4]]]);Game.monsterIconY=10;Game.Monsters=[];Game.Monster=function(name,pic,icon,level,stats,loot)
{this.name=name;this.pic=pic;this.icon=icon;this.level=level;this.stats={};for(var i in stats)
{this.stats[i]=stats[i];}
this.stats.hpm=this.stats.hp;this.stats.rarity=stats.rarity||1;this.loot=loot||{};this.boss=0;this.quotes={};Game.Monsters[this.name]=this;}
var basicLoot={cookies:{min:1,max:5,prob:0.5}};var goodLoot={cookies:{min:3,max:8,prob:1},gear:{prob:0.05}};var bossLoot={gear:{prob:1}};var chestLoot={cookies:{min:2,max:20,prob:1},gear:{prob:0.1}};var bossLoot={cookies:{min:10,max:50,prob:1},gear:{prob:0.2}};new Game.Monster('Doughling','doughling',[0,0],1,{hp:5,might:2,guard:2,speed:6,dodge:6,rarity:0.7},basicLoot);new Game.Monster('Elder doughling','elderDoughling',[1,0],7,{hp:20,might:7,guard:7,speed:4,dodge:4,rarity:0.7},goodLoot);new Game.Monster('Angry sentient cookie','angrySentientCookie',[5,0],5,{hp:16,might:8,guard:4,speed:5,dodge:5,rarity:1},basicLoot);new Game.Monster('Baby sentient cookie','babySentientCookie',[4,0],1,{hp:3,might:1,guard:1,speed:7,dodge:7,rarity:1},basicLoot);new Game.Monster('Burnt sentient cookie','burntSentientCookie',[6,0],5,{hp:16,might:12,guard:2,speed:3,dodge:2,rarity:0.2},basicLoot);new Game.Monster('Raw sentient cookie','rawSentientCookie',[5,0],5,{hp:16,might:6,guard:4,speed:7,dodge:7,rarity:0.2},basicLoot);new Game.Monster('Sugar bunny','sugarBunny',[8,0],5,{hp:10,might:3,guard:8,speed:12,dodge:9,rarity:0.001},{cookies:{min:1000,max:10000}});Game.Monsters['Sugar bunny'].onKill=function(){Game.Win('Follow the white rabbit');};Game.Monsters['Sugar bunny'].AI='flee';new Game.Monster('Crazed kneader','crazedKneader',[0,2],6,{hp:18,might:6,guard:8,speed:3,dodge:2,rarity:0.5},goodLoot);new Game.Monster('Crazed chip-spurter','crazedDoughSpurter',[0,2],6,{hp:15,might:6,guard:8,speed:5,dodge:3,rarity:0.5},goodLoot);new Game.Monster('Alarm bot','alarmTurret',[3,2],2,{hp:6,might:3,guard:5,speed:8,dodge:8,rarity:0.5},basicLoot);new Game.Monster('Chirpy','chirpy',[4,2],3,{hp:7,might:4,guard:6,speed:9,dodge:9,rarity:0.01},{cookies:{min:500,max:5000}});Game.Monsters['Chirpy'].onKill=function(){Game.Win('Chirped out');};Game.Monsters['Chirpy'].quotes={fight:'oh, hello <3'};new Game.Monster('Disgruntled worker','disgruntledWorker',[1,2],4,{hp:14,might:5,guard:5,speed:6,dodge:4,rarity:0.6},basicLoot);new Game.Monster('Disgruntled overseer','disgruntledOverseer',[1,2],7,{hp:22,might:7,guard:5,speed:6,dodge:4,rarity:0.5},basicLoot);new Game.Monster('Disgruntled cleaning lady','disgruntledCleaningLady',[2,2],4,{hp:13,might:4,guard:5,speed:7,dodge:6,rarity:0.3},basicLoot);new Game.Monster('Sentient Furnace','sentientFurnace',[0,3],0,{hp:60,might:14,guard:12,speed:4,dodge:0,rarity:1},bossLoot);Game.Monsters['Sentient Furnace'].onKill=function(){Game.Win('Getting even with the oven');};Game.Monsters['Sentient Furnace'].AI='static';Game.Monsters['Sentient Furnace'].boss=1;Game.Monsters['Sentient Furnace'].quotes={fight:'YOU ARE NOT READY!',defeat:'OH... BURN.'};new Game.Monster('Ascended Baking Pod','ascendedBakingPod',[1,3],0,{hp:60,might:12,guard:14,speed:4,dodge:0,rarity:0.7},bossLoot);Game.Monsters['Ascended Baking Pod'].onKill=function(){Game.Win('Now this is pod-smashing');};Game.Monsters['Ascended Baking Pod'].AI='static';Game.Monsters['Ascended Baking Pod'].boss=1;Game.Monsters['Ascended Baking Pod'].quotes={fight:'rrrrrrrise.',defeat:'blrglblg.'};Game.BossMonsters=[];for(var i in Game.Monsters)
{if(Game.Monsters[i].boss)Game.BossMonsters.push(Game.Monsters[i]);}
Game.Entity=function(type,subtype,dungeon,pic,stats)
{this.type=type;this.subtype=subtype||'';this.dungeon=dungeon;this.pic=pic||[0,0];this.stats={};for(var i in stats)
{this.stats[i]=stats[i];}
this.x=-1;this.y=-1;this.obstacle=0;this.zIndex=1;if(this.type=='monster')
{this.obstacle=1;this.pic=[Game.Monsters[this.subtype].icon[0],Game.Monsters[this.subtype].icon[1]];this.pic[1]+=Game.monsterIconY;this.targets=[];this.stuck=0;this.zIndex=10;this.fighting=0;this.AI=Game.Monsters[this.subtype].AI||'normal';this.onKill=Game.Monsters[this.subtype].onKill||function(){};for(var i in Game.Monsters[this.subtype].stats){this.stats[i]=Game.Monsters[this.subtype].stats[i];}}
else if(this.type=='hero')
{this.obstacle=1;this.pic=[Game.Heroes[this.subtype].icon[0],Game.Heroes[this.subtype].icon[1]];this.targets=[];this.stuck=0;this.zIndex=100;this.fighting=0;for(var i in Game.Heroes[this.subtype].stats){this.stats[i]=Game.Heroes[this.subtype].stats[i];}
var mult=Math.max(0,(Game.Objects[this.dungeon.type].amount/20-1));this.stats.hpm+=Math.ceil(mult*2);this.stats.hp=this.stats.hpm;this.stats.might+=mult;this.stats.guard+=mult;this.stats.speed+=mult;this.stats.dodge+=mult;}
else if(this.type=='item')
{this.zIndex=5;this.value=0;}
else if(this.type=='destructible')
{this.obstacle=1;this.life=3;this.zIndex=15;if(this.subtype=='door')this.pic=[0,7];else this.pic=[Math.floor(Math.random()*4+2),7];this.onKill=function()
{if(this.subtype=='random')
{var value=Math.round(Math.pow(Math.random(),6)*(10+this.dungeon.level));if(value>0)
{var entity=this.dungeon.AddEntity('item','cookies',this.x,this.y);entity.value=value;}}}}
else if(this.type=='special')
{this.zIndex=5;this.value='';this.obstacle=1;}
this.Say=function(what)
{if(this.type=='monster')
{if(Game.Monsters[this.subtype].quotes[what])this.dungeon.Log(this.subtype+' : "<span style="color:#f96;">'+choose(Game.Monsters[this.subtype].quotes[what].split('|'))+'</span>"');}}
this.Draw=function()
{var name='?';if(this.subtype=='random')name='clutter';else name=this.subtype;if(this.type=='item'&&this.subtype=='cookies'&&this.value>0)
{if(this.value<2)this.pic=[0,5];else if(this.value<3)this.pic=[1,5];else if(this.value<4)this.pic=[2,5];else if(this.value<6)this.pic=[3,5];else if(this.value<10)this.pic=[4,5];else if(this.value<20)this.pic=[5,5];else if(this.value<30)this.pic=[7,5];else if(this.value<70)this.pic=[6,5];else if(this.value<200)this.pic=[8,5];else this.pic=[6,6];}
else if(this.type=='special'&&this.subtype=='upgrade')
{if(this.value!='')this.pic=[7,6];else this.pic=[8,6];}
return'<div class="thing" title="'+name+'" style="z-index:'+(200+this.zIndex)+';left:'+(this.x*16)+'px;top:'+(this.y*16)+'px;background-position:'+(-this.pic[0]*16)+'px '+(-this.pic[1]*16)+'px;"></div>';}
this.Wander=function()
{this.targets=[];this.targets.push([-1,0],[1,0],[0,-1],[0,1]);this.Move();}
this.GoTo=function(x,y)
{this.targets=[];if(this.x<x)this.targets.push([1,0]);if(this.x>x)this.targets.push([-1,0]);if(this.y<y)this.targets.push([0,1]);if(this.y>y)this.targets.push([0,-1]);if(!this.Move())
{this.targets=[];if(this.x==x)this.targets.push([1,0],[-1,0]);if(this.y==y)this.targets.push([0,1],[0,-1]);this.Move();}}
this.Flee=function(x,y)
{this.targets=[];if(this.x>x)this.targets.push([1,0]);if(this.x<x)this.targets.push([-1,0]);if(this.y>y)this.targets.push([0,1]);if(this.y<y)this.targets.push([0,-1]);if(!this.Move())
{this.targets=[];if(this.x==x)this.targets.push([1,0],[-1,0]);if(this.y==y)this.targets.push([0,1],[0,-1]);this.Move();}}
this.Move=function()
{if(this.targets.length>0)
{var goodTargets=[];if(this.type=='hero')goodTargets=this.targets;else
{for(var i in this.targets)
{var thisTarget=this.targets[i];if(this.dungeon.CheckObstacle(this.x+thisTarget[0],this.y+thisTarget[1])!=-1)goodTargets.push([thisTarget[0],thisTarget[1]]);}}
if(goodTargets.length>0)
{var target=choose(goodTargets);var obstacle=this.dungeon.CheckObstacle(this.x+target[0],this.y+target[1]);if(obstacle==this)obstacle=0;if(obstacle==0&&this.AI!='static')
{this.x+=target[0];this.y+=target[1];}
else this.stuck+=2;if(obstacle!=0&&obstacle!=-1)
{obstacle.HitBy(this);}
if(obstacle==-1)return 0;}
else{this.stuck+=2;return 0;}
if(this.AI=='static')this.stuck=0;return 1;}
return 0;}
this.HitBy=function(by)
{if(this.type=='destructible'&&by.type=='hero')
{by.stuck=0;this.life--;if(this.life<=0)
{if(this.onKill)this.onKill();this.Destroy();}
else this.pic=[this.pic[0],this.pic[1]+1];}
else if(this.type=='special'&&this.subtype=='upgrade')
{this.obstacle=0;if(Game.Upgrades[this.value])Game.Upgrades[this.value].earn();this.value='';}
else if((this.type=='monster'&&by.type=='hero')||(this.type=='hero'&&by.type=='monster')&&this.stats.hp>0)
{by.stuck=0;var monster=(this.type=='hero'?by:this);var hero=(this.type=='hero'?this:by);this.dungeon.currentOpponent=monster;if(monster.fighting==0)
{Game.Heroes[hero.subtype].Say('meet '+Game.Monsters[monster.subtype].name);this.Say('fight');}
if(this.fighting==0)
{this.fighting=1;by.fighting=1;}
var attackStr='';var attackerName='';var defenderName='';if(by.type=='hero')attackerName=Game.Heroes[by.subtype].name;else if(by.type=='monster')attackerName=Game.Monsters[by.subtype].name;if(this.type=='hero')defenderName=Game.Heroes[this.subtype].name;else if(this.type=='monster')defenderName=Game.Monsters[this.subtype].name;attackStr+=attackerName+' swings at '+defenderName+'!';var damage=Math.round(Math.max(1,Math.min(by.stats.might,Math.pow(((by.stats.might+2.5)/Math.max(1,this.stats.guard)),2)))*(0.8+Math.random()*0.4+Math.pow(Math.random()*0.8,6)));var dodge=Math.random()>(by.stats.speed/Math.max(1,this.stats.dodge+2.5));if(dodge)
{attackStr+=' '+defenderName+' dodged the attack.';}
else
{if(by.stats.luck&&by.type=='hero'&&Math.random()<by.stats.luck*0.01){damage*=2;attackStr+=' <b>It\'s a critical!</b>';}
attackStr+=' <b>'+damage+'</b> damage!';this.stats.hp-=damage;this.stats.hp=Math.max(this.stats.hp,0);if(this.stats.luck&&this.type=='hero')
{if(this.stats.hp==0&&Math.random()<this.stats.luck*0.01){this.stats.hp=1;attackStr+=' '+defenderName+' was saved from certain death!';}}}
if(this.type=='hero')attackStr='<span style="color:#f99;">'+attackStr+'</span>';if(attackStr!='')this.dungeon.Log(attackStr);if(this.stats.hp<=0)
{this.dungeon.Log(attackerName+' crushed '+defenderName+'!');if(this.type=='hero')
{Game.Heroes[this.subtype].Say('defeat');this.dungeon.Log('<span style="color:#f66;">'+Game.Heroes[this.subtype].name+' has been defeated.</span>');this.dungeon.FailLevel();}
if(this.type=='monster'&&by.type=='hero')
{l('monsterSlot'+this.dungeon.id).style.visibility='hidden';this.dungeon.monstersKilledThisRun+=1;if(Math.random()<0.05)Game.Heroes[by.subtype].Say('win');Game.Heroes[by.subtype].Say('win against '+Game.Monsters[this.subtype].name);this.Say('defeat');if(Game.Monsters[this.subtype].loot)
{var loot=Game.Monsters[this.subtype].loot;if(loot.gear&&(!loot.gear.prob||Math.random()<loot.gear.prob)){}
if(loot.cookies&&(!loot.cookies.prob||Math.random()<loot.cookies.prob))
{var entity=this.dungeon.AddEntity('item','cookies',this.x,this.y);entity.value=Math.round(loot.cookies.min+Math.random()*(loot.cookies.max-loot.cookies.min));}}
if(this.onKill)this.onKill();this.Destroy();}}}}
this.Turn=function()
{if(this.type=='monster')
{var howManyTurns=this.GetInitiative();for(var i=0;i<howManyTurns;i++)
{if(1==1)
{if(this.AI=='flee')this.Flee(this.dungeon.heroEntity.x,this.dungeon.heroEntity.y);else
{this.GoTo(this.dungeon.heroEntity.x,this.dungeon.heroEntity.y);if(this.stuck||this.targets.length==[])this.Wander();}}}}
if(this.type=='monster'||this.type=='hero')
{if(this.stuck>0)this.stuck--;this.stuck=Math.min(10,this.stuck);this.targets=[];}
if((this.type=='hero'||this.type=='monster')&&this.fighting==0&&this.stats.hp<this.stats.hpm)this.stats.hp++;if(this.type=='hero')
{var entities=this.dungeon.GetEntities(this.x,this.y);for(var i in entities)
{if(entities[i].type=='item'&&entities[i].subtype=='cookies')
{var entity=entities[i];var value=Math.ceil(entity.value*Game.Objects[this.dungeon.type].amount*50*(1+Math.random()*((this.stats.luck)/20)));if(value>0)
{this.dungeon.Log('<span style="color:#9f9;">Found <b>'+Beautify(value)+'</b> cookie'+(value==1?'':'s')+'!</span>');this.dungeon.cookiesMadeThisRun+=value;Game.Earn(value);}
entity.Destroy();}}}
if(this.type=='hero')this.fighting=0;}
this.Destroy=function()
{this.dungeon.entities.splice(this.dungeon.entities.indexOf(this),1);}
this.GetInitiative=function()
{return randomFloor((this.stats.speed/5)*(1/Math.max(1,(this.dungeon.heroEntity.stats.speed/5))));}}
Game.Dungeons=[];Game.Dungeon=function(type,id)
{this.type=type;this.id=id;Game.Dungeons[this.id]=this;this.log=[];this.logNew=0;this.name=Game.DungeonTypes[this.type].nameGenerator();this.hero=null;this.currentOpponent=0;this.level=0;this.auto=1;this.portalPic='';this.cookiesMadeThisRun=0;this.monstersKilledThisRun=0;this.Log=function(what,nested)
{if(typeof what==='string')
{this.log.unshift(what);this.logNew++;}
else{for(var i in what){this.Log(what[i],1);}}}
this.UpdateLog=function()
{this.log=this.log.slice(0,30);var str='';for(var i in this.log)
{if(i<this.logNew)str+='<div class="new">'+this.log[i]+'</div>';else str+='<div>'+this.log[i]+'</div>';}
this.logNew=0;l('dungeonLog'+this.id).innerHTML=str;}
this.entities=[];this.GetEntities=function(x,y)
{var entities=[];for(var i in this.entities){if(this.entities[i].x==x&&this.entities[i].y==y)entities.push(this.entities[i]);}
return entities;}
this.AddEntity=function(type,subtype,x,y)
{var entity=new Game.Entity(type,subtype,this);entity.x=x;entity.y=y;entity.dungeon=this;this.entities.push(entity);return entity;}
this.RemoveEntities=function(x,y)
{var entities=this.GetEntities(x,y);for(var i in entities)
{entities[i].Destroy();}}
this.DrawEntities=function()
{var str='';for(var i in this.entities){str+=this.entities[i].Draw();}
return str;}
this.CheckObstacle=function(x,y)
{if(x<0||x>=this.map.w||y<0||y>=this.map.h)return-1;var entities=this.GetEntities(x,y);for(var i in entities)
{if(entities[i].obstacle)return entities[i];}
return this.map.isObstacle(x,y)?-1:0;}
this.map={};this.Generate=function()
{if(this.level==0)this.name=Game.DungeonTypes[this.type].nameGenerator();this.entities=[];var M=new D.Map(40,40,Math.random(),{roomSize:10,corridorSize:5,fillRatio:1/2,corridorRatio:0.3,pillarRatio:Math.random()*0.8+0.2,waterRatio:Math.random(),branching:Math.ceil(Math.random()*6),sizeVariance:0.4});r=0;while(r!=1)
{r=M.dig();}
M.finish();for(var i in M.doors)
{this.AddEntity('destructible','door',M.doors[i][0],M.doors[i][1]);}
for(var i in M.rooms)
{var altStr=choose(['alt ','','']);var tiles={'void':altStr+'void','wall':altStr+'wall','wall corner':altStr+'wall corner','floor':altStr+'tiled floor','floor edges':altStr+'floor','door':altStr+'door','water':choose(['water','green water','dark water']),'pillar':choose([altStr+'wall',altStr+'round pillar',altStr+'square pillar',altStr+'potted plant','conveyor belt']),'entrance':altStr+'entrance','exit':altStr+'exit',};if(Math.random()<0.1){tiles['wall corner']='wooden wall';tiles['wall']='wooden wall';tiles['floor edges']='wooden floor';tiles['pillar']='wooden wall';}
if(Math.random()<0.1){tiles['wall corner']=altStr+'bookshelf';tiles['wall']=altStr+'bookshelf';tiles['pillar']=altStr+'bookshelf';}
M.assignTiles(M.rooms[i],tiles);}
this.map=M;this.map.str=this.map.getStr();var tile=this.map.exit;var monsters=[];for(var ii in Game.BossMonsters)
{var me=Game.BossMonsters[ii];if(me.level<=(depth+this.level)&&Math.random()<(me.stats.rarity||1))monsters.push(me.name);}
if(monsters.length==0)monsters=[choose(Game.BossMonsters).name];if(monsters.length>0)
{this.AddEntity('monster',choose(monsters),tile[0],tile[1]);this.map.removeFreeTile(tile[0],tile[1]);}
for(var i=0;i<Math.ceil(this.map.freeTiles.length*0.7);i++)
{var tile=choose(this.map.freeTiles);if(tile!=-1)
{var room=this.map.getRoom(tile[0],tile[1]);var depth=room.gen+1;if(Math.random()<0.2)
{var monsters=[];for(var ii in Game.Monsters)
{var me=Game.Monsters[ii];if(me.level!=0&&me.level<=(depth+this.level)&&Math.random()<(me.stats.rarity||1))monsters.push(me.name);}
if(monsters.length>0)
{this.AddEntity('monster',choose(monsters),tile[0],tile[1]);this.map.removeFreeTile(tile[0],tile[1]);}}
else
{if(Math.random()<0.6)
{var value=Math.round(Math.pow(Math.random(),6)*(10+this.level));if(value>0)
{var entity=this.AddEntity('item','cookies',tile[0],tile[1]);entity.value=value;}}
else this.AddEntity('destructible','random',tile[0],tile[1]);this.map.removeFreeTile(tile[0],tile[1]);}}}}
this.onTile=-1;this.Draw=function()
{var str='';var x=-this.hero.x;var y=-this.hero.y;str+='<div id="map'+this.id+'" class="map" style="width:'+(9*16)+'px;height:'+(9*16)+'px;"><div class="mapContainer" id="mapcontainer'+this.id+'" style="position:absolute;left:'+(x*16)+'px;top:'+(y*16)+'px;"><div id="mapitems'+this.id+'"></div>'+this.map.str+'</div></div>';str+='<div style="position:absolute;left:'+(9*16+16)+'px;">'+'<a class="control west" onclick="Game.HeroesById['+this.hero.id+'].Move(-1,0);"></a><br>'+'<a class="control east" onclick="Game.HeroesById['+this.hero.id+'].Move(1,0);"></a><br>'+'<a class="control north" onclick="Game.HeroesById['+this.hero.id+'].Move(0,-1);"></a><br>'+'<a class="control south" onclick="Game.HeroesById['+this.hero.id+'].Move(0,1);"></a><br>'+'<a class="control middle" onclick="Game.HeroesById['+this.hero.id+'].Move(0,0);"></a><br>'+'</div>';str+='<div style="position:absolute;left:'+(9*16+16+48*3)+'px;bottom:16px;height:100%;">'+'<div class="dungeonName"><a onclick="Game.ObjectsById['+this.id+'].setSpecial(0);">Exit</a> - <span class="title" style="font-size:12px;">'+this.name+'</span> lvl.'+(this.level+1)+'</div>'+'<div id="heroSlot'+this.id+'" class="mobSlot"><div id="picHero'+this.id+'" class="mobPic"></div><div id="nameHero'+this.id+'" class="title mobName"></div><div class="hpmBar"><div id="hpHero'+this.id+'" class="hpBar"></div></div></div>'+'<div id="monsterSlot'+this.id+'" class="mobSlot" style="left:128px;"><div id="picMonster'+this.id+'" class="mobPic"></div><div id="nameMonster'+this.id+'" class="title mobName"></div><div class="hpmBar"><div id="hpMonster'+this.id+'" class="hpBar"></div></div></div>'+'</div>'+'<div id="dungeonLog'+this.id+'" class="dungeonLog"></div>';l('rowSpecial'+this.id).innerHTML='<div style="width:100%;height:100%;z-index:10000;position:absolute;left:0px;top:0px;">'+str+'</div>';l('picHero'+this.id).style.backgroundImage='url(img/'+this.hero.portrait+'.png)';l('nameHero'+this.id).innerHTML=this.hero.name;}
this.Refresh=function()
{if(!l('mapcontainer'+this.id))this.Draw();var x=4-this.hero.x;var y=4-this.hero.y;l('mapcontainer'+this.id).style.left=(x*16)+'px';l('mapcontainer'+this.id).style.top=(y*16)+'px';l('mapitems'+this.id).innerHTML=this.DrawEntities();}
this.RedrawMap=function()
{this.map.str=this.map.getStr();this.Draw();}
this.Turn=function()
{for(var i in this.entities)
{if(this.entities[i]&&this.entities[i].type)this.entities[i].Turn();}
if(this.currentOpponent)
{l('monsterSlot'+this.id).style.visibility='visible';l('hpMonster'+this.id).style.width=Math.round((this.currentOpponent.stats.hp/this.currentOpponent.stats.hpm)*100)+'%';l('picMonster'+this.id).style.backgroundImage='url(img/'+Game.Monsters[this.currentOpponent.subtype].pic+'.png)';l('nameMonster'+this.id).innerHTML=Game.Monsters[this.currentOpponent.subtype].name;l('picHero'+this.id).style.backgroundImage='url(img/'+this.hero.pic+'.png)';}
else
{l('monsterSlot'+this.id).style.visibility='hidden';l('hpMonster'+this.id).style.width='100%';l('picHero'+this.id).style.backgroundImage='url(img/'+this.hero.portrait+'.png)';}
this.currentOpponent=0;l('hpHero'+this.id).style.width=Math.round((this.heroEntity.stats.hp/this.heroEntity.stats.hpm)*100)+'%';this.Refresh();this.UpdateLog();if(this.hero.x==this.map.exit[0]&&this.hero.y==this.map.exit[1])
{this.CompleteLevel();}}
this.DrawButton=function()
{var str='';str+='<div style="width:144px;height:144px;position:absolute;left:0px;bottom:0px;"><a class="specialButtonPic" style="background-image:url(img/'+this.portalPic+'.png);" onclick="Game.ObjectsById['+this.id+'].setSpecial(1);"><div class="specialButtonText">Enter dungeons</div></a></div>';return str;}
this.CompleteLevel=function()
{this.hero.Say('completion');this.level++;this.Generate();Game.HeroesById[0].EnterDungeon(this,this.map.entrance[0],this.map.entrance[1]);this.Draw();}
this.FailLevel=function()
{this.Log('Cookies made this run : '+Beautify(this.cookiesMadeThisRun)+' | Monsters defeated this run : '+Beautify(this.monstersKilledThisRun));this.cookiesMadeThisRun=0;this.monstersKilledThisRun=0;this.level=0;this.Generate();Game.HeroesById[0].EnterDungeon(this,this.map.entrance[0],this.map.entrance[1]);this.Draw();}}
Game.DungeonLocationChain=function(map,x,y)
{var room=map.getRoom(x,y);var chain=[];if(room!=-1)
{while(room.parent)
{chain.push(room);room=room.parent;}}
chain.reverse();return chain;}
Game.DungeonLinkLocationChains=function(start,end)
{start.reverse();end.reverse();if(start[0].id==end[0].id)return start[start.length-1];for(var i in end)
{if(start[0]==end[i].parent)return end[i];}
if(start.length>1)return start[1];return start[0];}
Game.Objects['Factory'].special=function()
{this.dungeon=new Game.Dungeon('Factory',this.id);this.dungeon.Generate();this.specialDrawFunction=function(){this.dungeon.Refresh();};this.drawSpecialButton=function(){return this.dungeon.DrawButton();};this.dungeon.timer=0;this.dungeon.timerWarmup=5;this.dungeon.portalPic='dungeonFactory';this.EachFrame=function()
{if(this.dungeon.auto)
{if(this.dungeon.timer>0)this.dungeon.timer--;if(this.dungeon.timer==0)
{this.dungeon.timer=Game.fps*(Math.max(0.1,2-(this.dungeon.hero.stats.speed*0.2))+Math.max(this.dungeon.timerWarmup,0));if(this.dungeon.timerWarmup>0)this.dungeon.timerWarmup--;var dungeon=this.dungeon;var hero=dungeon.heroEntity;var targetRoom=Game.DungeonLinkLocationChains(Game.DungeonLocationChain(dungeon.map,hero.x,hero.y),Game.DungeonLocationChain(dungeon.map,dungeon.map.exit[0],dungeon.map.exit[1]));var targetTile=(targetRoom.gen==0||targetRoom.id==dungeon.map.getRoom(hero.x,hero.y).id)?[dungeon.map.exit[0],dungeon.map.exit[1]]:targetRoom.door;hero.GoTo(targetTile[0],targetTile[1]);if(hero.stuck)hero.Wander();dungeon.hero.x=hero.x;dungeon.hero.y=hero.y;dungeon.Turn();}}}
if(document.addEventListener)
{l('rowSpecial'+this.dungeon.id).removeEventListener('keydown',arguments.callee,false);l('rowSpecial'+this.dungeon.id).addEventListener('keydown',function(event)
{var dungeon=Game.Objects['Factory'].dungeon;var control=0;if(event.keyCode==37){dungeon.hero.Move(-1,0);control=1;}
else if(event.keyCode==38){dungeon.hero.Move(0,-1);control=1;}
else if(event.keyCode==39){dungeon.hero.Move(1,0);control=1;}
else if(event.keyCode==40){dungeon.hero.Move(0,1);control=1;}
else if(event.keyCode==32){dungeon.hero.Move(0,0);control=1;}
else if(event.keyCode==65)
{if(dungeon.auto)
{dungeon.auto=0;dungeon.timerWarmup=-1;}
else
{dungeon.auto=1;dungeon.timer=0;dungeon.timerWarmup=0;}
event.preventDefault();}
if(control)
{event.preventDefault();dungeon.timer=Game.fps*10;dungeon.timerWarmup=5;}});}
var hero=choose(Game.HeroesById);hero.EnterDungeon(this.dungeon,this.dungeon.map.entrance[0],this.dungeon.map.entrance[1]);}
Game.Heroes=[];Game.HeroesById=[];Game.Hero=function(name,pic,portrait,icon)
{this.name=name;this.pic=pic;this.portrait=portrait;this.icon=icon;this.stats={hp:25,hpm:25,might:5,guard:5,speed:5,dodge:5,luck:5};this.dialogue={'greeting':'Oh hey.|Sup.','entrance':'Here we go.|So exciting.','completion':'That was easy.|All done here.','defeat':'Welp.|Better luck next time.'};this.gear={'armor':-1,'weapon':-1};this.inDungeon=-1;this.completedDungeons=0;this.x=0;this.y=0;this.EnterDungeon=function(dungeon,x,y)
{this.inDungeon=dungeon.id;dungeon.hero=this;this.x=x;this.y=y;dungeon.heroEntity=dungeon.AddEntity('hero',dungeon.hero.name,x,y);var room=dungeon.map.getRoom(this.x,this.y);if(room!=-1&&room.hidden){room.hidden=0;dungeon.RedrawMap();}
Game.Dungeons[this.inDungeon].Refresh();dungeon.Log('--------------------');if(dungeon.level==0)this.Say('greeting');this.Say('entrance');l('monsterSlot'+dungeon.id).style.visibility='hidden';}
this.Move=function(x,y)
{var dungeon=Game.Dungeons[this.inDungeon];dungeon.heroEntity.targets=[[x,y]];if(dungeon.heroEntity.Move())
{this.x=dungeon.heroEntity.x;this.y=dungeon.heroEntity.y;dungeon.Turn();}}
this.Say=function(what)
{if(this.dialogue[what])Game.Dungeons[this.inDungeon].Log(this.name+' : "<span style="color:#99f;">'+choose(this.dialogue[what].split('|'))+'</span>"');}
this.save=function()
{var str='';str+=this.inDungeon+','+
this.completedDungeons+','+
this.gear.armor+','+
this.gear.weapon;return str;}
this.load=function(data)
{var str=data.split(',');this.inDungeon=parseInt(str[0]);this.completedDungeons=parseInt(str[1]);this.gear.armor=parseInt(str[2]);this.gear.weapon=parseInt(str[3]);}
this.id=Game.HeroesById.length;Game.HeroesById.push(this);Game.Heroes[this.name]=this;}
var hero=new Game.Hero('Chip','girlscoutChip','portraitChip',[1,0]);hero.dialogue={'intro':'I\'m Chip! I just really like exploring stuff. Let\'s go have an adventure!','greeting':'Hello there!|I\'m ready!|Where are we going today?|Adventure!','win':'Take that!|Hah!|That\'s right.','entrance':'Chipping in!|Welp, here goes nothing!|I wonder what I\'ll find!|Hey, this place is new!|This place seems familiar.|Let\'s make it happen.','completion':'I\'m one smart cookie.|Oh yeah!|Let\'s explore some more!|That was easy!|That sure was fun!|I\'m not lost, am I?|More exploring? Sure, why not!','defeat':'B-better luck next time.|That really hurt!|I yield! I yield!|That went badly.|No half-baked excuses next time.|I think I scraped my knee!|Owie.|Woopsie!','win against Sentient Furnace':'The irony, it burns! (...it\'s funny because it was burning. And made of iron. ...Moving on.)','win against Ascended Baking Pod':'Where is your pod now?|That was disturbing.'};hero.stats={hp:30,hpm:30,might:5,guard:5,speed:5,dodge:5,luck:5};var hero=new Game.Hero('Crumb','girlscoutCrumb','portraitCrumb',[2,0]);hero.dialogue={'intro':'I\'m Crumb. I look like this because of a baking accident when I was little. Big deal. At least now I don\'t get hurt as easily as others, I guess.','greeting':'Hi there.|Ready for adventure, I guess.|Reporting for duty.','win':'Oh sorry, did that hurt?|Should have moved out of the way.|Oops. My bad.','entrance':'Let\'s do this, I guess.|Well, let\'s go...|I gotta go in there?|Are we really doing this?|I hope I won\'t get lost like last time.|Let\'s get this over with.','completion':'I... I did it...|I\'m glad that\'s over.|What, there\'s more?|In I go, I guess.|It doesn\'t end, does it?|But it\'s dark in there.','defeat':'I, uh, ouch.|Why does that always happen to me?|I\'m just no good, am I?|Oh no.|I\'m... I\'m not crying.|Well that wasn\'t fun at all.|I\'m sorry I failed you.|Please... make them go away...','meet Ascended Baking Pod':'That thing shouldn\'t even be alive.|Is that where they all came from?','win against Ascended Baking Pod':'Hm. Fascinating.'};hero.stats={hp:25,hpm:25,might:5,guard:7,speed:4,dodge:4,luck:5};var hero=new Game.Hero('Doe','girlscoutDoe','portraitDoe',[3,0]);hero.dialogue={'intro':'H-hey. Name\'s Doe. I\'m pretty fast. I uh, I promise I\'ll do my best.','greeting':'H-hey.|Oh, uh, h-hi there.|C-can I join?','win':'Th-that looks like it hurt... awesome...|D-did I do that?|N-neat... there\'s pieces everywhere.','entrance':'Alright, let\'s do this!|I-if I really have to.|I-in there? By myself?|...won\'t you come with me this time?|H-here I go!','completion':'Oh... oh my.|That\'s... I uh, I\'m glad.|Y-yeah that was real easy. Piece of pie!|T-too easy, right?|S-so many cookies...|Ooh? F-fascinating.','defeat':'I-if you can\'t beat them... join them.|I-it\'s because I stutter, isn\'t it?|W-well that\'s just no good at all.|I, uh, I meant for that to happen.|H-how embarrassing.','meet Ascended Baking Pod':'W-whoah... it\'s... magnificent...','win against Ascended Baking Pod':'I\'m sorry, buddy.|I... I think I hurt it...|Oh no... I-I think I broke it...'};hero.stats={hp:25,hpm:25,might:4,guard:4,speed:7,dodge:5,luck:5};var hero=new Game.Hero('Lucky','girlscoutLucky','portraitLucky',[4,0]);hero.dialogue={'intro':'Oh joy! My name\'s Lucky. Guess what I\'m good at?','greeting':'I\'m feeling lucky!|It\'s a bright day today!|Let\'s do great things together.','win':'Ooh lucky shot!|Pow! One more.|Damn straight!','entrance':'Glad to be of service!|Oooh this one\'ll be interesting.|This will be a good one, I can feel it!|Here I come!','completion':'Over already?|Let\'s explore some more!|That was lucky!|That was no luck, I\'m just that good.|Alright, let\'s move on!|I\'m just getting warmed up!','defeat':'I can\'t believe it!|...This is a joke, right?|Hey! No fair!|B-but...|I\'m gonna need a bandaid. And some hot chocolate.|I\'ll, uh, try again later.|Bad luck! Bad luck!','win against Ascended Baking Pod':'Golly, that was peculiar.'};hero.stats={hp:25,hpm:25,might:5,guard:4,speed:4,dodge:5,luck:7};};
</script>
<script>
function l(what){return document.getElementById(what);}
function choose(arr){return arr[Math.floor(Math.random()*arr.length)];}
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(needle){for(var i=0;i<this.length;i++){if(this[i]===needle){return i;}}
return-1;};}
function randomFloor(x){if((x%1)<Math.random())return Math.floor(x);else return Math.ceil(x);}
function shuffle(array)
{var counter=array.length,temp,index;while(counter--)
{index=(Math.random()*counter)|0;temp=array[counter];array[counter]=array[index];array[index]=temp;}
return array;}
function Beautify(what,floats)
{var str='';if(!isFinite(what))return'Infinity';if(what.toString().indexOf('e')!=-1)return what.toString();what=Math.round(what*10000000)/10000000;if(floats>0)
{var floater=what-Math.floor(what);floater=Math.round(floater*10000000)/10000000;var floatPresent=floater?1:0;floater=(floater.toString()+'0000000').slice(2,2+floats);if(parseInt(floater)===0)floatPresent=0;str=Beautify(Math.floor(what))+(floatPresent?('.'+floater):'');}
else
{what=Math.floor(what);what=(what+'').split('').reverse();for(var i in what)
{if(i%3==0&&i>0)str=','+str;str=what[i]+str;}}
return str;}
function utf8_to_b64(str){try{return Base64.encode(unescape(encodeURIComponent(str)));}
catch(err)
{return'';}}
function b64_to_utf8(str){try{return decodeURIComponent(escape(Base64.decode(str)));}
catch(err)
{return'';}}
function CompressBin(arr)
{var str='';var arr2=arr.slice(0);arr2.unshift(1);arr2.push(1);arr2.reverse();for(var i in arr2)
{str+=arr2[i];}
str=parseInt(str,2);return str;}
function UncompressBin(num)
{var arr=num.toString(2);arr=arr.split('');arr.reverse();arr.shift();arr.pop();return arr;}
function CompressLargeBin(arr)
{var arr2=arr.slice(0);var thisBit=[];var bits=[];for(var i in arr2)
{thisBit.push(arr2[i]);if(thisBit.length>=50)
{bits.push(CompressBin(thisBit));thisBit=[];}}
if(thisBit.length>0)bits.push(CompressBin(thisBit));arr2=bits.join(';');return arr2;}
function UncompressLargeBin(arr)
{var arr2=arr.split(';');var bits=[];for(var i in arr2)
{bits.push(UncompressBin(parseInt(arr2[i])));}
arr2=[];for(var i in bits)
{for(var ii in bits[i])arr2.push(bits[i][ii]);}
return arr2;}
(function(a,b,c,d,e,f){function k(a){var b,c=a.length,e=this,f=0,g=e.i=e.j=0,h=e.S=[];for(c||(a=[c++]);d>f;)h[f]=f++;for(f=0;d>f;f++)h[f]=h[g=j&g+a[f%c]+(b=h[f])],h[g]=b;(e.g=function(a){for(var b,c=0,f=e.i,g=e.j,h=e.S;a--;)b=h[f=j&f+1],c=c*d+h[j&(h[f]=h[g=j&g+b])+(h[g]=b)];return e.i=f,e.j=g,c})(d)}function l(a,b){var e,c=[],d=(typeof a)[0];if(b&&"o"==d)for(e in a)try{c.push(l(a[e],b-1))}catch(f){}return c.length?c:"s"==d?a:a+"\0"}function m(a,b){for(var d,c=a+"",e=0;c.length>e;)b[j&e]=j&(d^=19*b[j&e])+c.charCodeAt(e++);return o(b)}function n(c){try{return a.crypto.getRandomValues(c=new Uint8Array(d)),o(c)}catch(e){return[+new Date,a,a.navigator.plugins,a.screen,o(b)]}}function o(a){return String.fromCharCode.apply(0,a)}var g=c.pow(d,e),h=c.pow(2,f),i=2*h,j=d-1;c.seedrandom=function(a,f){var j=[],p=m(l(f?[a,o(b)]:0 in arguments?a:n(),3),j),q=new k(j);return m(o(q.S),b),c.random=function(){for(var a=q.g(e),b=g,c=0;h>a;)a=(a+c)*d,b*=d,c=q.g(1);for(;a>=i;)a/=2,b/=2,c>>>=1;return(a+c)/b},p},m(c.random(),b)})(this,[],Math,256,6,52);Game={};Game.Launch=function()
{Game.ready=0;Game.Init=function()
{Game.ready=1;l('javascriptError').innerHTML='<div style="padding:64px 128px;"><div class="title">Loading...</div></div>';Game.T=0;Game.fps=30;Game.version=2.052;Game.beta=1;Game.SaveTo='CookieClickerGame';if(Game.beta)Game.SaveTo='CookieClicker';l('versionNumber').innerHTML='v.'+Game.version+(Game.beta?' <span style="color:#ff0;">beta</span>':'');l('links').innerHTML=(Game.beta?'<a href="../" target="blank">Live version</a> | ':'<a href="//orteil.dashnet.org/cookieclicker/beta/" target="blank">Try the beta!</a> | ')+'<a href="//orteil.dashnet.org/cookieclicker/" target="blank">Cookie Clicker Classic</a>';Game.time=new Date().getTime();Game.fpsMeasure=new Date().getTime();Game.accumulatedDelay=0;Game.catchupLogic=0;Game.cookiesEarned=0;Game.cookies=0;Game.cookiesd=0;Game.cookiesPs=1;Game.cookiesReset=0;Game.frenzy=0;Game.frenzyPower=1;Game.clickFrenzy=0;Game.cookieClicks=0;Game.goldenClicks=0;Game.missedGoldenClicks=0;Game.handmadeCookies=0;Game.milkProgress=0;Game.milkH=Game.milkProgress/2;Game.milkHd=0;Game.milkType=-1;Game.backgroundType=-1;Game.prestige=[];Game.elderWrath=0;Game.elderWrathD=0;Game.pledges=0;Game.pledgeT=0;Game.researchT=0;Game.nextResearch=0;Game.bg='';Game.bgFade='';Game.bgR=0;Game.bgRd=0;Game.startDate=parseInt(new Date().getTime());Game.prefs=[];Game.DefaultPrefs=function()
{Game.prefs.particles=1;Game.prefs.numbers=1;Game.prefs.autosave=1;Game.prefs.autoupdate=1;Game.prefs.milk=1;Game.prefs.fancy=1;}
Game.DefaultPrefs();Game.CheckUpdates=function()
{ajax('server.php?q=checkupdate',Game.CheckUpdatesResponse);}
Game.CheckUpdatesResponse=function(response)
{var r=response.split('|');if(parseFloat(r[0])>Game.version)
{var str='<b>New version available : v.'+r[0]+'!</b>';if(r[1])str+='<br>Update note : "'+r[1]+'"';str+='<br><b>Refresh to get it!</b>';l('alert').innerHTML=str;l('alert').style.display='block';}}
Game.ExportSave=function()
{var save=prompt('Copy this text and keep it somewhere safe!',Game.WriteSave(1));}
Game.ImportSave=function()
{var save=prompt('Please paste in the text that was given to you on save export.','');if(save&&save!='')Game.LoadSave(save);Game.WriteSave();}
Game.WriteSave=function(exporting)
{var str='';str+=Game.version+'|';str+='|';str+=parseInt(Game.startDate)+'|';str+=(Game.prefs.particles?'1':'0')+
(Game.prefs.numbers?'1':'0')+
(Game.prefs.autosave?'1':'0')+
(Game.prefs.autoupdate?'1':'0')+
(Game.prefs.milk?'1':'0')+
(Game.prefs.fancy?'1':'0')+'|';str+=parseFloat(Game.cookies).toString()+';'+
parseFloat(Game.cookiesEarned).toString()+';'+
parseInt(Math.floor(Game.cookieClicks))+';'+
parseInt(Math.floor(Game.goldenClicks))+';'+
parseFloat(Game.handmadeCookies).toString()+';'+
parseInt(Math.floor(Game.missedGoldenClicks))+';'+
parseInt(Math.floor(Game.backgroundType))+';'+
parseInt(Math.floor(Game.milkType))+';'+
parseFloat(Game.cookiesReset).toString()+';'+
parseInt(Math.floor(Game.elderWrath))+';'+
parseInt(Math.floor(Game.pledges))+';'+
parseInt(Math.floor(Game.pledgeT))+';'+
parseInt(Math.floor(Game.nextResearch))+';'+
parseInt(Math.floor(Game.researchT))+'|';for(var i in Game.Objects)
{var me=Game.Objects[i];str+=me.amount+','+me.bought+','+Math.floor(me.totalCookies)+','+(me.specialUnlocked?1:0)+';';}
str+='|';var toCompress=[];for(var i in Game.Upgrades)
{var me=Game.Upgrades[i];toCompress.push(Math.min(me.unlocked,1),Math.min(me.bought,1));}
toCompress=CompressLargeBin(toCompress);str+=toCompress;str+='|';var toCompress=[];for(var i in Game.Achievements)
{var me=Game.Achievements[i];toCompress.push(Math.min(me.won));}
toCompress=CompressLargeBin(toCompress);str+=toCompress;if(exporting)
{str=escape(utf8_to_b64(str)+'!END!');return str;}
else
{var now=new Date();now.setFullYear(now.getFullYear()+5);str=utf8_to_b64(str)+'!END!';str=Game.SaveTo+'='+escape(str)+'; expires='+now.toUTCString()+';';document.cookie=str;if(document.cookie.indexOf(Game.SaveTo)<0)Game.Popup('Error while saving.<br>Export your save instead!');else Game.Popup('Game saved');}}
Game.LoadSave=function(data)
{var str='';if(data)str=unescape(data);else if(document.cookie.indexOf(Game.SaveTo)>=0)str=unescape(document.cookie.split(Game.SaveTo+'=')[1]);if(str!='')
{var version=0;var oldstr=str.split('|');if(oldstr[0]<1){}
else
{str=str.split('!END!')[0];str=b64_to_utf8(str);}
if(str!='')
{var spl='';str=str.split('|');version=parseFloat(str[0]);if(isNaN(version)||str.length<5){Game.Popup('Oops, looks like the import string is all wrong!');return 0;}
if(version>=1&&version>Game.version)
{alert('Error : you are attempting to load a save from a later version (v.'+version+'; you are using v.'+Game.version+').');return 0;}
else if(version>=1)
{spl=str[2].split(';');Game.startDate=parseInt(spl[0]);spl=str[3].split('');Game.prefs.particles=parseInt(spl[0]);Game.prefs.numbers=parseInt(spl[1]);Game.prefs.autosave=parseInt(spl[2]);Game.prefs.autoupdate=spl[3]?parseInt(spl[3]):1;Game.prefs.milk=spl[4]?parseInt(spl[4]):1;Game.prefs.fancy=parseInt(spl[5]);if(Game.prefs.fancy)Game.removeClass('noFancy');else if(!Game.prefs.fancy)Game.addClass('noFancy');spl=str[4].split(';');Game.cookies=parseFloat(spl[0]);Game.cookiesEarned=parseFloat(spl[1]);Game.cookieClicks=spl[2]?parseInt(spl[2]):0;Game.goldenClicks=spl[3]?parseInt(spl[3]):0;Game.handmadeCookies=spl[4]?parseFloat(spl[4]):0;Game.missedGoldenClicks=spl[5]?parseInt(spl[5]):0;Game.backgroundType=spl[6]?parseInt(spl[6]):0;Game.milkType=spl[7]?parseInt(spl[7]):0;Game.cookiesReset=spl[8]?parseFloat(spl[8]):0;Game.elderWrath=spl[9]?parseInt(spl[9]):0;Game.pledges=spl[10]?parseInt(spl[10]):0;Game.pledgeT=spl[11]?parseInt(spl[11]):0;Game.nextResearch=spl[12]?parseInt(spl[12]):0;Game.researchT=spl[13]?parseInt(spl[13]):0;spl=str[5].split(';');Game.BuildingsOwned=0;for(var i in Game.ObjectsById)
{var me=Game.ObjectsById[i];if(spl[i])
{var mestr=spl[i].toString().split(',');me.amount=parseInt(mestr[0]);me.bought=parseInt(mestr[1]);me.totalCookies=parseInt(mestr[2]);me.specialUnlocked=parseInt(mestr[3]);Game.BuildingsOwned+=me.amount;}
else
{me.unlocked=0;me.bought=0;me.totalCookies=0;}}
if(version<1.035)
{spl=str[6].split(';');Game.UpgradesOwned=0;for(var i in Game.UpgradesById)
{var me=Game.UpgradesById[i];if(spl[i])
{var mestr=spl[i].split(',');me.unlocked=parseInt(mestr[0]);me.bought=parseInt(mestr[1]);if(me.bought&&me.hide!=3)Game.UpgradesOwned++;}
else
{me.unlocked=0;me.bought=0;}}
if(str[7])spl=str[7].split(';');else spl=[];Game.AchievementsOwned=0;for(var i in Game.AchievementsById)
{var me=Game.AchievementsById[i];if(spl[i])
{var mestr=spl[i].split(',');me.won=parseInt(mestr[0]);}
else
{me.won=0;}
if(me.won&&me.hide!=3)Game.AchievementsOwned++;}}
else
{if(str[6])spl=str[6];else spl=[];spl=UncompressLargeBin(spl);Game.UpgradesOwned=0;for(var i in Game.UpgradesById)
{var me=Game.UpgradesById[i];if(spl[i*2])
{var mestr=[spl[i*2],spl[i*2+1]];me.unlocked=parseInt(mestr[0]);me.bought=parseInt(mestr[1]);if(me.bought&&me.hide!=3)Game.UpgradesOwned++;}
else
{me.unlocked=0;me.bought=0;}}
if(str[7])spl=str[7];else spl=[];spl=UncompressLargeBin(spl);Game.AchievementsOwned=0;for(var i in Game.AchievementsById)
{var me=Game.AchievementsById[i];if(spl[i])
{var mestr=[spl[i]];me.won=parseInt(mestr[0]);}
else
{me.won=0;}
if(me.won&&me.hide!=3)Game.AchievementsOwned++;}}
for(var i in Game.ObjectsById)
{var me=Game.ObjectsById[i];if(me.buyFunction)me.buyFunction();me.setSpecial(0);if(me.special&&me.specialUnlocked==1)me.special();me.refresh();}}
else
{alert('Sorry, you can\'t import saves from the old version anymore.');return;}
Game.goldenCookie.reset();Game.prestige=[];Game.Upgrades['Elder Pledge'].basePrice=Math.pow(8,Math.min(Game.pledges+2,14));Game.RebuildUpgrades();Game.TickerAge=0;Game.elderWrathD=0;Game.frenzy=0;Game.frenzyPower=1;Game.clickFrenzy=0;Game.recalculateGains=1;Game.storeToRebuild=1;Game.upgradesToRebuild=1;Game.Popup('Game loaded');}}}
Game.Reset=function(bypass)
{if(bypass||confirm('Do you REALLY want to start over?\n(your will lose your progress, but you will keep your achievements and your prestige.)'))
{if(!bypass)
{if(Game.cookiesEarned>=1000000)Game.Win('Sacrifice');if(Game.cookiesEarned>=1000000000)Game.Win('Oblivion');if(Game.cookiesEarned>=1000000000000)Game.Win('From scratch');if(Game.cookiesEarned>=1000000000000000)Game.Win('Nihilism');}
Game.cookiesReset+=Game.cookiesEarned;Game.cookies=0;Game.cookiesEarned=0;Game.cookieClicks=0;Game.handmadeCookies=0;Game.backgroundType=-1;Game.milkType=-1;Game.frenzy=0;Game.frenzyPower=1;Game.clickFrenzy=0;Game.pledges=0;Game.pledgeT=0;Game.elderWrath=0;Game.nextResearch=0;Game.researchT=0;Game.Upgrades['Elder Pledge'].basePrice=Math.pow(8,Math.min(Game.pledges+2,14));for(var i in Game.ObjectsById)
{var me=Game.ObjectsById[i];me.amount=0;me.bought=0;me.totalCookies=0;me.specialUnlocked=0;me.setSpecial(0);me.refresh();}
for(var i in Game.UpgradesById)
{var me=Game.UpgradesById[i];me.unlocked=0;me.bought=0;}
Game.BuildingsOwned=0;Game.UpgradesOwned=0;Game.RebuildUpgrades();Game.TickerAge=0;Game.recalculateGains=1;Game.storeToRebuild=1;Game.upgradesToRebuild=1;Game.startDate=parseInt(new Date().getTime());Game.goldenCookie.reset();Game.Popup('Game reset');if(!bypass)
{var prestige=0;if(Game.prestige.ready)prestige=Game.prestige['Heavenly chips'];Game.prestige=[];Game.CalculatePrestige();prestige=Game.prestige['Heavenly chips']-prestige;if(prestige!=0)Game.Popup('You earn '+prestige+' heavenly chip'+(prestige==1?'':'s')+'!');}}}
Game.HardReset=function()
{if(confirm('Do you REALLY want to wipe your save?\n(you will lose your progress, your achievements, and your prestige!)'))
{if(confirm('Whoah now, are you really, REALLY sure?\n(don\'t say we didn\'t warn you!)'))
{for(var i in Game.AchievementsById)
{var me=Game.AchievementsById[i];me.won=0;}
Game.AchievementsOwned=0;Game.goldenClicks=0;Game.missedGoldenClicks=0;Game.Reset(1);Game.cookiesReset=0;Game.prestige=[];Game.CalculatePrestige();}}}
Game.Earn=function(howmuch)
{Game.cookies+=howmuch;Game.cookiesEarned+=howmuch;}
Game.Spend=function(howmuch)
{Game.cookies-=howmuch;}
Game.mouseCps=function()
{var add=0;if(Game.Has('Thousand fingers'))add+=0.1;if(Game.Has('Million fingers'))add+=0.5;if(Game.Has('Billion fingers'))add+=2;if(Game.Has('Trillion fingers'))add+=10;if(Game.Has('Quadrillion fingers'))add+=20;if(Game.Has('Quintillion fingers'))add+=100;var num=0;for(var i in Game.Objects){if(Game.Objects[i].name!='Cursor')num+=Game.Objects[i].amount;}
add=add*num;if(Game.Has('Plastic mouse'))add+=Game.cookiesPs*0.01;if(Game.Has('Iron mouse'))add+=Game.cookiesPs*0.01;if(Game.Has('Titanium mouse'))add+=Game.cookiesPs*0.01;if(Game.Has('Adamantium mouse'))add+=Game.cookiesPs*0.01;var mult=1;if(Game.clickFrenzy>0)mult*=777;return mult*Game.ComputeCps(1,Game.Has('Reinforced index finger'),Game.Has('Carpal tunnel prevention cream')+Game.Has('Ambidextrous'),add);}
Game.computedMouseCps=1;Game.globalCpsMult=1;Game.lastClick=0;Game.autoclickerDetected=0;Game.ClickCookie=function()
{if(new Date().getTime()-Game.lastClick<1000/250)
{}
else
{if(new Date().getTime()-Game.lastClick<1000/15)
{Game.autoclickerDetected+=Game.fps;if(Game.autoclickerDetected>=Game.fps*5)Game.Win('Uncanny clicker');}
Game.Earn(Game.computedMouseCps);Game.handmadeCookies+=Game.computedMouseCps;if(Game.prefs.particles)Game.cookieParticleAdd();if(Game.prefs.numbers)Game.cookieNumberAdd('+'+Beautify(Game.computedMouseCps,1));Game.cookieClicks++;}
Game.lastClick=new Date().getTime();}
l('bigCookie').onclick=Game.ClickCookie;Game.HowMuchPrestige=function(cookies)
{var prestige=cookies/1000000000000;prestige=Math.max(0,Math.floor((-1+Math.pow(1+8*prestige,0.5))/2));return prestige;}
Game.CalculatePrestige=function()
{var prestige=Game.HowMuchPrestige(Game.cookiesReset);Game.prestige=[];Game.prestige['Heavenly chips']=prestige;Game.prestige.ready=1;}
Game.recalculateGains=1;Game.CalculateGains=function()
{Game.cookiesPs=0;var mult=1;for(var i in Game.Upgrades)
{var me=Game.Upgrades[i];if(me.bought>0)
{if(me.type=='cookie'&&Game.Has(me.name))mult+=me.power*0.01;}}
mult+=Game.Has('Specialized chocolate chips')*0.01;mult+=Game.Has('Designer cocoa beans')*0.02;mult+=Game.Has('Underworld ovens')*0.03;mult+=Game.Has('Exotic nuts')*0.04;mult+=Game.Has('Arcane sugar')*0.05;if(!Game.prestige.ready)Game.CalculatePrestige();mult+=parseFloat(Game.prestige['Heavenly chips'])*0.01;for(var i in Game.Objects)
{var me=Game.Objects[i];me.storedCps=(typeof(me.cps)=='function'?me.cps():me.cps);me.storedTotalCps=me.amount*me.storedCps;Game.cookiesPs+=me.storedTotalCps;}
if(Game.Has('Kitten helpers'))mult*=(1+Game.milkProgress*0.05);if(Game.Has('Kitten workers'))mult*=(1+Game.milkProgress*0.1);if(Game.Has('Kitten engineers'))mult*=(1+Game.milkProgress*0.2);if(Game.Has('Kitten overseers'))mult*=(1+Game.milkProgress*0.2);if(Game.frenzy>0)mult*=Game.frenzyPower;if(Game.Has('Elder Covenant'))mult*=0.95;Game.globalCpsMult=mult;Game.cookiesPs*=Game.globalCpsMult;for(var i=0;i<Game.cpsAchievs.length/2;i++)
{if(Game.cookiesPs>=Game.cpsAchievs[i*2+1])Game.Win(Game.cpsAchievs[i*2]);}
Game.computedMouseCps=Game.mouseCps();Game.recalculateGains=0;}
Game.goldenCookie={x:0,y:0,life:0,delay:0,dur:13,toDie:1,wrath:0,chain:0,last:''};Game.goldenCookie.reset=function()
{Game.goldenCookie.life=0;Game.goldenCookie.delay=0;Game.goldenCookie.dur=13;Game.goldenCookie.toDie=1;Game.goldenCookie.last='';Game.goldenCookie.chain=0;}
Game.goldenCookie.spawn=function()
{if(Game.goldenCookie.delay!=0||Game.goldenCookie.life!=0)Game.Win('Cheated cookies taste awful');var me=l('goldenCookie');if((Game.elderWrath==1&&Math.random()<0.33)||(Game.elderWrath==2&&Math.random()<0.66)||(Game.elderWrath==3))
{Game.goldenCookie.wrath=1;me.style.background='url(img/wrathCookie.png)';}
else
{Game.goldenCookie.wrath=0;me.style.background='url(img/goldCookie.png)';}
var r=Math.floor(Math.random()*360);me.style.transform='rotate('+r+'deg)';me.style.mozTransform='rotate('+r+'deg)';me.style.webkitTransform='rotate('+r+'deg)';me.style.msTransform='rotate('+r+'deg)';me.style.oTransform='rotate('+r+'deg)';var screen=l('game').getBoundingClientRect();Game.goldenCookie.x=Math.floor(Math.random()*(screen.right-screen.left-128)+screen.left+64)-64;Game.goldenCookie.y=Math.floor(Math.random()*(screen.bottom-screen.top-128)+screen.top+64)-64;me.style.left=Game.goldenCookie.x+'px';me.style.top=Game.goldenCookie.y+'px';me.style.display='block';var dur=13;if(Game.Has('Lucky day'))dur*=2;if(Game.Has('Serendipity'))dur*=2;if(Game.goldenCookie.chain>0)dur=6;Game.goldenCookie.dur=dur;Game.goldenCookie.life=Game.fps*Game.goldenCookie.dur;me.toDie=0;}
Game.goldenCookie.update=function()
{if(Game.goldenCookie.delay==0&&Game.goldenCookie.life==0)Game.goldenCookie.spawn();if(Game.goldenCookie.life>0)
{Game.goldenCookie.life--;l('goldenCookie').style.opacity=1-Math.pow((Game.goldenCookie.life/(Game.fps*Game.goldenCookie.dur))*2-1,4);if(Game.goldenCookie.life==0||Game.goldenCookie.toDie==1)
{if(Game.goldenCookie.life==0)Game.goldenCookie.chain=0;var m=(5+Math.floor(Math.random()*10));if(Game.Has('Lucky day'))m/=2;if(Game.Has('Serendipity'))m/=2;if(Game.goldenCookie.chain>0)m=0.05;if(Game.Has('Gold hoard'))m=0.01;Game.goldenCookie.delay=Math.ceil(Game.fps*60*m);l('goldenCookie').style.display='none';if(Game.goldenCookie.toDie==0)Game.missedGoldenClicks++;Game.goldenCookie.toDie=0;Game.goldenCookie.life=0;}}
if(Game.goldenCookie.delay>0)Game.goldenCookie.delay--;}
Game.goldenCookie.choose=function()
{var list=[];if(Game.goldenCookie.wrath>0)list.push('clot','multiply cookies','ruin cookies');else list.push('frenzy','multiply cookies');if(Game.goldenCookie.wrath>0&&Math.random()<0.3)list.push('blood frenzy','chain cookie');else if(Math.random()<0.01&&Game.cookiesEarned>=100000)list.push('chain cookie');if(Math.random()<0.1)list.push('click frenzy');if(Game.goldenCookie.last!=''&&Math.random()<0.8&&list.indexOf(Game.goldenCookie.last)!=-1)list.splice(list.indexOf(Game.goldenCookie.last),1);var choice=choose(list);return choice;}
Game.goldenCookie.click=function()
{if(Game.goldenCookie.life>0)
{Game.goldenCookie.toDie=1;Game.goldenClicks++;if(Game.goldenClicks>=1)Game.Win('Golden cookie');if(Game.goldenClicks>=7)Game.Win('Lucky cookie');if(Game.goldenClicks>=27)Game.Win('A stroke of luck');if(Game.goldenClicks>=77)Game.Win('Fortune');if(Game.goldenClicks>=777)Game.Win('Leprechaun');if(Game.goldenClicks>=7777)Game.Win('Black cat\'s paw');if(Game.goldenClicks>=7)Game.Unlock('Lucky day');if(Game.goldenClicks>=27)Game.Unlock('Serendipity');if(Game.goldenClicks>=77)Game.Unlock('Get lucky');l('goldenCookie').style.display='none';var choice=Game.goldenCookie.choose();if(Game.goldenCookie.chain>0)choice='chain cookie';Game.goldenCookie.last=choice;if(choice!='chain cookie')Game.goldenCookie.chain=0;if(choice=='frenzy')
{var time=77+77*Game.Has('Get lucky');Game.frenzy=Game.fps*time;Game.frenzyPower=7;Game.recalculateGains=1;Game.Popup('Frenzy : cookie production x7 for '+time+' seconds!');}
else if(choice=='multiply cookies')
{var moni=Math.min(Game.cookies*0.1,Game.cookiesPs*60*20)+13;Game.Earn(moni);Game.Popup('Lucky! +'+Beautify(moni)+' cookies!');}
else if(choice=='ruin cookies')
{var moni=Math.min(Game.cookies*0.05,Game.cookiesPs*60*10)+13;moni=Math.min(Game.cookies,moni);Game.Spend(moni);Game.Popup('Ruin! Lost '+Beautify(moni)+' cookies!');}
else if(choice=='blood frenzy')
{var time=6+6*Game.Has('Get lucky');Game.frenzy=Game.fps*time;Game.frenzyPower=666;Game.recalculateGains=1;Game.Popup('Elder frenzy : cookie production x666 for '+time+' seconds!');}
else if(choice=='clot')
{var time=66+66*Game.Has('Get lucky');Game.frenzy=Game.fps*time;Game.frenzyPower=0.5;Game.recalculateGains=1;Game.Popup('Clot : cookie production halved for '+time+' seconds!');}
else if(choice=='click frenzy')
{var time=13+13*Game.Has('Get lucky');Game.clickFrenzy=Game.fps*time;Game.recalculateGains=1;Game.Popup('Click frenzy! Clicking power x777 for '+time+' seconds!');}
else if(choice=='chain cookie')
{Game.goldenCookie.chain++;var moni='';for(var i=0;i<Game.goldenCookie.chain;i++){moni+='6';}
moni=parseFloat(moni);Game.Popup('Cookie chain : +'+Beautify(moni)+' cookies!');if((Math.random()<0.1||Game.goldenCookie.chain>14||moni>=Game.cookies*0.5)&&Game.goldenCookie.chain>4)Game.goldenCookie.chain=0;Game.Earn(moni);}}}
l('goldenCookie').onclick=Game.goldenCookie.click;Game.cookieParticles=[];var str='';for(var i=0;i<40;i++)
{Game.cookieParticles[i]={x:0,y:0,life:-1};str+='<div id="cookieParticle'+i+'" class="cookieParticle"></div>';}
l('cookieShower').innerHTML=str;Game.cookieParticlesUpdate=function()
{for(var i in Game.cookieParticles)
{var me=Game.cookieParticles[i];if(me.life!=-1)
{me.y+=me.life*0.5+Math.random()*0.5;me.life++;var el=me.l;el.style.left=Math.floor(me.x)+'px';el.style.top=Math.floor(me.y)+'px';el.style.opacity=1-(me.life/(Game.fps*2));if(me.life>=Game.fps*2)
{me.life=-1;me.l.style.opacity=0;}}}}
Game.cookieParticleAdd=function()
{if(Game.prefs.particles)
{var highest=0;var highestI=0;for(var i in Game.cookieParticles)
{if(Game.cookieParticles[i].life==-1){highestI=i;break;}
if(Game.cookieParticles[i].life>highest)
{highest=Game.cookieParticles[i].life;highestI=i;}}
var i=highestI;var rect=l('cookieShower').getBoundingClientRect();var x=Math.floor(Math.random()*(rect.right-rect.left));var y=-32;var me=Game.cookieParticles[i];if(!me.l)me.l=l('cookieParticle'+i);me.life=0;me.x=x;me.y=y;var r=Math.floor(Math.random()*360);me.l.style.backgroundPosition=(Math.floor(Math.random()*8)*64)+'px 0px';me.l.style.transform='rotate('+r+'deg)';me.l.style.mozTransform='rotate('+r+'deg)';me.l.style.webkitTransform='rotate('+r+'deg)';me.l.style.msTransform='rotate('+r+'deg)';me.l.style.oTransform='rotate('+r+'deg)';}}
Game.cookieNumbers=[];var str='';for(var i=0;i<20;i++)
{Game.cookieNumbers[i]={x:0,y:0,life:-1,text:''};str+='<div id="cookieNumber'+i+'" class="cookieNumber title"></div>';}
l('cookieNumbers').innerHTML=str;Game.cookieNumbersUpdate=function()
{for(var i in Game.cookieNumbers)
{var me=Game.cookieNumbers[i];if(me.life!=-1)
{me.y-=me.life*0.5+Math.random()*0.5;me.life++;var el=me.l;el.style.left=Math.floor(me.x)+'px';el.style.top=Math.floor(me.y)+'px';el.style.opacity=1-(me.life/(Game.fps*1));if(me.life>=Game.fps*1)
{me.life=-1;me.l.style.opacity=0;}}}}
Game.cookieNumberAdd=function(text)
{var highest=0;var highestI=0;for(var i in Game.cookieNumbers)
{if(Game.cookieNumbers[i].life==-1){highestI=i;break;}
if(Game.cookieNumbers[i].life>highest)
{highest=Game.cookieNumbers[i].life;highestI=i;}}
var i=highestI;var x=-100+(Math.random()-0.5)*40;var y=0+(Math.random()-0.5)*40;var me=Game.cookieNumbers[i];if(!me.l)me.l=l('cookieNumber'+i);me.life=0;me.x=x;me.y=y;me.text=text;me.l.innerHTML=text;me.l.style.left=Math.floor(Game.cookieNumbers[i].x)+'px';me.l.style.top=Math.floor(Game.cookieNumbers[i].y)+'px';}
Game.particles=[];Game.particlesY=0;var str='';for(var i=0;i<20;i++)
{Game.particles[i]={x:0,y:0,life:-1,text:''};str+='<div id="particle'+i+'" class="particle title"></div>';}
l('particles').innerHTML=str;Game.particlesUpdate=function()
{Game.particlesY=0;for(var i in Game.particles)
{var me=Game.particles[i];if(me.life!=-1)
{Game.particlesY+=64;var y=me.y-(1-Math.pow(1-me.life/(Game.fps*4),10))*50;me.life++;var el=me.l;el.style.left=Math.floor(-200+me.x)+'px';el.style.bottom=Math.floor(-y)+'px';el.style.opacity=1-(me.life/(Game.fps*4));if(me.life>=Game.fps*4)
{me.life=-1;el.style.opacity=0;el.style.display='none';}}}}
Game.particlesAdd=function(text,el)
{var highest=0;var highestI=0;for(var i in Game.particles)
{if(Game.particles[i].life==-1){highestI=i;break;}
if(Game.particles[i].life>highest)
{highest=Game.particles[i].life;highestI=i;}}
var i=highestI;var x=(Math.random()-0.5)*40;var y=0;if(!el)
{var rect=l('game').getBoundingClientRect();var x=Math.floor((rect.left+rect.right)/2);var y=Math.floor((rect.bottom));x+=(Math.random()-0.5)*40;y+=0;}
var me=Game.particles[i];if(!me.l)me.l=l('particle'+i);me.life=0;me.x=x;me.y=y-Game.particlesY;me.text=text;me.l.innerHTML=text;me.l.style.left=Math.floor(Game.particles[i].x-200)+'px';me.l.style.bottom=Math.floor(-Game.particles[i].y)+'px';me.l.style.display='block';Game.particlesY+=60;}
Game.Popup=function(text)
{Game.particlesAdd(text);}
Game.veil=1;Game.veilOn=function()
{l('sectionRight').style.display='none';l('backgroundLayer2').style.background='#000 url(img/darkNoise.png)';Game.veil=1;}
Game.veilOff=function()
{l('sectionRight').style.display='block';l('backgroundLayer2').style.background='transparent';Game.veil=0;}
Game.cssClasses=[];Game.addClass=function(what){if(Game.cssClasses.indexOf(what)==-1)Game.cssClasses.push(what);Game.updateClasses();}
Game.removeClass=function(what){var i=Game.cssClasses.indexOf(what);if(i!=-1){Game.cssClasses.splice(i,1);}Game.updateClasses();}
Game.updateClasses=function(){var str='';for(var i in Game.cssClasses){str+=Game.cssClasses[i]+' ';}l('game').className=str;}
Game.WriteButton=function(prefName,button,on,off,callback)
{return'<a class="option" id="'+button+'" onclick="Game.Toggle(\''+prefName+'\',\''+button+'\',\''+on+'\',\''+off+'\');'+(callback||'')+'">'+(Game.prefs[prefName]?on:off)+'</a>';}
Game.Toggle=function(prefName,button,on,off)
{if(Game.prefs[prefName])
{l(button).innerHTML=off;l(button).className='option';Game.prefs[prefName]=0;}
else
{l(button).innerHTML=on;l(button).className='option enabled';Game.prefs[prefName]=1;}}
Game.ToggleFancy=function()
{if(Game.prefs.fancy)Game.removeClass('noFancy');else if(!Game.prefs.fancy)Game.addClass('noFancy');}
Game.onMenu='';Game.ShowMenu=function(what)
{if(!what)what='';if(Game.onMenu==''&&what!='')Game.addClass('onMenu');else if(Game.onMenu!=''&&what!=Game.onMenu)Game.addClass('onMenu');else if(what==Game.onMenu){Game.removeClass('onMenu');what='';}
if(what=='log')l('donateBox').className='on';else l('donateBox').className='';Game.onMenu=what;Game.UpdateMenu();}
Game.sayTime=function(time,detail)
{var str='';var detail=detail||0;time=Math.floor(time);if(time>=Game.fps*60*60*24*2&&detail<2)str=Beautify(time/(Game.fps*60*60*24))+' days';else if(time>=Game.fps*60*60*24&&detail<2)str='1 day';else if(time>=Game.fps*60*60*2&&detail<3)str=Beautify(time/(Game.fps*60*60))+' hours';else if(time>=Game.fps*60*60&&detail<3)str='1 hour';else if(time>=Game.fps*60*2&&detail<4)str=Beautify(time/(Game.fps*60))+' minutes';else if(time>=Game.fps*60&&detail<4)str='1 minute';else if(time>=Game.fps*2&&detail<5)str=Beautify(time/(Game.fps))+' seconds';else if(time>=Game.fps&&detail<5)str='1 second';return str;}
Game.UpdateMenu=function()
{var str='';if(Game.onMenu!='')
{str+='<div style="position:absolute;top:8px;right:8px;cursor:pointer;font-size:16px;" onclick="Game.ShowMenu(Game.onMenu);">X</div>';}
if(Game.onMenu=='prefs')
{str+='<div class="section">Menu</div>'+'<div class="subsection">'+'<div class="title">General</div>'+'<div class="listing"><a class="option" onclick="Game.WriteSave();">Save</a><label>Save manually (the game autosaves every 60 seconds)</label></div>'+'<div class="listing"><a class="option" onclick="Game.ExportSave();">Export save</a><a class="option" onclick="Game.ImportSave();">Import save</a><label>You can use this to backup your save or to transfer it to another computer</label></div>'+'<div class="listing"><a class="option warning" onclick="Game.Reset();">Reset</a><label>Reset your game (you will keep your achievements)</label></div>'+'<div class="listing"><a class="option warning" onclick="Game.HardReset();">Wipe save</a><label>Delete all your progress, including your achievements and prestige</label></div>'+'<div class="title">Settings</div>'+'<div class="listing">'+
Game.WriteButton('fancy','fancyButton','Fancy graphics ON','Fancy graphics OFF','Game.ToggleFancy();')+
Game.WriteButton('particles','particlesButton','Particles ON','Particles OFF')+
Game.WriteButton('numbers','numbersButton','Numbers ON','Numbers OFF')+
Game.WriteButton('milk','milkButton','Milk ON','Milk OFF')+'</div>'+'<div class="listing">'+Game.WriteButton('autoupdate','autoupdateButton','Offline mode OFF','Offline mode ON')+'<label>(note : this disables update notifications)</label></div>'+'</div>';}
if(Game.onMenu=='log')
{str+='<div class="section">Updates</div>'+'<div class="subsection">'+'<div class="title">Now working on :</div>'+'<div class="listing">-android port (iOS and others later)</div>'+'<div class="listing">-more dungeons</div>'+'</div><div class="subsection">'+'<div class="title">What\'s next :</div>'+'<div class="listing">-more dungeon stuff!</div>'+'<div class="listing">-more buildings and upgrades!</div>'+'<div class="listing">-revamping the prestige system!</div>'+'<div class="listing"><span class="warning">Note : this game is updated fairly frequently, which often involves rebalancing. Expect to see prices and cookies/second vary wildly from one update to another!</span></div>'+'</div><div class="subsection update">'+'<div class="title">28/09/2013 - dungeon beta</div>'+'<div class="listing">-this is a beta (it will undergo several changes before being applied to the live version)</div>'+'<div class="listing">-first dungeons! (you need 50 factories to unlock them!)</div>'+'<div class="listing">-cookie chains can be longer</div>'+'<div class="listing">-antimatter condensers are a bit more expensive</div>'+'<div class="listing">-heavenly chips now only give +1% cps each (to account for all the cookies made from condensers)</div>'+'<div class="listing">-added flavor text on all upgrades</div>'+'</div><div class="subsection update small">'+'<div class="title">15/09/2013 - anticookies</div>'+'<div class="listing">-ran out of regular matter to make your cookies? Try our new antimatter condensers!</div>'+'<div class="listing">-renamed Hard-reset to "Wipe save" to avoid confusion</div>'+'<div class="listing">-reset achievements are now regular achievements and require cookies baked all time, not cookies in bank</div>'+'<div class="listing">-heavenly chips have been nerfed a bit (and are now awarded following a geometric progression : 1 trillion for the first, 2 for the second, etc); the prestige system will be extensively reworked in a future update (after dungeons)</div>'+'<div class="listing">-golden cookie clicks are no longer reset by soft-resets</div>'+'<div class="listing">-you can now see how long you\'ve been playing in the stats</div>'+'</div><div class="subsection update small">'+'<div class="title">08/09/2013 - everlasting cookies</div>'+'<div class="listing">-added a prestige system - resetting gives you permanent CpS boosts (the more cookies made before resetting, the bigger the boost!)</div>'+'<div class="listing">-save format has been slightly modified to take less space</div>'+'<div class="listing">-Leprechaun has been bumped to 777 golden cookies clicked and is now shadow; Fortune is the new 77 golden cookies achievement</div>'+'<div class="listing">-clicking frenzy is now x777</div>'+'</div><div class="subsection update small">'+'<div class="title">04/09/2013 - smarter cookie</div>'+'<div class="listing">-golden cookies only have 20% chance of giving the same outcome twice in a row now</div>'+'<div class="listing">-added a golden cookie upgrade</div>'+'<div class="listing">-added an upgrade that makes pledges last twice as long (requires having pledged 10 times)</div>'+'<div class="listing">-Quintillion fingers is now twice as efficient</div>'+'<div class="listing">-Uncanny clicker was really too unpredictable; it is now a regular achievement and no longer requires a world record, just *pretty fast* clicking</div>'+'</div><div class="subsection update small">'+'<div class="title">02/09/2013 - a better way out</div>'+'<div class="listing">-Elder Covenant is even cheaper, and revoking it is cheaper still (also added a new achievement for getting it)</div>'+'<div class="listing">-each grandma upgrade now requires 15 of the matching building</div>'+'<div class="listing">-the dreaded bottom cursor has been fixed with a new cursor display style</div>'+'<div class="listing">-added an option for faster, cheaper graphics</div>'+'<div class="listing">-base64 encoding has been redone; this might make saving possible again on some older browsers</div>'+'<div class="listing">-shadow achievements now have their own section</div>'+'<div class="listing">-raspberry juice is now named raspberry milk, despite raspberry juice being delicious and going unquestionably well with cookies</div>'+'<div class="listing">-HOTFIX : cursors now click; fancy graphics button renamed; cookies amount now more visible against cursors</div>'+'</div><div class="subsection update small">'+'<div class="title">01/09/2013 - sorting things out</div>'+'<div class="listing">-upgrades and achievements are properly sorted in the stats screen</div>'+'<div class="listing">-made Elder Covenant much cheaper and less harmful</div>'+'<div class="listing">-importing from the first version has been disabled, as promised</div>'+'<div class="listing">-"One mind" now actually asks you to confirm the upgrade</div>'+'</div><div class="subsection update small">'+'<div class="title">31/08/2013 - hotfixes</div>'+'<div class="listing">-added a way to permanently stop the grandmapocalypse</div>'+'<div class="listing">-Elder Pledge price is now capped</div>'+'<div class="listing">-One Mind and other grandma research upgrades are now a little more powerful, if not 100% accurate</div>'+'<div class="listing">-"golden" cookie now appears again during grandmapocalypse; Elder Pledge-related achievements are now unlockable</div>'+'</div><div class="subsection update">'+'<div class="title">31/08/2013 - too many grandmas</div>'+'<div class="listing">-the grandmapocalypse is back, along with more grandma types</div>'+'<div class="listing">-added some upgrades that boost your clicking power and make it scale with your cps</div>'+'<div class="listing">-clicking achievements made harder; Neverclick is now a shadow achievement; Uncanny clicker should now truly be a world record</div>'+'</div><div class="subsection update small">'+'<div class="title">28/08/2013 - over-achiever</div>'+'<div class="listing">-added a few more achievements</div>'+'<div class="listing">-reworked the "Bake X cookies" achievements so they take longer to achieve</div>'+'</div><div class="subsection update small">'+'<div class="title">27/08/2013 - a bad idea</div>'+'<div class="listing">-due to popular demand, retired 5 achievements (the "reset your game" and "cheat" ones); they can still be unlocked, but do not count toward your total anymore. Don\'t worry, there will be many more achievements soon!</div>'+'<div class="listing">-made some achievements hidden for added mystery</div>'+'</div><div class="subsection update">'+'<div class="title">27/08/2013 - a sense of achievement</div>'+'<div class="listing">-added achievements (and milk)</div>'+'<div class="listing"><i>(this is a big update, please don\'t get too mad if you lose some data!)</i></div>'+'</div><div class="subsection update small">'+'<div class="title">26/08/2013 - new upgrade tier</div>'+'<div class="listing">-added some more upgrades (including a couple golden cookie-related ones)</div>'+'<div class="listing">-added clicking stats</div>'+'</div><div class="subsection update small">'+'<div class="title">26/08/2013 - more tweaks</div>'+'<div class="listing">-tweaked a couple cursor upgrades</div>'+'<div class="listing">-made time machines less powerful</div>'+'<div class="listing">-added offline mode option</div>'+'</div><div class="subsection update small">'+'<div class="title">25/08/2013 - tweaks</div>'+'<div class="listing">-rebalanced progression curve (mid- and end-game objects cost more and give more)</div>'+'<div class="listing">-added some more cookie upgrades</div>'+'<div class="listing">-added CpS for cursors</div>'+'<div class="listing">-added sell button</div>'+'<div class="listing">-made golden cookie more useful</div>'+'</div><div class="subsection update small">'+'<div class="title">24/08/2013 - hotfixes</div>'+'<div class="listing">-added import/export feature, which also allows you to retrieve a save game from the old version (will be disabled in a week to prevent too much cheating)</div>'+'<div class="listing">-upgrade store now has unlimited slots (just hover over it), due to popular demand</div>'+'<div class="listing">-added update log</div>'+'</div><div class="subsection update">'+'<div class="title">24/08/2013 - big update!</div>'+'<div class="listing">-revamped the whole game (new graphics, new game mechanics)</div>'+'<div class="listing">-added upgrades</div>'+'<div class="listing">-much safer saving</div>'+'</div><div class="subsection update">'+'<div class="title">08/08/2013 - game launch</div>'+'<div class="listing">-made the game in a couple hours, for laughs</div>'+'<div class="listing">-kinda starting to regret it</div>'+'<div class="listing">-ah well</div>'+'</div>';}
else if(Game.onMenu=='stats')
{var buildingsOwned=0;buildingsOwned=Game.BuildingsOwned;var upgrades='';var cookieUpgrades='';var upgradesTotal=0;var upgradesOwned=0;var list=[];for(var i in Game.Upgrades)
{list.push(Game.Upgrades[i]);}
var sortMap=function(a,b)
{if(a.order>b.order)return 1;else if(a.order<b.order)return-1;else return 0;}
list.sort(sortMap);for(var i in list)
{var str2='';var me=list[i];if(!Game.Has('Neuromancy'))
{if(me.bought>0&&me.hide!=3)
{str2+='<div class="crate upgrade enabled" '+Game.getTooltip('<div style="min-width:200px;"><div style="float:right;"><span class="price">'+Beautify(Math.round(me.basePrice))+'</span></div><small>[Upgrade] [Purchased]</small><div class="name">'+me.name+'</div><div class="description">'+me.desc+'</div></div>',0,0,'bottom-right')+' style="background-position:'+(-me.icon[0]*48+6)+'px '+(-me.icon[1]*48+6)+'px;"></div>';upgradesOwned++;}}
else
{str2+='<div onclick="Game.UpgradesById['+me.id+'].toggle();" class="crate upgrade'+(me.bought>0?' enabled':'')+'" '+Game.getTooltip('<div style="min-width:200px;"><div style="float:right;"><span class="price">'+Beautify(Math.round(me.basePrice))+'</span></div><small>[Upgrade]'+(me.bought>0?' [Purchased]':'')+'</small><div class="name">'+me.name+'</div><div class="description">'+me.desc+'</div></div>',0,0,'bottom-right')+' style="background-position:'+(-me.icon[0]*48+6)+'px '+(-me.icon[1]*48+6)+'px;"></div>';upgradesOwned++;}
if(me.hide!=3)upgradesTotal++;if(me.type=='cookie')cookieUpgrades+=str2;else upgrades+=str2;}
var achievements='';var shadowAchievements='';var achievementsOwned=0;var achievementsTotal=0;var list=[];for(var i in Game.Achievements)
{list.push(Game.Achievements[i]);}
var sortMap=function(a,b)
{if(a.order>b.order)return 1;else if(a.order<b.order)return-1;else return 0;}
list.sort(sortMap);for(var i in list)
{var me=list[i];if(!me.disabled&&me.hide!=3||me.won>0)achievementsTotal++;if(me.won>0&&me.hide==3)
{shadowAchievements+='<div class="crate achievement enabled" '+Game.getTooltip('<div style="min-width:200px;"><small>[Achievement] [Unlocked]'+(me.hide==3?' [Shadow]':'')+'</small><div class="name">'+me.name+'</div><div class="description">'+me.desc+'</div></div>',0,0,'bottom-right')+' style="background-position:'+(-me.icon[0]*48+6)+'px '+(-me.icon[1]*48+6)+'px;"></div>';achievementsOwned++;}
else if(me.won>0)
{achievements+='<div class="crate achievement enabled" '+Game.getTooltip('<div style="min-width:200px;"><small>[Achievement] [Unlocked]'+(me.hide==3?' [Shadow]':'')+'</small><div class="name">'+me.name+'</div><div class="description">'+me.desc+'</div></div>',0,0,'bottom-right')+' style="background-position:'+(-me.icon[0]*48+6)+'px '+(-me.icon[1]*48+6)+'px;"></div>';achievementsOwned++;}
else if(me.hide==0)
{achievements+='<div class="crate achievement" '+Game.getTooltip('<div style="min-width:200px;"><small>[Achievement]</small><div class="name">'+me.name+'</div><div class="description">'+me.desc+'</div></div>',0,0,'bottom-right')+' style="background-position:'+(-me.icon[0]*48+6)+'px '+(-me.icon[1]*48+6)+'px;"></div>';}
else if(me.hide==1)
{achievements+='<div class="crate achievement" '+Game.getTooltip('<div style="min-width:200px;"><small>[Achievement]</small><div class="name">'+me.name+'</div><div class="description">???</div></div>',0,0,'bottom-right')+' style="background-position:'+(-0*48+6)+'px '+(-7*48+6)+'px;"></div>';}
else if(me.hide==2)
{achievements+='<div class="crate achievement" '+Game.getTooltip('<div style="min-width:200px;"><small>[Achievement]</small><div class="name">???</div><div class="description">???</div></div>',0,0,'bottom-right')+' style="background-position:'+(-0*48+6)+'px '+(-7*48+6)+'px;"></div>';}}
var milkName='plain milk';if(Game.milkProgress>=2.5)milkName='raspberry milk';else if(Game.milkProgress>=1.5)milkName='chocolate milk';var researchStr=Game.sayTime(Game.researchT);var pledgeStr=Game.sayTime(Game.pledgeT);var wrathStr='';if(Game.elderWrath==1)wrathStr='awoken';else if(Game.elderWrath==2)wrathStr='displeased';else if(Game.elderWrath==3)wrathStr='angered';else if(Game.elderWrath==0&&Game.pledges>0)wrathStr='appeased';var date=new Date();date.setTime(new Date().getTime()-Game.startDate);date=Game.sayTime(date.getTime()/1000*Game.fps,2);str+='<div class="section">Statistics</div>'+'<div class="subsection">'+'<div class="title">General</div>'+'<div class="listing"><b>Cookies in bank :</b> <div class="price plain">'+Beautify(Game.cookies)+'</div></div>'+'<div class="listing"><b>Cookies baked (this game) :</b> <div class="price plain">'+Beautify(Game.cookiesEarned)+'</div></div>'+'<div class="listing"><b>Cookies baked (all time) :</b> <div class="price plain">'+Beautify(Game.cookiesEarned+Game.cookiesReset)+'</div></div>'+
(Game.cookiesReset>0?'<div class="listing"><b>Cookies forfeited by resetting :</b> <div class="price plain">'+Beautify(Game.cookiesReset)+'</div></div>':'')+'<div class="listing"><b>Game started :</b> '+date+' ago</div>'+'<div class="listing"><b>Buildings owned :</b> '+Beautify(buildingsOwned)+'</div>'+'<div class="listing"><b>Cookies per second :</b> '+Beautify(Game.cookiesPs,1)+' <small>(multiplier : '+Beautify(Math.round(Game.globalCpsMult*100),1)+'%)</small></div>'+'<div class="listing"><b>Cookies per click :</b> '+Beautify(Game.computedMouseCps,1)+'</div>'+'<div class="listing"><b>Cookie clicks :</b> '+Beautify(Game.cookieClicks)+'</div>'+'<div class="listing"><b>Hand-made cookies :</b> '+Beautify(Game.handmadeCookies)+'</div>'+'<div class="listing"><b>Golden cookie clicks :</b> '+Beautify(Game.goldenClicks)+'</div>'+'<br><div class="listing"><b>Running version :</b> '+Game.version+'</div>'+
((researchStr!=''||wrathStr!=''||pledgeStr!='')?('</div><div class="subsection">'+'<div class="title">Special</div>'+
(researchStr!=''?'<div class="listing"><b>Research :</b> '+researchStr+' remaining</div>':'')+
(wrathStr!=''?'<div class="listing"><b>Grandmatriarchs status :</b> '+wrathStr+'</div>':'')+
(pledgeStr!=''?'<div class="listing"><b>Pledge :</b> '+pledgeStr+' remaining</div>':'')+''):'')+
(Game.prestige['Heavenly chips']>0?('</div><div class="subsection">'+'<div class="title">Prestige</div>'+'<div class="listing"><small>(Note : each heavenly chip grants you +2% CpS multiplier. You can gain more chips by resetting with a lot of cookies.)</small></div>'+'<div class="listing"><div class="icon" style="background-position:'+(-19*48)+'px '+(-7*48)+'px;"></div> <span style="vertical-align:100%;"><span class="title" style="font-size:22px;">'+Game.prestige['Heavenly chips']+' heavenly chip'+(Game.prestige['Heavenly chips']==1?'':'s')+'</span> (+'+(Game.prestige['Heavenly chips']*2)+'% CpS)</span></div>'):'')+'</div><div class="subsection">'+'<div class="title">Upgrades unlocked</div>'+'<div class="listing"><b>Unlocked :</b> '+upgradesOwned+'/'+upgradesTotal+' ('+Math.round((upgradesOwned/upgradesTotal)*100)+'%)</div>'+'<div class="listing" style="overflow-y:hidden;">'+upgrades+'</div>'+
(cookieUpgrades!=''?('<div class="listing"><b>Cookies</b></div>'+'<div class="listing" style="overflow-y:hidden;">'+cookieUpgrades+'</div>'):'')+'</div><div class="subsection" style="padding-bottom:128px;">'+'<div class="title">Achievements</div>'+'<div class="listing"><b>Unlocked :</b> '+achievementsOwned+'/'+achievementsTotal+' ('+Math.round((achievementsOwned/achievementsTotal)*100)+'%)</div>'+'<div class="listing"><b>Milk :</b> '+Math.round(Game.milkProgress*100)+'% ('+milkName+') <small>(Note : you gain milk through achievements. Milk can unlock unique upgrades over time.)</small></div>'+'<div class="listing" style="overflow-y:hidden;">'+achievements+'</div>'+
(shadowAchievements!=''?('<div class="listing"><b>Shadow achievements</b> <small>(These are feats that are either unfair or difficult to attain. They do not give milk.)</small></div>'+'<div class="listing" style="overflow-y:hidden;">'+shadowAchievements+'</div>'):'')+'</div>';}
l('menu').innerHTML=str;}
l('prefsButton').onclick=function(){Game.ShowMenu('prefs');};l('statsButton').onclick=function(){Game.ShowMenu('stats');};l('logButton').onclick=function(){Game.ShowMenu('log');};Game.tooltip={text:'',x:0,y:0,origin:0,on:0};Game.tooltip.draw=function(from,text,x,y,origin)
{this.text=text;this.x=x;this.y=y;this.origin=origin;var tt=l('tooltip');var tta=l('tooltipAnchor');tta.style.display='block';var rect=from.getBoundingClientRect();var x=0,y=0;tt.style.left='auto';tt.style.top='auto';tt.style.right='auto';tt.style.bottom='auto';tta.style.left='auto';tta.style.top='auto';tta.style.right='auto';tta.style.bottom='auto';tt.style.width='auto';tt.style.height='auto';if(this.origin=='left')
{x=rect.left;y=rect.top;tt.style.right='0';tt.style.top='0';}
else if(this.origin=='bottom-right')
{x=rect.right;y=rect.bottom;tt.style.right='0';tt.style.top='0';}
else{alert('Tooltip anchor '+this.origin+' needs to be implemented');}
tta.style.left=Math.floor(x+this.x)+'px';tta.style.top=Math.floor(y-32+this.y)+'px';tt.innerHTML=unescape(text);this.on=1;}
Game.tooltip.hide=function()
{l('tooltipAnchor').style.display='none';this.on=0;}
Game.getTooltip=function(text,x,y,origin)
{origin=(origin?origin:'middle');return'onMouseOut="Game.tooltip.hide();" onMouseOver="Game.tooltip.draw(this,\''+escape(text)+'\','+x+','+y+',\''+origin+'\');"';}
Game.Ticker='';Game.TickerAge=0;Game.TickerN=0;Game.getNewTicker=function()
{var list=[];if(Game.TickerN%2==0||Game.cookiesEarned>=10100000000)
{if(Game.Objects['Grandma'].amount>0)list.push(choose(['<q>Moist cookies.</q><sig>grandma</sig>','<q>We\'re nice grandmas.</q><sig>grandma</sig>','<q>Indentured servitude.</q><sig>grandma</sig>','<q>Come give grandma a kiss.</q><sig>grandma</sig>','<q>Why don\'t you visit more often?</q><sig>grandma</sig>','<q>Call me...</q><sig>grandma</sig>']));if(Game.Objects['Grandma'].amount>=50)list.push(choose(['<q>Absolutely disgusting.</q><sig>grandma</sig>','<q>You make me sick.</q><sig>grandma</sig>','<q>You disgust me.</q><sig>grandma</sig>','<q>We rise.</q><sig>grandma</sig>','<q>It begins.</q><sig>grandma</sig>','<q>It\'ll all be over soon.</q><sig>grandma</sig>','<q>You could have stopped it.</q><sig>grandma</sig>']));if(Game.HasAchiev('Just wrong'))list.push(choose(['News : cookie manufacturer downsizes, sells own grandmother!','<q>It has betrayed us, the filthy little thing.</q><sig>grandma</sig>','<q>It tried to get rid of us, the nasty little thing.</q><sig>grandma</sig>','<q>It thought we would go away by selling us. How quaint.</q><sig>grandma</sig>','<q>I can smell your rotten cookies.</q><sig>grandma</sig>']));if(Game.Objects['Grandma'].amount>=1&&Game.pledges>0&&Game.elderWrath==0)list.push(choose(['<q>shrivel</q><sig>grandma</sig>','<q>writhe</q><sig>grandma</sig>','<q>throb</q><sig>grandma</sig>','<q>gnaw</q><sig>grandma</sig>','<q>We will rise again.</q><sig>grandma</sig>','<q>A mere setback.</q><sig>grandma</sig>','<q>We are not satiated.</q><sig>grandma</sig>','<q>Too late.</q><sig>grandma</sig>']));if(Game.Objects['Farm'].amount>0)list.push(choose(['News : cookie farms suspected of employing undeclared elderly workforce!','News : cookie farms release harmful chocolate in our rivers, says scientist!','News : genetically-modified chocolate controversy strikes cookie farmers!','News : free-range farm cookies popular with today\'s hip youth, says specialist.','News : farm cookies deemed unfit for vegans, says nutritionist.']));if(Game.Objects['Factory'].amount>0)list.push(choose(['News : cookie factories linked to global warming!','News : cookie factories involved in chocolate weather controversy!','News : cookie factories on strike, robotic minions employed to replace workforce!','News : cookie factories on strike - workers demand to stop being paid in cookies!','News : factory-made cookies linked to obesity, says study.']));if(Game.Objects['Mine'].amount>0)list.push(choose(['News : '+Math.floor(Math.random()*1000+2)+' miners dead in chocolate mine catastrophe!','News : '+Math.floor(Math.random()*1000+2)+' miners trapped in collapsed chocolate mine!','News : chocolate mines found to cause earthquakes and sink holes!','News : chocolate mine goes awry, floods village in chocolate!','News : depths of chocolate mines found to house "peculiar, chocolaty beings"!']));if(Game.Objects['Shipment'].amount>0)list.push(choose(['News : new chocolate planet found, becomes target of cookie-trading spaceships!','News : massive chocolate planet found with 99.8% certified pure dark chocolate core!','News : space tourism booming as distant planets attract more bored millionaires!','News : chocolate-based organisms found on distant planet!','News : ancient baking artifacts found on distant planet; "terrifying implications", experts say.']));if(Game.Objects['Alchemy lab'].amount>0)list.push(choose(['News : national gold reserves dwindle as more and more of the precious mineral is turned to cookies!','News : chocolate jewelry found fashionable, gold and diamonds "just a fad", says specialist.','News : silver found to also be transmutable into white chocolate!','News : defective alchemy lab shut down, found to convert cookies to useless gold.','News : alchemy-made cookies shunned by purists!']));if(Game.Objects['Portal'].amount>0)list.push(choose(['News : nation worried as more and more unsettling creatures emerge from dimensional portals!','News : dimensional portals involved in city-engulfing disaster!','News : tourism to cookieverse popular with bored teenagers! Casualty rate as high as 73%!','News : cookieverse portals suspected to cause fast aging and obsession with baking, says study.','News : "do not settle near portals," says specialist; "your children will become strange and corrupted inside."']));if(Game.Objects['Time machine'].amount>0)list.push(choose(['News : time machines involved in history-rewriting scandal! Or are they?','News : time machines used in unlawful time tourism!','News : cookies brought back from the past "unfit for human consumption", says historian.','News : various historical figures inexplicably replaced with talking lumps of dough!','News : "I have seen the future," says time machine operator, "and I do not wish to go there again."']));if(Game.Objects['Antimatter condenser'].amount>0)list.push(choose(['News : whole town seemingly swallowed by antimatter-induced black hole; more reliable sources affirm town "never really existed"!','News : "explain to me again why we need particle accelerators to bake cookies?" asks misguided local woman.','News : first antimatter condenser successfully turned on, doesn\'t rip apart reality!','News : researchers conclude that what the cookie industry needs, first and foremost, is "more magnets".','News : "unravelling the fabric of reality just makes these cookies so much tastier", claims scientist.']));if(Game.HasAchiev('Base 10'))list.push('News : cookie manufacturer completely forgoes common sense, lets OCD drive building decisions!');if(Game.HasAchiev('From scratch'))list.push('News : follow the tear-jerking, riches-to-rags story about a local cookie manufacturer who decided to give it all up!');if(Game.HasAchiev('A world filled with cookies'))list.push('News : known universe now jammed with cookies! No vacancies!');if(Game.HasAchiev('Serendipity'))list.push('News : local cookie manufacturer becomes luckiest being alive!');if(Game.Has('Kitten helpers'))list.push('News : faint meowing heard around local cookie facilities; suggests new ingredient being tested.');if(Game.Has('Kitten workers'))list.push('News : crowds of meowing kittens with little hard hats reported near local cookie facilities.');if(Game.Has('Kitten engineers'))list.push('News : surroundings of local cookie facilities now overrun with kittens in adorable little suits. Authorities advise to stay away from the premises.');if(Game.Has('Kitten overseers'))list.push('News : locals report troups of bossy kittens meowing adorable orders at passerbys.');var animals=['newts','penguins','scorpions','axolotls','puffins','porpoises','blowfish','horses','crayfish','slugs','humpback whales','nurse sharks','giant squids','polar bears','fruit bats','frogs','sea squirts','velvet worms','mole rats','paramecia','nematodes','tardigrades','giraffes'];if(Game.cookiesEarned>=10000)list.push('News : '+choose(['cookies found to '+choose(['increase lifespan','sensibly increase intelligence','reverse aging','decrease hair loss','prevent arthritis','cure blindness'])+' in '+choose(animals)+'!','cookies found to make '+choose(animals)+' '+choose(['more docile','more handsome','nicer','less hungry','more pragmatic','tastier'])+'!','cookies tested on '+choose(animals)+', found to have no ill effects.','cookies unexpectedly popular among '+choose(animals)+'!','unsightly lumps found on '+choose(animals)+' near cookie facility; "they\'ve pretty much always looked like that", say biologists.','new species of '+choose(animals)+' discovered in distant country; "yup, tastes like cookies", says biologist.','cookies go well with roasted '+choose(animals)+', says controversial chef.','"do your cookies contain '+choose(animals)+'?", asks PSA warning against counterfeit cookies.']),'News : "'+choose(['I\'m all about cookies','I just can\'t stop eating cookies. I think I seriously need help','I guess I have a cookie problem','I\'m not addicted to cookies. That\'s just speculation by fans with too much free time','my upcoming album contains 3 songs about cookies','I\'ve had dreams about cookies 3 nights in a row now. I\'m a bit worried honestly','accusations of cookie abuse are only vile slander','cookies really helped me when I was feeling low','cookies are the secret behind my perfect skin','cookies helped me stay sane while filming my upcoming movie','cookies helped me stay thin and healthy','I\'ll say one word, just one : cookies','alright, I\'ll say it - I\'ve never eaten a single cookie in my life'])+'", reveals celebrity.','News : '+choose(['doctors recommend twice-daily consumption of fresh cookies.','doctors warn against chocolate chip-snorting teen fad.','doctors advise against new cookie-free fad diet.','doctors warn mothers about the dangers of "home-made cookies".']),choose(['News : scientist predicts imminent cookie-related "end of the world"; becomes joke among peers.','News : man robs bank, buys cookies.','News : what makes cookies taste so right? "Probably all the [*****] they put in them", says anonymous tipper.','News : man found allergic to cookies; "what a weirdo", says family.','News : foreign politician involved in cookie-smuggling scandal.','News : cookies now more popular than '+choose(['cough drops','broccoli','smoked herring','cheese','video games','stable jobs','relationships','time travel','cat videos','tango','fashion','television','nuclear warfare','whatever it is we ate before','politics','oxygen','lamps'])+', says study.','News : obesity epidemic strikes nation; experts blame '+choose(['twerking','that darn rap music','video-games','lack of cookies','mysterious ghostly entities','aliens','parents','schools','comic-books','cookie-snorting fad'])+'.','News : cookie shortage strikes town, people forced to eat cupcakes; "just not the same", concedes mayor.','News : "you gotta admit, all this cookie stuff is a bit ominous", says confused idiot.','News : movie cancelled from lack of actors; "everybody\'s at home eating cookies", laments director.','News : comedian forced to cancel cookie routine due to unrelated indigestion.','News : new cookie-based religion sweeps the nation.','News : fossil records show cookie-based organisms prevalent during Cambrian explosion, scientists say.','News : mysterious illegal cookies seized; "tastes terrible", says police.','News : man found dead after ingesting cookie; investigators favor "mafia snitch" hypothesis.','News : "the universe pretty much loops on itself," suggests researcher; "it\'s cookies all the way down."','News : minor cookie-related incident turns whole town to ashes; neighboring cities asked to chip in for reconstruction.','News : is our media controlled by the cookie industry? This could very well be the case, says crackpot conspiracy theorist.','News : '+choose(['cookie-flavored popcorn pretty damn popular; "we kinda expected that", say scientists.','cookie-flavored cereals break all known cereal-related records','cookies popular among all age groups, including fetuses, says study.','cookie-flavored popcorn sales exploded during screening of Grandmothers II : The Moistening.']),'News : all-cookie restaurant opening downtown. Dishes such as braised cookies, cookie thermidor, and for dessert : crepes.','News : cookies could be the key to '+choose(['eternal life','infinite riches','eternal youth','eternal beauty','curing baldness','world peace','solving world hunger','ending all wars world-wide','making contact with extraterrestrial life','mind-reading','better living','better eating','more interesting TV shows','faster-than-light travel','quantum baking','chocolaty goodness','gooder thoughtness'])+', say scientists.']));}
if(list.length==0)
{if(Game.cookiesEarned<5)list.push('You feel like making cookies. But nobody wants to eat your cookies.');else if(Game.cookiesEarned<50)list.push('Your first batch goes to the trash. The neighborhood raccoon barely touches it.');else if(Game.cookiesEarned<100)list.push('Your family accepts to try some of your cookies.');else if(Game.cookiesEarned<500)list.push('Your cookies are popular in the neighborhood.');else if(Game.cookiesEarned<1000)list.push('People are starting to talk about your cookies.');else if(Game.cookiesEarned<3000)list.push('Your cookies are talked about for miles around.');else if(Game.cookiesEarned<6000)list.push('Your cookies are renowned in the whole town!');else if(Game.cookiesEarned<10000)list.push('Your cookies bring all the boys to the yard.');else if(Game.cookiesEarned<20000)list.push('Your cookies now have their own website!');else if(Game.cookiesEarned<30000)list.push('Your cookies are worth a lot of money.');else if(Game.cookiesEarned<40000)list.push('Your cookies sell very well in distant countries.');else if(Game.cookiesEarned<60000)list.push('People come from very far away to get a taste of your cookies.');else if(Game.cookiesEarned<80000)list.push('Kings and queens from all over the world are enjoying your cookies.');else if(Game.cookiesEarned<100000)list.push('There are now museums dedicated to your cookies.');else if(Game.cookiesEarned<200000)list.push('A national day has been created in honor of your cookies.');else if(Game.cookiesEarned<300000)list.push('Your cookies have been named a part of the world wonders.');else if(Game.cookiesEarned<450000)list.push('History books now include a whole chapter about your cookies.');else if(Game.cookiesEarned<600000)list.push('Your cookies have been placed under government surveillance.');else if(Game.cookiesEarned<1000000)list.push('The whole planet is enjoying your cookies!');else if(Game.cookiesEarned<5000000)list.push('Strange creatures from neighboring planets wish to try your cookies.');else if(Game.cookiesEarned<10000000)list.push('Elder gods from the whole cosmos have awoken to taste your cookies.');else if(Game.cookiesEarned<30000000)list.push('Beings from other dimensions lapse into existence just to get a taste of your cookies.');else if(Game.cookiesEarned<100000000)list.push('Your cookies have achieved sentience.');else if(Game.cookiesEarned<300000000)list.push('The universe has now turned into cookie dough, to the molecular level.');else if(Game.cookiesEarned<1000000000)list.push('Your cookies are rewriting the fundamental laws of the universe.');else if(Game.cookiesEarned<10000000000)list.push('A local news station runs a 10-minute segment about your cookies. Success!<br><span style="font-size:50%;">(you win a cookie)</span>');else if(Game.cookiesEarned<10100000000)list.push('it\'s time to stop playing');}
if(Game.elderWrath>0&&(Game.pledges==0||Math.random()<0.5))
{list=[];if(Game.elderWrath==1)list.push(choose(['News : millions of old ladies reported missing!','News : processions of old ladies sighted around cookie facilities!','News : families around the continent report agitated, transfixed grandmothers!','News : doctors swarmed by cases of old women with glassy eyes and a foamy mouth!','News : nurses report "strange scent of cookie dough" around female elderly patients!']));if(Game.elderWrath==2)list.push(choose(['News : town in disarray as strange old ladies break into homes to abduct infants and baking utensils!','News : sightings of old ladies with glowing eyes terrify local population!','News : retirement homes report "female residents slowly congealing in their seats"!','News : whole continent undergoing mass exodus of old ladies!','News : old women freeze in place in streets, ooze warm sugary syrup!']));if(Game.elderWrath==3)list.push(choose(['News : large "flesh highways" scar continent, stretch between various cookie facilities!','News : wrinkled "flesh tendrils" visible from space!','News : remains of "old ladies" found frozen in the middle of growing fleshy structures!','News : all hope lost as writhing mass of flesh and dough engulfs whole city!','News : nightmare continues as wrinkled acres of flesh expand at alarming speeds!']));}
Game.TickerAge=Game.fps*10;Game.Ticker=choose(list);Game.TickerN++;}
Game.TickerDraw=function()
{var str='';var o=0;if(Game.Ticker!='')
{if(Game.TickerAge<Game.fps*1&&1==2)
{str=Game.Ticker.substring(0,(Game.Ticker+'<').indexOf('<'));str=str.substring(0,str.length*Math.min(1,Game.TickerAge/(Game.fps*1)));}
else str=Game.Ticker;}
l('commentsText').innerHTML=str;}
Game.storeToRebuild=1;Game.priceIncrease=1.15;Game.Objects=[];Game.ObjectsById=[];Game.ObjectsN=0;Game.BuildingsOwned=0;Game.Object=function(name,commonName,desc,pic,icon,background,price,cps,drawFunction,buyFunction)
{this.id=Game.ObjectsN;this.name=name;this.displayName=this.name;commonName=commonName.split('|');this.single=commonName[0];this.plural=commonName[1];this.actionName=commonName[2];this.desc=desc;this.basePrice=price;this.price=this.basePrice;this.cps=cps;this.totalCookies=0;this.storedCps=0;this.storedTotalCps=0;this.pic=pic;this.icon=icon;this.background=background;this.buyFunction=buyFunction;this.drawFunction=drawFunction;this.special=null;this.onSpecial=0;this.specialUnlocked=0;this.specialDrawFunction=null;this.drawSpecialButton=null;this.amount=0;this.bought=0;this.buy=function()
{var price=this.basePrice*Math.pow(Game.priceIncrease,this.amount);if(Game.cookies>=price)
{Game.Spend(price);this.amount++;this.bought++;price=this.basePrice*Math.pow(Game.priceIncrease,this.amount);this.price=price;if(this.buyFunction)this.buyFunction();if(this.drawFunction)this.drawFunction();Game.storeToRebuild=1;Game.recalculateGains=1;if(this.amount==1&&this.id!=0)l('row'+this.id).className='row enabled';Game.BuildingsOwned++;}}
this.sell=function()
{var price=this.basePrice*Math.pow(Game.priceIncrease,this.amount);price=Math.floor(price*0.5);if(this.amount>0)
{Game.cookies+=price;this.amount--;price=this.basePrice*Math.pow(Game.priceIncrease,this.amount);this.price=price;if(this.sellFunction)this.sellFunction();if(this.drawFunction)this.drawFunction();Game.storeToRebuild=1;Game.recalculateGains=1;Game.BuildingsOwned--;}}
this.setSpecial=function(what)
{if(what==1)this.onSpecial=1;else this.onSpecial=0;if(this.id!=0)
{if(this.onSpecial)
{l('rowSpecial'+this.id).style.display='block';if(this.specialDrawFunction)this.specialDrawFunction();}
else
{l('rowSpecial'+this.id).style.display='none';if(this.drawFunction)this.drawFunction();}}}
this.unlockSpecial=function()
{if(this.specialUnlocked==0)
{this.specialUnlocked=1;this.setSpecial(0);if(this.special)this.special();this.refresh();}}
this.refresh=function()
{this.price=this.basePrice*Math.pow(Game.priceIncrease,this.amount);if(this.amount==0&&this.id!=0)l('row'+this.id).className='row';else if(this.amount>0&&this.id!=0)l('row'+this.id).className='row enabled';if(this.drawFunction&&!this.onSpecial)this.drawFunction();}
if(this.id!=0)
{var str='<div class="row" id="row'+this.id+'"><div class="separatorBottom"></div><div class="content"><div id="rowBackground'+this.id+'" class="background" style="background:url(img/'+this.background+'.png) repeat-x;"><div class="backgroundLeft"></div><div class="backgroundRight"></div></div><div class="objects" id="rowObjects'+this.id+'"> </div></div><div class="special" id="rowSpecial'+this.id+'"></div><div class="specialButton" id="rowSpecialButton'+this.id+'"></div><div class="info" id="rowInfo'+this.id+'"><div class="infoContent" id="rowInfoContent'+this.id+'"></div><div><a onclick="Game.ObjectsById['+this.id+'].sell();">Sell 1</a></div></div></div>';l('rows').innerHTML=l('rows').innerHTML+str;}
Game.Objects[this.name]=this;Game.ObjectsById[this.id]=this;Game.ObjectsN++;return this;}
Game.NewDrawFunction=function(pic,xVariance,yVariance,w,shift,heightOffset)
{return function()
{if(pic==0&&typeof(pic)!='function')pic=this.pic;shift=shift||1;heightOffset=heightOffset||0;var bgW=0;var str='';var offX=0;var offY=0;if(this.drawSpecialButton&&this.specialUnlocked)
{l('rowSpecialButton'+this.id).style.display='block';l('rowSpecialButton'+this.id).innerHTML=this.drawSpecialButton();str+='<div style="width:128px;height:128px;">'+this.drawSpecialButton()+'</div>';l('rowInfo'+this.id).style.paddingLeft=(8+128)+'px';offX+=128;}
for(var i=0;i<this.amount;i++)
{if(shift!=1)
{var x=Math.floor(i/shift)*w+((i%shift)/shift)*w+Math.floor((Math.random()-0.5)*xVariance)+offX;var y=32+heightOffset+Math.floor((Math.random()-0.5)*yVariance)+((-shift/2)*32/2+(i%shift)*32/2)+offY;}
else
{var x=i*w+Math.floor((Math.random()-0.5)*xVariance)+offX;var y=32+heightOffset+Math.floor((Math.random()-0.5)*yVariance)+offY;}
var usedPic=(typeof(pic)=='function'?pic():pic);str+='<div class="object" style="background:url(img/'+usedPic+'.png);left:'+x+'px;top:'+y+'px;z-index:'+Math.floor(1000+y)+';"></div>';bgW=Math.max(bgW,x+64);}
bgW+=offX;l('rowObjects'+this.id).innerHTML=str;l('rowBackground'+this.id).style.width=bgW+'px';}}
Game.RebuildStore=function()
{var str='';for(var i in Game.Objects)
{var me=Game.Objects[i];str+='<div class="product" '+Game.getTooltip('<div style="min-width:300px;"><div style="float:right;"><span class="price">'+Beautify(Math.round(me.price))+'</span></div><div class="name">'+me.name+'</div>'+'<small>[owned : '+me.amount+'</small>]<div class="description">'+me.desc+'</div></div>',0,0,'left')+' onclick="Game.ObjectsById['+me.id+'].buy();" id="product'+me.id+'"><div class="icon" style="background-image:url(img/'+me.icon+'.png);"></div><div class="content"><div class="title">'+me.displayName+'</div><span class="price">'+Beautify(Math.round(me.price))+'</span>'+(me.amount>0?('<div class="title owned">'+me.amount+'</div>'):'')+'</div></div>';}
l('products').innerHTML=str;Game.storeToRebuild=0;}
Game.ComputeCps=function(base,add,mult,bonus)
{if(!bonus)bonus=0;return((base+add)*(Math.pow(2,mult))+bonus);}
new Game.Object('Cursor','cursor|cursors|clicked','Autoclicks once every 10 seconds.','cursor','cursoricon','',15,function(){var add=0;if(Game.Has('Thousand fingers'))add+=0.1;if(Game.Has('Million fingers'))add+=0.5;if(Game.Has('Billion fingers'))add+=2;if(Game.Has('Trillion fingers'))add+=10;if(Game.Has('Quadrillion fingers'))add+=20;if(Game.Has('Quintillion fingers'))add+=100;var num=0;for(var i in Game.Objects){if(Game.Objects[i].name!='Cursor')num+=Game.Objects[i].amount;}
add=add*num;return Game.ComputeCps(0.1,Game.Has('Reinforced index finger')*0.1,Game.Has('Carpal tunnel prevention cream')+Game.Has('Ambidextrous'),add);},function(){var str='';for(var i=0;i<this.amount;i++)
{var n=Math.floor(i/50);var a=((i+0.5*n)%50)/50;var x=Math.floor(Math.sin(a*Math.PI*2)*(140+n*16))-16;var y=Math.floor(Math.cos(a*Math.PI*2)*(140+n*16))-16;var r=Math.floor(-(a)*360);str+='<div class="cursor" id="cursor'+i+'" style="left:'+x+'px;top:'+y+'px;transform:rotate('+r+'deg);-moz-transform:rotate('+r+'deg);-webkit-transform:rotate('+r+'deg);-ms-transform:rotate('+r+'deg);-o-transform:rotate('+r+'deg);"></div>';}
l('cookieCursors').innerHTML=str;if(!l('rowInfo'+this.id))l('sectionLeftInfo').innerHTML='<div class="info" id="rowInfo'+this.id+'"><div class="infoContent" id="rowInfoContent'+this.id+'"></div><div><a onclick="Game.ObjectsById['+this.id+'].sell();">Sell 1</a></div></div>';},function(){if(this.amount>=1)Game.Unlock(['Reinforced index finger','Carpal tunnel prevention cream']);if(this.amount>=10)Game.Unlock('Ambidextrous');if(this.amount>=20)Game.Unlock('Thousand fingers');if(this.amount>=40)Game.Unlock('Million fingers');if(this.amount>=80)Game.Unlock('Billion fingers');if(this.amount>=120)Game.Unlock('Trillion fingers');if(this.amount>=160)Game.Unlock('Quadrillion fingers');if(this.amount>=200)Game.Unlock('Quintillion fingers');if(this.amount>=1)Game.Win('Click');if(this.amount>=2)Game.Win('Double-click');if(this.amount>=50)Game.Win('Mouse wheel');if(this.amount>=100)Game.Win('Of Mice and Men');if(this.amount>=200)Game.Win('The Digital');});Game.SpecialGrandmaUnlock=15;new Game.Object('Grandma','grandma|grandmas|baked','A nice grandma to bake more cookies.','grandma','grandmaIcon','grandmaBackground',100,function(){var mult=0;if(Game.Has('Farmer grandmas'))mult++;if(Game.Has('Worker grandmas'))mult++;if(Game.Has('Miner grandmas'))mult++;if(Game.Has('Cosmic grandmas'))mult++;if(Game.Has('Transmuted grandmas'))mult++;if(Game.Has('Altered grandmas'))mult++;if(Game.Has('Grandmas\' grandmas'))mult++;if(Game.Has('Antigrandmas'))mult++;if(Game.Has('Bingo center/Research facility'))mult+=2;if(Game.Has('Ritual rolling pins'))mult++;var add=0;if(Game.Has('One mind'))add+=Game.Objects['Grandma'].amount*0.02;if(Game.Has('Communal brainsweep'))add+=Game.Objects['Grandma'].amount*0.02;if(Game.Has('Elder Pact'))add+=Game.Objects['Portal'].amount*0.05;return Game.ComputeCps(0.5,Game.Has('Forwards from grandma')*0.3+add,Game.Has('Steel-plated rolling pins')+Game.Has('Lubricated dentures')+Game.Has('Prune juice')+mult);},Game.NewDrawFunction(function(){var list=['grandma'];if(Game.Has('Farmer grandmas'))list.push('farmerGrandma');if(Game.Has('Worker grandmas'))list.push('workerGrandma');if(Game.Has('Miner grandmas'))list.push('minerGrandma');if(Game.Has('Cosmic grandmas'))list.push('cosmicGrandma');if(Game.Has('Transmuted grandmas'))list.push('transmutedGrandma');if(Game.Has('Altered grandmas'))list.push('alteredGrandma');if(Game.Has('Grandmas\' grandmas'))list.push('grandmasGrandma');if(Game.Has('Antigrandmas'))list.push('antiGrandma');return choose(list);},8,8,32,3,16),function(){if(this.amount>=1)Game.Unlock(['Forwards from grandma','Steel-plated rolling pins']);if(this.amount>=10)Game.Unlock('Lubricated dentures');if(this.amount>=50)Game.Unlock('Prune juice');if(this.amount>=1)Game.Win('Grandma\'s cookies');if(this.amount>=50)Game.Win('Sloppy kisses');if(this.amount>=100)Game.Win('Retirement home');});Game.Objects['Grandma'].sellFunction=function()
{Game.Win('Just wrong');if(this.amount==0)
{Game.Lock('Elder Pledge');Game.pledgeT=0;}};new Game.Object('Farm','farm|farms|harvested','Grows cookie plants from cookie seeds.','farm','farmIcon','farmBackground',500,function(){return Game.ComputeCps(2,Game.Has('Cheap hoes')*0.5,Game.Has('Fertilizer')+Game.Has('Cookie trees')+Game.Has('Genetically-modified cookies'));},Game.NewDrawFunction(0,16,16,64,2,32),function(){if(this.amount>=1)Game.Unlock(['Cheap hoes','Fertilizer']);if(this.amount>=10)Game.Unlock('Cookie trees');if(this.amount>=50)Game.Unlock('Genetically-modified cookies');if(this.amount>=Game.SpecialGrandmaUnlock&&Game.Objects['Grandma'].amount>0)Game.Unlock('Farmer grandmas');if(this.amount>=1)Game.Win('My first farm');if(this.amount>=50)Game.Win('Reap what you sow');if(this.amount>=100)Game.Win('Farm ill');});new Game.Object('Factory','factory|factories|mass-produced','Produces large quantities of cookies.','factory','factoryIcon','factoryBackground',3000,function(){return Game.ComputeCps(10,Game.Has('Sturdier conveyor belts')*4,Game.Has('Child labor')+Game.Has('Sweatshop')+Game.Has('Radium reactors'));},Game.NewDrawFunction(0,32,2,64,1,-22),function(){if(this.amount>=1)Game.Unlock(['Sturdier conveyor belts','Child labor']);if(this.amount>=10)Game.Unlock('Sweatshop');if(this.amount>=50)Game.Unlock('Radium reactors');if(this.amount>=Game.SpecialGrandmaUnlock&&Game.Objects['Grandma'].amount>0)Game.Unlock('Worker grandmas');if(this.amount>=1)Game.Win('Production chain');if(this.amount>=50)Game.Win('Industrial revolution');if(this.amount>=100)Game.Win('Global warming');});new Game.Object('Mine','mine|mines|mined','Mines out cookie dough and chocolate chips.','mine','mineIcon','mineBackground',10000,function(){return Game.ComputeCps(40,Game.Has('Sugar gas')*10,Game.Has('Megadrill')+Game.Has('Ultradrill')+Game.Has('Ultimadrill'));},Game.NewDrawFunction(0,16,16,64,2,24),function(){if(this.amount>=1)Game.Unlock(['Sugar gas','Megadrill']);if(this.amount>=10)Game.Unlock('Ultradrill');if(this.amount>=50)Game.Unlock('Ultimadrill');if(this.amount>=Game.SpecialGrandmaUnlock&&Game.Objects['Grandma'].amount>0)Game.Unlock('Miner grandmas');if(this.amount>=1)Game.Win('You know the drill');if(this.amount>=50)Game.Win('Excavation site');if(this.amount>=100)Game.Win('Hollow the planet');});new Game.Object('Shipment','shipment|shipments|shipped','Brings in fresh cookies from the cookie planet.','shipment','shipmentIcon','shipmentBackground',40000,function(){return Game.ComputeCps(100,Game.Has('Vanilla nebulae')*30,Game.Has('Wormholes')+Game.Has('Frequent flyer')+Game.Has('Warp drive'));},Game.NewDrawFunction(0,16,16,64),function(){if(this.amount>=1)Game.Unlock(['Vanilla nebulae','Wormholes']);if(this.amount>=10)Game.Unlock('Frequent flyer');if(this.amount>=50)Game.Unlock('Warp drive');if(this.amount>=Game.SpecialGrandmaUnlock&&Game.Objects['Grandma'].amount>0)Game.Unlock('Cosmic grandmas');if(this.amount>=1)Game.Win('Expedition');if(this.amount>=50)Game.Win('Galactic highway');if(this.amount>=100)Game.Win('Far far away');});new Game.Object('Alchemy lab','alchemy lab|alchemy labs|transmuted','Turns gold into cookies!','alchemylab','alchemylabIcon','alchemylabBackground',200000,function(){return Game.ComputeCps(400,Game.Has('Antimony')*100,Game.Has('Essence of dough')+Game.Has('True chocolate')+Game.Has('Ambrosia'));},Game.NewDrawFunction(0,16,16,64,2,16),function(){if(this.amount>=1)Game.Unlock(['Antimony','Essence of dough']);if(this.amount>=10)Game.Unlock('True chocolate');if(this.amount>=50)Game.Unlock('Ambrosia');if(this.amount>=Game.SpecialGrandmaUnlock&&Game.Objects['Grandma'].amount>0)Game.Unlock('Transmuted grandmas');if(this.amount>=1)Game.Win('Transmutation');if(this.amount>=50)Game.Win('Transmogrification');if(this.amount>=100)Game.Win('Gold member');});new Game.Object('Portal','portal|portals|retrieved','Opens a door to the Cookieverse.','portal','portalIcon','portalBackground',1666666,function(){return Game.ComputeCps(6666,Game.Has('Ancient tablet')*1666,Game.Has('Insane oatling workers')+Game.Has('Soul bond')+Game.Has('Sanity dance'));},Game.NewDrawFunction(0,32,32,64,2),function(){if(this.amount>=1)Game.Unlock(['Ancient tablet','Insane oatling workers']);if(this.amount>=10)Game.Unlock('Soul bond');if(this.amount>=50)Game.Unlock('Sanity dance');if(this.amount>=Game.SpecialGrandmaUnlock&&Game.Objects['Grandma'].amount>0)Game.Unlock('Altered grandmas');if(this.amount>=1)Game.Win('A whole new world');if(this.amount>=50)Game.Win('Now you\'re thinking');if(this.amount>=100)Game.Win('Dimensional shift');});new Game.Object('Time machine','time machine|time machines|recovered','Brings cookies from the past, before they were even eaten.','timemachine','timemachineIcon','timemachineBackground',123456789,function(){return Game.ComputeCps(98765,Game.Has('Flux capacitors')*9876,Game.Has('Time paradox resolver')+Game.Has('Quantum conundrum')+Game.Has('Causality enforcer'));},Game.NewDrawFunction(0,32,32,64,1),function(){if(this.amount>=1)Game.Unlock(['Flux capacitors','Time paradox resolver']);if(this.amount>=10)Game.Unlock('Quantum conundrum');if(this.amount>=50)Game.Unlock('Causality enforcer');if(this.amount>=Game.SpecialGrandmaUnlock&&Game.Objects['Grandma'].amount>0)Game.Unlock('Grandmas\' grandmas');if(this.amount>=1)Game.Win('Time warp');if(this.amount>=50)Game.Win('Alternate timeline');if(this.amount>=100)Game.Win('Rewriting history');});new Game.Object('Antimatter condenser','antimatter condenser|antimatter condensers|condensed','Condenses the antimatter in the universe into cookies.','antimattercondenser','antimattercondenserIcon','antimattercondenserBackground',4999999999,function(){return Game.ComputeCps(999999,Game.Has('Sugar bosons')*99999,Game.Has('String theory')+Game.Has('Large macaron collider')+Game.Has('Big bang bake'));},Game.NewDrawFunction(0,0,64,64,1),function(){if(this.amount>=1)Game.Unlock(['Sugar bosons','String theory']);if(this.amount>=10)Game.Unlock('Large macaron collider');if(this.amount>=50)Game.Unlock('Big bang bake');if(this.amount>=Game.SpecialGrandmaUnlock&&Game.Objects['Grandma'].amount>0)Game.Unlock('Antigrandmas');if(this.amount>=1)Game.Win('Antibatter');if(this.amount>=50)Game.Win('Quirky quarks');if(this.amount>=100)Game.Win('It does matter!');});Game.Objects['Antimatter condenser'].displayName='<span style="font-size:65%;">Antimatter condenser</span>';Game.upgradesToRebuild=1;Game.Upgrades=[];Game.UpgradesById=[];Game.UpgradesN=0;Game.UpgradesInStore=[];Game.UpgradesOwned=0;Game.Upgrade=function(name,desc,price,icon,buyFunction)
{this.id=Game.UpgradesN;this.name=name;this.desc=desc;this.basePrice=price;this.icon=icon;this.buyFunction=buyFunction;this.unlocked=0;this.bought=0;this.hide=0;this.order=this.id;if(order)this.order=order+this.id*0.001;this.type='';if(type)this.type=type;this.power=0;if(power)this.power=power;this.buy=function()
{var cancelPurchase=0;if(this.clickFunction)cancelPurchase=!this.clickFunction();if(!cancelPurchase)
{var price=this.basePrice;if(Game.cookies>=price&&!this.bought)
{Game.Spend(price);this.bought=1;if(this.buyFunction)this.buyFunction();Game.upgradesToRebuild=1;Game.recalculateGains=1;if(this.hide!=3)Game.UpgradesOwned++;}}}
this.earn=function()
{Game.Upgrades[this.name].unlocked=1;this.bought=1;if(this.buyFunction)this.buyFunction();Game.upgradesToRebuild=1;Game.recalculateGains=1;if(this.hide!=3)Game.UpgradesOwned++;}
this.toggle=function()
{if(!this.bought)
{this.bought=1;if(this.buyFunction)this.buyFunction();Game.upgradesToRebuild=1;Game.recalculateGains=1;if(this.hide!=3)Game.UpgradesOwned++;}
else
{this.bought=0;Game.upgradesToRebuild=1;Game.recalculateGains=1;if(this.hide!=3)Game.UpgradesOwned--;}
Game.UpdateMenu();}
Game.Upgrades[this.name]=this;Game.UpgradesById[this.id]=this;Game.UpgradesN++;return this;}
Game.Unlock=function(what)
{if(typeof what==='string')
{if(Game.Upgrades[what])
{if(Game.Upgrades[what].unlocked==0)
{Game.Upgrades[what].unlocked=1;Game.upgradesToRebuild=1;Game.recalculateGains=1;}}}
else{for(var i in what){Game.Unlock(what[i]);}}}
Game.Lock=function(what)
{if(typeof what==='string')
{if(Game.Upgrades[what])
{Game.Upgrades[what].unlocked=0;Game.Upgrades[what].bought=0;Game.upgradesToRebuild=1;if(Game.Upgrades[what].bought==1)
{Game.UpgradesOwned--;}
Game.recalculateGains=1;}}
else{for(var i in what){Game.Lock(what[i]);}}}
Game.Has=function(what)
{return(Game.Upgrades[what]?Game.Upgrades[what].bought:0);}
Game.RebuildUpgrades=function()
{Game.upgradesToRebuild=0;var list=[];for(var i in Game.Upgrades)
{var me=Game.Upgrades[i];if(!me.bought)
{if(me.unlocked)list.push(me);}}
var sortMap=function(a,b)
{if(a.basePrice>b.basePrice)return 1;else if(a.basePrice<b.basePrice)return-1;else return 0;}
list.sort(sortMap);Game.UpgradesInStore=[];for(var i in list)
{Game.UpgradesInStore.push(list[i]);}
var str='';for(var i in Game.UpgradesInStore)
{var me=Game.UpgradesInStore[i];str+='<div class="crate upgrade" '+Game.getTooltip('<div style="min-width:200px;"><div style="float:right;"><span class="price">'+Beautify(Math.round(me.basePrice))+'</span></div><small>[Upgrade]</small><div class="name">'+me.name+'</div><div class="description">'+me.desc+'</div></div>',0,16,'bottom-right')+' onclick="Game.UpgradesById['+me.id+'].buy();" id="upgrade'+i+'" style="background-position:'+(-me.icon[0]*48+6)+'px '+(-me.icon[1]*48+6)+'px;"></div>';}
l('upgrades').innerHTML=str;}
var tier1=10;var tier2=100;var tier3=1000;var tier4=10000;var type='';var power=0;var order=100;new Game.Upgrade('Reinforced index finger','The mouse gains <b>+1</b> cookie per click.<br>Cursors gain <b>+0.1</b> base CpS.<q>prod prod</q>',100,[0,0]);new Game.Upgrade('Carpal tunnel prevention cream','The mouse and cursors are <b>twice</b> as efficient.<q>it... it hurts to click...</q>',400,[0,0]);new Game.Upgrade('Ambidextrous','The mouse and cursors are <b>twice</b> as efficient.<q>Look ma, both hands!</q>',10000,[0,6]);new Game.Upgrade('Thousand fingers','The mouse and cursors gain <b>+0.1</b> cookies for each non-cursor object owned.<q>clickity</q>',500000,[0,6]);new Game.Upgrade('Million fingers','The mouse and cursors gain <b>+0.5</b> cookies for each non-cursor object owned.<q>clickityclickity</q>',50000000,[1,6]);new Game.Upgrade('Billion fingers','The mouse and cursors gain <b>+2</b> cookies for each non-cursor object owned.<q>clickityclickityclickity</q>',500000000,[2,6]);new Game.Upgrade('Trillion fingers','The mouse and cursors gain <b>+10</b> cookies for each non-cursor object owned.<q>clickityclickityclickityclickity</q>',5000000000,[3,6]);order=200;new Game.Upgrade('Forwards from grandma','Grandmas gain <b>+0.3</b> base CpS.<q>RE:RE:thought you\'d get a kick out of this ;))</q>',Game.Objects['Grandma'].basePrice*tier1,[1,0]);new Game.Upgrade('Steel-plated rolling pins','Grandmas are <b>twice</b> as efficient.<q>Just what you kneaded.</q>',Game.Objects['Grandma'].basePrice*tier2,[1,0]);new Game.Upgrade('Lubricated dentures','Grandmas are <b>twice</b> as efficient.<q>squish</q>',Game.Objects['Grandma'].basePrice*tier3,[1,1]);order=300;new Game.Upgrade('Cheap hoes','Farms gain <b>+0.5</b> base CpS.<q>Rake in the dough!</q>',Game.Objects['Farm'].basePrice*tier1,[2,0]);new Game.Upgrade('Fertilizer','Farms are <b>twice</b> as efficient.<q>It\'s chocolate, I swear.</q>',Game.Objects['Farm'].basePrice*tier2,[2,0]);new Game.Upgrade('Cookie trees','Farms are <b>twice</b> as efficient.<q>A relative of the breadfruit.</q>',Game.Objects['Farm'].basePrice*tier3,[2,1]);order=400;new Game.Upgrade('Sturdier conveyor belts','Factories gain <b>+4</b> base CpS.<q>You\'re going places.</q>',Game.Objects['Factory'].basePrice*tier1,[4,0]);new Game.Upgrade('Child labor','Factories are <b>twice</b> as efficient.<q>Cheaper, healthier workforce.</q>',Game.Objects['Factory'].basePrice*tier2,[4,0]);new Game.Upgrade('Sweatshop','Factories are <b>twice</b> as efficient.<q>Slackers will be terminated.</q>',Game.Objects['Factory'].basePrice*tier3,[4,1]);order=500;new Game.Upgrade('Sugar gas','Mines gain <b>+10</b> base CpS.<q>A pink, volatile gas, found in the depths of some chocolate caves.</q>',Game.Objects['Mine'].basePrice*tier1,[3,0]);new Game.Upgrade('Megadrill','Mines are <b>twice</b> as efficient.<q>You\'re in deep.</q>',Game.Objects['Mine'].basePrice*tier2,[3,0]);new Game.Upgrade('Ultradrill','Mines are <b>twice</b> as efficient.<q>Finally caved in?</q>',Game.Objects['Mine'].basePrice*tier3,[3,1]);order=600;new Game.Upgrade('Vanilla nebulae','Shipments gain <b>+30</b> base CpS.<q>If you removed your space helmet, you could probably smell it!<br>(Note : don\'t do that.)</q>',Game.Objects['Shipment'].basePrice*tier1,[5,0]);new Game.Upgrade('Wormholes','Shipments are <b>twice</b> as efficient.<q>By using these as shortcuts, your ships can travel much faster.</q>',Game.Objects['Shipment'].basePrice*tier2,[5,0]);new Game.Upgrade('Frequent flyer','Shipments are <b>twice</b> as efficient.<q>Come back soon!</q>',Game.Objects['Shipment'].basePrice*tier3,[5,1]);order=700;new Game.Upgrade('Antimony','Alchemy labs gain <b>+100</b> base CpS.<q>Actually worth a lot of mony.</q>',Game.Objects['Alchemy lab'].basePrice*tier1,[6,0]);new Game.Upgrade('Essence of dough','Alchemy labs are <b>twice</b> as efficient.<q>Extracted through the 5 ancient steps of alchemical baking.</q>',Game.Objects['Alchemy lab'].basePrice*tier2,[6,0]);new Game.Upgrade('True chocolate','Alchemy labs are <b>twice</b> as efficient.<q>The purest form of cacao.</q>',Game.Objects['Alchemy lab'].basePrice*tier3,[6,1]);order=800;new Game.Upgrade('Ancient tablet','Portals gain <b>+1,666</b> base CpS.<q>A strange slab of peanut brittle, holding an ancient cookie recipe. Neat!</q>',Game.Objects['Portal'].basePrice*tier1,[7,0]);new Game.Upgrade('Insane oatling workers','Portals are <b>twice</b> as efficient.<q>ARISE, MY MINIONS!</q>',Game.Objects['Portal'].basePrice*tier2,[7,0]);new Game.Upgrade('Soul bond','Portals are <b>twice</b> as efficient.<q>So I just sign up and get more cookies? Sure, whatever!</q>',Game.Objects['Portal'].basePrice*tier3,[7,1]);order=900;new Game.Upgrade('Flux capacitors','Time machines gain <b>+9,876</b> base CpS.<q>Bake to the future.</q>',1234567890,[8,0]);new Game.Upgrade('Time paradox resolver','Time machines are <b>twice</b> as efficient.<q>No more fooling around with your own grandmother!</q>',9876543210,[8,0]);new Game.Upgrade('Quantum conundrum','Time machines are <b>twice</b> as efficient.<q>It\'s full of stars!</q>',98765456789,[8,1]);order=20000;new Game.Upgrade('Kitten helpers','You gain <b>more CpS</b> the more milk you have.<q>meow may I help you</q>',9000000,[1,7]);new Game.Upgrade('Kitten workers','You gain <b>more CpS</b> the more milk you have.<q>meow meow meow meow</q>',9000000000,[2,7]);order=10000;type='cookie';power=5;new Game.Upgrade('Oatmeal raisin cookies','Cookie production multiplier <b>+5%</b>.<q>No raisin to hate these.</q>',99999999,[0,3]);new Game.Upgrade('Peanut butter cookies','Cookie production multiplier <b>+5%</b>.<q>Get yourself some jam cookies!</q>',99999999,[1,3]);new Game.Upgrade('Plain cookies','Cookie production multiplier <b>+5%</b>.<q>Meh.</q>',99999999,[2,3]);new Game.Upgrade('Coconut cookies','Cookie production multiplier <b>+5%</b>.<q>These are *way* flaky.</q>',999999999,[3,3]);new Game.Upgrade('White chocolate cookies','Cookie production multiplier <b>+5%</b>.<q>I know what you\'ll say. It\'s just cocoa butter! It\'s not real chocolate!<br>Oh please.</q>',999999999,[4,3]);new Game.Upgrade('Macadamia nut cookies','Cookie production multiplier <b>+5%</b>.<q>They\'re macadamn delicious!</q>',999999999,[5,3]);power=10;new Game.Upgrade('Double-chip cookies','Cookie production multiplier <b>+10%</b>.<q>DOUBLE THE CHIPS<br>DOUBLE THE TASTY<br>(double the calories)</q>',99999999999,[6,3]);power=5;new Game.Upgrade('Sugar cookies','Cookie production multiplier <b>+5%</b>.<q>Tasty, if a little unimaginative.</q>',99999999,[7,3]);power=10;new Game.Upgrade('White chocolate macadamia nut cookies','Cookie production multiplier <b>+10%</b>.<q>Orteil\'s favorite.</q>',99999999999,[8,3]);new Game.Upgrade('All-chocolate cookies','Cookie production multiplier <b>+10%</b>.<q>CHOCOVERDOSE.</q>',99999999999,[9,3]);type='';power=0;order=100;new Game.Upgrade('Quadrillion fingers','The mouse and cursors gain <b>+20</b> cookies for each non-cursor object owned.<q>clickityclickityclickityclickityclick</q>',50000000000,[3,6]);order=200;new Game.Upgrade('Prune juice','Grandmas are <b>twice</b> as efficient.<q>Gets me going.</q>',Game.Objects['Grandma'].basePrice*tier4,[1,2]);order=300;new Game.Upgrade('Genetically-modified cookies','Farms are <b>twice</b> as efficient.<q>All-natural mutations.</q>',Game.Objects['Farm'].basePrice*tier4,[2,2]);order=400;new Game.Upgrade('Radium reactors','Factories are <b>twice</b> as efficient.<q>Gives your cookies a healthy glow.</q>',Game.Objects['Factory'].basePrice*tier4,[4,2]);order=500;new Game.Upgrade('Ultimadrill','Mines are <b>twice</b> as efficient.<q>Pierce the heavens, etc.</q>',Game.Objects['Mine'].basePrice*tier4,[3,2]);order=600;new Game.Upgrade('Warp drive','Shipments are <b>twice</b> as efficient.<q>To boldly bake.</q>',Game.Objects['Shipment'].basePrice*tier4,[5,2]);order=700;new Game.Upgrade('Ambrosia','Alchemy labs are <b>twice</b> as efficient.<q>Adding this to the cookie mix is sure to make them even more addictive!<br>Perhaps dangerously so.<br>Let\'s hope you can keep selling these legally.</q>',Game.Objects['Alchemy lab'].basePrice*tier4,[6,2]);order=800;new Game.Upgrade('Sanity dance','Portals are <b>twice</b> as efficient.<q>We can change if we want to.<br>We can leave our brains behind.</q>',Game.Objects['Portal'].basePrice*tier4,[7,2]);order=900;new Game.Upgrade('Causality enforcer','Time machines are <b>twice</b> as efficient.<q>What happened, happened.</q>',1234567890000,[8,2]);order=5000;new Game.Upgrade('Lucky day','Golden cookies appear <b>twice as often</b> and stay <b>twice as long</b>.<q>Oh hey, a four-leaf penny!</q>',777777777,[10,1]);new Game.Upgrade('Serendipity','Golden cookies appear <b>twice as often</b> and stay <b>twice as long</b>.<q>What joy! Seven horseshoes!</q>',77777777777,[10,1]);order=20000;new Game.Upgrade('Kitten engineers','You gain <b>more CpS</b> the more milk you have.<q>meow meow meow meow, sir</q>',9000000000000,[3,7]);order=10000;type='cookie';power=15;new Game.Upgrade('Dark chocolate-coated cookies','Cookie production multiplier <b>+15%</b>.<q>These absorb light so well you almost need to squint to see them.</q>',999999999999,[10,3]);new Game.Upgrade('White chocolate-coated cookies','Cookie production multiplier <b>+15%</b>.<q>These dazzling cookies absolutely glisten with flavor.</q>',999999999999,[11,3]);type='';power=0;order=250;new Game.Upgrade('Farmer grandmas','Grandmas are <b>twice</b> as efficient.<q>A nice farmer to grow more cookies.</q>',Game.Objects['Farm'].basePrice*tier2,[10,9],function(){Game.Objects['Grandma'].drawFunction();});new Game.Upgrade('Worker grandmas','Grandmas are <b>twice</b> as efficient.<q>A nice worker to manufacture more cookies.</q>',Game.Objects['Factory'].basePrice*tier2,[10,9],function(){Game.Objects['Grandma'].drawFunction();});new Game.Upgrade('Miner grandmas','Grandmas are <b>twice</b> as efficient.<q>A nice miner to dig more cookies.</q>',Game.Objects['Mine'].basePrice*tier2,[10,9],function(){Game.Objects['Grandma'].drawFunction();});new Game.Upgrade('Cosmic grandmas','Grandmas are <b>twice</b> as efficient.<q>A nice thing to... uh... cookies.</q>',Game.Objects['Shipment'].basePrice*tier2,[10,9],function(){Game.Objects['Grandma'].drawFunction();});new Game.Upgrade('Transmuted grandmas','Grandmas are <b>twice</b> as efficient.<q>A nice golden grandma to convert into more cookies.</q>',Game.Objects['Alchemy lab'].basePrice*tier2,[10,9],function(){Game.Objects['Grandma'].drawFunction();});new Game.Upgrade('Altered grandmas','Grandmas are <b>twice</b> as efficient.<q>a NiCe GrAnDmA tO bA##########</q>',Game.Objects['Portal'].basePrice*tier2,[10,9],function(){Game.Objects['Grandma'].drawFunction();});new Game.Upgrade('Grandmas\' grandmas','Grandmas are <b>twice</b> as efficient.<q>A nice grandma\'s nice grandma to bake double the cookies.</q>',Game.Objects['Time machine'].basePrice*tier2,[10,9],function(){Game.Objects['Grandma'].drawFunction();});order=15000;Game.baseResearchTime=Game.fps*60*30;Game.SetResearch=function(what,time)
{if(Game.Upgrades[what])
{Game.researchT=Game.Has('Ultrascience')?Game.fps*5:Game.baseResearchTime;Game.nextResearch=Game.Upgrades[what].id;Game.Popup('Research has begun.');}}
new Game.Upgrade('Bingo center/Research facility','Grandma-operated science lab and leisure club.<br>Grandmas are <b>4 times</b> as efficient.<br><b>Regularly unlocks new upgrades</b>.',100000000000,[11,9],function(){Game.SetResearch('Specialized chocolate chips');});new Game.Upgrade('Specialized chocolate chips','[Research]<br>Cookie production multiplier <b>+1%</b>.<q>Computer-designed chocolate chips. Computer chips, if you will.</q>',10000000000,[0,9],function(){Game.SetResearch('Designer cocoa beans');});new Game.Upgrade('Designer cocoa beans','[Research]<br>Cookie production multiplier <b>+2%</b>.<q>Now more aerodynamic than ever!</q>',20000000000,[1,9],function(){Game.SetResearch('Ritual rolling pins');});new Game.Upgrade('Ritual rolling pins','[Research]<br>Grandmas are <b>twice</b> as efficient.<q>The result of years of scientific research!</q>',40000000000,[2,9],function(){Game.SetResearch('Underworld ovens');});new Game.Upgrade('Underworld ovens','[Research]<br>Cookie production multiplier <b>+3%</b>.<q>Powered by science, of course!</q>',80000000000,[3,9],function(){Game.SetResearch('One mind');});new Game.Upgrade('One mind','[Research]<br>Each grandma gains <b>+1 base CpS for each 50 grandmas</b>.<div class="warning">Note : the grandmothers are growing restless. Do not encourage them.</div><q>We are one. We are many.</q>',160000000000,[4,9],function(){Game.elderWrath=1;Game.SetResearch('Exotic nuts');});Game.Upgrades['One mind'].clickFunction=function(){return confirm('Warning : purchasing this will have unexpected, and potentially undesirable results!\nIt\'s all downhill from here. You have been warned!\nPurchase anyway?');};new Game.Upgrade('Exotic nuts','[Research]<br>Cookie production multiplier <b>+4%</b>.<q>You\'ll go crazy over these!</q>',320000000000,[5,9],function(){Game.SetResearch('Communal brainsweep');});new Game.Upgrade('Communal brainsweep','[Research]<br>Each grandma gains another <b>+1 base CpS for each 50 grandmas</b>.<div class="warning">Note : proceeding any further in scientific research may have unexpected results. You have been warned.</div><q>We fuse. We merge. We grow.</q>',640000000000,[6,9],function(){Game.elderWrath=2;Game.SetResearch('Arcane sugar');});new Game.Upgrade('Arcane sugar','[Research]<br>Cookie production multiplier <b>+5%</b>.<q>Tastes like insects, ligaments, and molasses.</q>',1280000000000,[7,9],function(){Game.SetResearch('Elder Pact');});new Game.Upgrade('Elder Pact','[Research]<br>Each grandma gains <b>+1 base CpS for each 20 portals</b>.<div class="warning">Note : this is a bad idea.</div><q>squirm crawl slither writhe<br>today we rise</q>',2560000000000,[8,9],function(){Game.elderWrath=3;});new Game.Upgrade('Elder Pledge','[Repeatable]<br>Contains the wrath of the elders, at least for a while.<q>This is a simple ritual involving anti-aging cream, cookie batter mixed in the moonlight, and a live chicken.</q>',1,[9,9],function()
{Game.elderWrath=0;Game.pledges++;Game.pledgeT=Game.fps*60*(Game.Has('Sacrificial rolling pins')?60:30);Game.Upgrades['Elder Pledge'].basePrice=Math.pow(8,Math.min(Game.pledges+2,14));Game.Unlock('Elder Covenant');});Game.Upgrades['Elder Pledge'].hide=3;order=150;new Game.Upgrade('Plastic mouse','Clicking gains <b>+1% of your CpS</b>.<q>Slightly squeaky.</q>',50000,[11,0]);new Game.Upgrade('Iron mouse','Clicking gains <b>+1% of your CpS</b>.<q>Click like it\'s 1349!</q>',5000000,[11,0]);new Game.Upgrade('Titanium mouse','Clicking gains <b>+1% of your CpS</b>.<q>Heavy, but powerful.</q>',500000000,[11,1]);new Game.Upgrade('Adamantium mouse','Clicking gains <b>+1% of your CpS</b>.<q>You could cut diamond with these.</q>',50000000000,[11,2]);order=40000;new Game.Upgrade('Ultrascience','Research takes only <b>5 seconds</b>.<q>YEAH, SCIENCE!</q>',7,[9,2]);Game.Upgrades['Ultrascience'].hide=3;order=10000;type='cookie';power=15;new Game.Upgrade('Eclipse cookies','Cookie production multiplier <b>+15%</b>.<q>Look to the cookie.</q>',9999999999999,[0,4]);new Game.Upgrade('Zebra cookies','Cookie production multiplier <b>+15%</b>.<q>...</q>',9999999999999,[1,4]);type='';power=0;order=100;new Game.Upgrade('Quintillion fingers','The mouse and cursors gain <b>+100</b> cookies for each non-cursor object owned.<q>man, just go click click click click click, it\'s real easy, man.</q>',50000000000000,[3,6]);order=40000;new Game.Upgrade('Gold hoard','Golden cookies appear <b>really often</b>.<q>That\'s entirely too many.</q>',7,[10,1]);Game.Upgrades['Gold hoard'].hide=3;order=15000;new Game.Upgrade('Elder Covenant','[Switch]<br>Puts a permanent end to the elders\' wrath, at the price of 5% of your CpS.<q>This is a complicated ritual involving silly, inconsequential trivialities such as cursed laxatives, century-old cacao, and an infant.<br>Don\'t question it.</q>',66666666666666,[8,9],function()
{Game.pledgeT=0;Game.Lock('Revoke Elder Covenant');Game.Unlock('Revoke Elder Covenant');Game.Lock('Elder Pledge');Game.Win('Elder calm');});Game.Upgrades['Elder Covenant'].hide=3;new Game.Upgrade('Revoke Elder Covenant','[Switch]<br>You will get 5% of your CpS back, but the grandmatriarchs will return.<q>we<br>rise<br>again</q>',6666666666,[8,9],function()
{Game.Lock('Elder Covenant');Game.Unlock('Elder Covenant');});Game.Upgrades['Revoke Elder Covenant'].hide=3;order=5000;new Game.Upgrade('Get lucky','Golden cookie effects last <b>twice as long</b>.<q>You\'ve been up all night, haven\'t you?</q>',77777777777777,[10,1]);order=15000;new Game.Upgrade('Sacrificial rolling pins','Elder pledge last <b>twice</b> as long.<q>These are mostly for spreading the anti-aging cream.<br>(and accessorily, shortening the chicken\'s suffering.)</q>',2888888888888,[2,9]);order=10000;type='cookie';power=15;new Game.Upgrade('Snickerdoodles','Cookie production multiplier <b>+15%</b>.<q>True to their name.</q>',99999999999999,[2,4]);new Game.Upgrade('Stroopwafels','Cookie production multiplier <b>+15%</b>.<q>If it ain\'t dutch, it ain\'t much.</q>',99999999999999,[3,4]);new Game.Upgrade('Macaroons','Cookie production multiplier <b>+15%</b>.<q>Not to be confused with macarons.<br>These have coconut, okay?</q>',99999999999999,[4,4]);type='';power=0;order=40000;new Game.Upgrade('Neuromancy','Can toggle upgrades on and off at will in the stats menu.<q>Can also come in handy to unsee things that can\'t be unseen.</q>',7,[4,9]);Game.Upgrades['Neuromancy'].hide=3;order=10000;type='cookie';power=15;new Game.Upgrade('Empire biscuits','Cookie production multiplier <b>+15%</b>.<q>For your growing cookie empire, of course!</q>',99999999999999,[5,4]);new Game.Upgrade('British tea biscuits','Cookie production multiplier <b>+15%</b>.<q>Quite.</q>',99999999999999,[6,4]);new Game.Upgrade('Chocolate british tea biscuits','Cookie production multiplier <b>+15%</b>.<q>Yes, quite.</q>',99999999999999,[7,4]);new Game.Upgrade('Round british tea biscuits','Cookie production multiplier <b>+15%</b>.<q>Yes, quite riveting.</q>',99999999999999,[8,4]);new Game.Upgrade('Round chocolate british tea biscuits','Cookie production multiplier <b>+15%</b>.<q>Yes, quite riveting indeed.</q>',99999999999999,[9,4]);new Game.Upgrade('Round british tea biscuits with heart motif','Cookie production multiplier <b>+15%</b>.<q>Yes, quite riveting indeed, old chap.</q>',99999999999999,[10,4]);new Game.Upgrade('Round chocolate british tea biscuits with heart motif','Cookie production multiplier <b>+15%</b>.<q>I like cookies.</q>',99999999999999,[11,4]);type='';power=0;order=1000;new Game.Upgrade('Sugar bosons','Antimatter condensers gain <b>+99,999</b> base CpS.<q>Sweet firm bosons.</q>',Game.Objects['Antimatter condenser'].basePrice*tier1,[13,0]);new Game.Upgrade('String theory','Antimatter condensers are <b>twice</b> as efficient.<q>Reveals new insight about the true meaning of baking cookies (and, as a bonus, the structure of the universe).</q>',Game.Objects['Antimatter condenser'].basePrice*tier2,[13,0]);new Game.Upgrade('Large macaron collider','Antimatter condensers are <b>twice</b> as efficient.<q>How singular!</q>',Game.Objects['Antimatter condenser'].basePrice*tier3,[13,1]);new Game.Upgrade('Big bang bake','Antimatter condensers are <b>twice</b> as efficient.<q>And that\'s how it all began.</q>',Game.Objects['Antimatter condenser'].basePrice*tier4,[13,2]);order=250;new Game.Upgrade('Antigrandmas','Grandmas are <b>twice</b> as efficient.<q>A mean antigrandma to vomit more cookies.<br>(Do not put in contact with normal grandmas; loss of matter may occur.)</q>',Game.Objects['Antimatter condenser'].basePrice*tier2,[10,9],function(){Game.Objects['Grandma'].drawFunction();});order=10000;type='cookie';power=20;new Game.Upgrade('Madeleines','Cookie production multiplier <b>+20%</b>.<q>Unforgettable!</q>',199999999999999,[12,3]);new Game.Upgrade('Palmiers','Cookie production multiplier <b>+20%</b>.<q>Palmier than you!<br>Yes, I just said that.</q>',199999999999999,[13,3]);new Game.Upgrade('Palets','Cookie production multiplier <b>+20%</b>.<q>You could probably play hockey with these.<br>I mean, you\'re welcome to try.</q>',199999999999999,[12,4]);new Game.Upgrade('Sablés','Cookie production multiplier <b>+20%</b>.<q>The name implies they\'re made of sand. But you know better, don\'t you?</q>',199999999999999,[13,4]);type='';power=0;order=20000;new Game.Upgrade('Kitten overseers','You gain <b>more CpS</b> the more milk you have.<q>my purrpose is to serve you, sir</q>',900000000000000,[8,7]);Game.Achievements=[];Game.AchievementsById=[];Game.AchievementsN=0;Game.AchievementsOwned=0;Game.Achievement=function(name,desc,icon,hide)
{this.id=Game.AchievementsN;this.name=name;this.desc=desc;this.icon=icon;this.won=0;this.disabled=0;this.hide=hide||0;this.order=this.id;if(order)this.order=order+this.id*0.001;Game.Achievements[this.name]=this;Game.AchievementsById[this.id]=this;Game.AchievementsN++;return this;}
Game.Win=function(what)
{if(typeof what==='string')
{if(Game.Achievements[what])
{if(Game.Achievements[what].won==0)
{Game.Achievements[what].won=1;Game.Popup('Achievement unlocked :<br>'+Game.Achievements[what].name+'<br> ');if(Game.Achievements[what].hide!=3)Game.AchievementsOwned++;Game.recalculateGains=1;}}}
else{for(var i in what){Game.Win(what[i]);}}}
Game.HasAchiev=function(what)
{return(Game.Achievements[what]?Game.Achievements[what].won:0);}
var order=100;Game.moneyAchievs=['Wake and bake',1,'Making some dough',100,'So baked right now',1000,'Fledgling bakery',10000,'Affluent bakery',100000,'World-famous bakery',1000000,'Cosmic bakery',10000000,'Galactic bakery',100000000,'Universal bakery',1000000000,'Timeless bakery',5000000000,'Infinite bakery',10000000000,'Immortal bakery',50000000000,'You can stop now',100000000000,'Cookies all the way down',500000000000,'Overdose',1000000000000,'How?',10000000000000];for(var i=0;i<Game.moneyAchievs.length/2;i++)
{var pic=[Math.min(10,i),5];if(i==15)pic=[11,5];new Game.Achievement(Game.moneyAchievs[i*2],'Bake <b>'+Beautify(Game.moneyAchievs[i*2+1])+'</b> cookie'+(Game.moneyAchievs[i*2+1]==1?'':'s')+'.',pic,2);}
order=200;Game.cpsAchievs=['Casual baking',1,'Hardcore baking',10,'Steady tasty stream',100,'Cookie monster',1000,'Mass producer',10000,'Cookie vortex',100000,'Cookie pulsar',1000000,'Cookie quasar',10000000,'A world filled with cookies',100000000,'Let\'s never bake again',1000000000];for(var i=0;i<Game.cpsAchievs.length/2;i++)
{var pic=[i,5];new Game.Achievement(Game.cpsAchievs[i*2],'Bake <b>'+Beautify(Game.cpsAchievs[i*2+1])+'</b> cookie'+(Game.cpsAchievs[i*2+1]==1?'':'s')+' per second.',pic,2);}
order=30000;new Game.Achievement('Sacrifice','Reset your game with <b>1 million</b> cookies baked.<q>Easy come, easy go.</q>',[11,6],2);new Game.Achievement('Oblivion','Reset your game with <b>1 billion</b> cookies baked.<q>Back to square one.</q>',[11,6],2);new Game.Achievement('From scratch','Reset your game with <b>1 trillion</b> cookies baked.<q>It\'s been fun.</q>',[11,6],2);order=31000;new Game.Achievement('Neverclick','Make <b>1 million</b> cookies by only having clicked <b>15 times</b>.',[12,0],2);order=1000;new Game.Achievement('Clicktastic','Make <b>1,000</b> cookies from clicking.',[11,0]);new Game.Achievement('Clickathlon','Make <b>100,000</b> cookies from clicking.',[11,1]);new Game.Achievement('Clickolympics','Make <b>10,000,000</b> cookies from clicking.',[11,1]);new Game.Achievement('Clickorama','Make <b>1,000,000,000</b> cookies from clicking.',[11,2]);order=1050;new Game.Achievement('Click','Have <b>1</b> cursor.',[0,0]);new Game.Achievement('Double-click','Have <b>2</b> cursors.',[0,6]);new Game.Achievement('Mouse wheel','Have <b>50</b> cursors.',[1,6]);new Game.Achievement('Of Mice and Men','Have <b>100</b> cursors.',[2,6]);new Game.Achievement('The Digital','Have <b>200</b> cursors.',[3,6]);order=1100;new Game.Achievement('Just wrong','Sell a grandma.<q>I thought you loved me.</q>',[10,9],2);new Game.Achievement('Grandma\'s cookies','Have <b>1</b> grandma.',[1,0]);new Game.Achievement('Sloppy kisses','Have <b>50</b> grandmas.',[1,1]);new Game.Achievement('Retirement home','Have <b>100</b> grandmas.',[1,2]);order=1200;new Game.Achievement('My first farm','Have <b>1</b> farm.',[2,0]);new Game.Achievement('Reap what you sow','Have <b>50</b> farms.',[2,1]);new Game.Achievement('Farm ill','Have <b>100</b> farms.',[2,2]);order=1300;new Game.Achievement('Production chain','Have <b>1</b> factory.',[4,0]);new Game.Achievement('Industrial revolution','Have <b>50</b> factories.',[4,1]);new Game.Achievement('Global warming','Have <b>100</b> factories.',[4,2]);order=1400;new Game.Achievement('You know the drill','Have <b>1</b> mine.',[3,0]);new Game.Achievement('Excavation site','Have <b>50</b> mines.',[3,1]);new Game.Achievement('Hollow the planet','Have <b>100</b> mines.',[3,2]);order=1500;new Game.Achievement('Expedition','Have <b>1</b> shipment.',[5,0]);new Game.Achievement('Galactic highway','Have <b>50</b> shipments.',[5,1]);new Game.Achievement('Far far away','Have <b>100</b> shipments.',[5,2]);order=1600;new Game.Achievement('Transmutation','Have <b>1</b> alchemy lab.',[6,0]);new Game.Achievement('Transmogrification','Have <b>50</b> alchemy labs.',[6,1]);new Game.Achievement('Gold member','Have <b>100</b> alchemy labs.',[6,2]);order=1700;new Game.Achievement('A whole new world','Have <b>1</b> portal.',[7,0]);new Game.Achievement('Now you\'re thinking','Have <b>50</b> portals.',[7,1]);new Game.Achievement('Dimensional shift','Have <b>100</b> portals.',[7,2]);order=1800;new Game.Achievement('Time warp','Have <b>1</b> time machine.',[8,0]);new Game.Achievement('Alternate timeline','Have <b>50</b> time machines.',[8,1]);new Game.Achievement('Rewriting history','Have <b>100</b> time machines.',[8,2]);order=7000;new Game.Achievement('One with everything','Have <b>at least 1</b> of every building.',[4,6],2);new Game.Achievement('Mathematician','Have at least <b>1 of the most expensive object, 2 of the second-most expensive, 4 of the next</b> and so on (capped at 128).',[7,6],2);new Game.Achievement('Base 10','Have at least <b>10 of the most expensive object, 20 of the second-most expensive, 30 of the next</b> and so on.',[8,6],2);order=10000;new Game.Achievement('Golden cookie','Click a <b>golden cookie</b>.',[10,1],1);new Game.Achievement('Lucky cookie','Click <b>7 golden cookies</b>.',[10,1],1);new Game.Achievement('A stroke of luck','Click <b>27 golden cookies</b>.',[10,1],1);order=30200;new Game.Achievement('Cheated cookies taste awful','Hack in some cookies.',[10,6],3);order=30001;new Game.Achievement('Uncanny clicker','Click really, really fast.<q>Well I\'ll be!</q>',[12,0],2);order=5000;new Game.Achievement('Builder','Own <b>100</b> buildings.',[4,6],1);new Game.Achievement('Architect','Own <b>400</b> buildings.',[5,6],1);order=6000;new Game.Achievement('Enhancer','Purchase <b>20</b> upgrades.',[9,0],1);new Game.Achievement('Augmenter','Purchase <b>50</b> upgrades.',[9,1],1);order=11000;new Game.Achievement('Cookie-dunker','Dunk the cookie.<q>You did it!</q>',[4,7],2);order=10000;new Game.Achievement('Fortune','Click <b>77 golden cookies</b>.<q>You should really go to bed.</q>',[10,1],1);order=31000;new Game.Achievement('True Neverclick','Make <b>1 million</b> cookies with <b>no</b> cookie clicks.<q>This kinda defeats the whole purpose, doesn\'t it?</q>',[12,0],3);order=20000;new Game.Achievement('Elder nap','Appease the grandmatriarchs at least <b>once</b>.<q>we<br>are<br>eternal</q>',[8,9],2);new Game.Achievement('Elder slumber','Appease the grandmatriarchs at least <b>5 times</b>.<q>our mind<br>outlives<br>the universe</q>',[8,9],2);order=1100;new Game.Achievement('Elder','Own at least <b>7</b> grandma types.',[10,9],2);order=20000;new Game.Achievement('Elder calm','Declare a covenant with the grandmatriarchs.<q>we<br>have<br>fed</q>',[8,9],2);order=5000;new Game.Achievement('Engineer','Own <b>800</b> buildings.',[6,6],1);order=10000;new Game.Achievement('Leprechaun','Click <b>777 golden cookies</b>.',[10,1],1);new Game.Achievement('Black cat\'s paw','Click <b>7777 golden cookies</b>.',[10,1],3);order=30000;new Game.Achievement('Nihilism','Reset your game with <b>1 quadrillion</b> cookies baked.<q>There are many things<br>that need to be erased</q>',[11,6],2);order=1900;new Game.Achievement('Antibatter','Have <b>1</b> antimatter condenser.',[13,0]);new Game.Achievement('Quirky quarks','Have <b>50</b> antimatter condensers.',[13,1]);new Game.Achievement('It does matter!','Have <b>100</b> antimatter condensers.',[13,2]);order=6000;new Game.Achievement('Upgrader','Purchase <b>100</b> upgrades.',[9,2],1);order=7000;new Game.Achievement('Centennial','Have at least <b>100 of everything</b>.',[9,6],2);order=30500;new Game.Achievement('Hardcore','Get to <b>1 billion</b> cookies baked with <b>no upgrades purchased</b>.',[12,6],3);order=30600;new Game.Achievement('Speed baking I','Get to <b>1 million</b> cookies baked in <b>35 minutes</b>.',[12,5],3);new Game.Achievement('Speed baking II','Get to <b>1 million</b> cookies baked in <b>25 minutes</b>.',[13,5],3);new Game.Achievement('Speed baking III','Get to <b>1 million</b> cookies baked in <b>15 minutes</b>.',[14,5],3);order=61000;new Game.Achievement('Getting even with the oven','Defeat the <b>Sentient Furnace</b> in the factory dungeons.',[12,7],2);new Game.Achievement('Now this is pod-smashing','Defeat the <b>Ascended Baking Pod</b> in the factory dungeons.',[12,7],2);new Game.Achievement('Chirped out','Find and defeat <b>Chirpy</b>, the dysfunctionning alarm bot.',[13,7],3);new Game.Achievement('Follow the white rabbit','Find and defeat the elusive <b>sugar bunny</b>.',[14,7],3);Game.RuinTheFun=function()
{for(var i in Game.Upgrades)
{Game.Upgrades[i].earn();}
for(var i in Game.Achievements)
{Game.Win(Game.Achievements[i].name);}
Game.Earn(999999999999999999);Game.upgradesToRebuild=1;Game.recalculateGains=1;}
Game.UpdateGrandmapocalypse=function()
{if(Game.Has('Elder Covenant')||Game.Objects['Grandma'].amount==0)Game.elderWrath=0;else if(Game.pledgeT>0)
{Game.pledgeT--;if(Game.pledgeT==0)
{Game.Lock('Elder Pledge');Game.Unlock('Elder Pledge');Game.elderWrath=1;}}
else
{if(Game.Has('One mind')&&Game.elderWrath==0)
{Game.elderWrath=1;}
if(Math.random()<0.001&&Game.elderWrath<Game.Has('One mind')+Game.Has('Communal brainsweep')+Game.Has('Elder Pact'))
{Game.elderWrath++;}
if(Game.Has('Elder Pact')&&Game.Upgrades['Elder Pledge'].unlocked==0)
{Game.Lock('Elder Pledge');Game.Unlock('Elder Pledge');}}
Game.elderWrathD+=((Game.elderWrath+1)-Game.elderWrathD)*0.001;}
Game.DrawGrandmapocalypse=function()
{Game.defaultBg='bgBlue';if(Math.abs((Game.elderWrath+1)-Game.elderWrathD)>0.1)
{if(Game.elderWrathD<1)
{Game.bgR=0;if(Game.bg!=Game.defaultBg||Game.bgFade!=Game.defaultBg)
{Game.bg=Game.defaultBg;Game.bgFade=Game.defaultBg;l('backgroundLayer1').style.background='url(img/'+Game.bg+'.jpg)';l('backgroundLayer2').style.background='url(img/'+Game.bgFade+'.jpg)';l('backgroundLayer1').style.backgroundSize='auto';l('backgroundLayer2').style.backgroundSize='auto';}}
else if(Game.elderWrathD>=1&&Game.elderWrathD<2)
{Game.bgR=(Game.elderWrathD-1)/1;if(Game.bg!=Game.defaultBg||Game.bgFade!='grandmas1')
{Game.bg=Game.defaultBg;Game.bgFade='grandmas1';l('backgroundLayer1').style.background='url(img/'+Game.bg+'.jpg)';l('backgroundLayer2').style.background='url(img/'+Game.bgFade+'.jpg)';l('backgroundLayer1').style.backgroundSize='auto';l('backgroundLayer2').style.backgroundSize='512px';}}
else if(Game.elderWrathD>=2&&Game.elderWrathD<3)
{Game.bgR=(Game.elderWrathD-2)/1;if(Game.bg!='grandmas1'||Game.bgFade!='grandmas2')
{Game.bg='grandmas1';Game.bgFade='grandmas2';l('backgroundLayer1').style.background='url(img/'+Game.bg+'.jpg)';l('backgroundLayer2').style.background='url(img/'+Game.bgFade+'.jpg)';l('backgroundLayer1').style.backgroundSize='512px';l('backgroundLayer2').style.backgroundSize='512px';}}
else if(Game.elderWrathD>=3&&Game.elderWrathD<4)
{Game.bgR=(Game.elderWrathD-3)/1;if(Game.bg!='grandmas2'||Game.bgFade!='grandmas3')
{Game.bg='grandmas2';Game.bgFade='grandmas3';l('backgroundLayer1').style.background='url(img/'+Game.bg+'.jpg)';l('backgroundLayer2').style.background='url(img/'+Game.bgFade+'.jpg)';l('backgroundLayer1').style.backgroundSize='512px';l('backgroundLayer2').style.backgroundSize='512px';}}
Game.bgRd+=(Game.bgR-Game.bgRd)*0.5;l('backgroundLayer2').style.opacity=Game.bgR;}};LaunchDungeons();Game.LoadSave();Game.ready=1;l('javascriptError').innerHTML='';l('javascriptError').style.display='none';Game.Loop();}
Game.Logic=function()
{for(var i in Game.Objects)
{if(Game.Objects[i].EachFrame)Game.Objects[i].EachFrame();}
Game.UpdateGrandmapocalypse();Game.milkProgress=Game.AchievementsOwned/25;if(Game.milkProgress>=0.5)Game.Unlock('Kitten helpers');if(Game.milkProgress>=1)Game.Unlock('Kitten workers');if(Game.milkProgress>=2)Game.Unlock('Kitten engineers');if(Game.milkProgress>=3)Game.Unlock('Kitten overseers');Game.milkH=Math.min(1,Game.milkProgress)*0.35;Game.milkHd+=(Game.milkH-Game.milkHd)*0.02;if(Game.autoclickerDetected>0)Game.autoclickerDetected--;if(Game.researchT>0)
{Game.researchT--;}
if(Game.researchT==0&&Game.nextResearch)
{Game.Unlock(Game.UpgradesById[Game.nextResearch].name);Game.Popup('Researched : '+Game.UpgradesById[Game.nextResearch].name);Game.nextResearch=0;Game.researchT=-1;}
if(Game.recalculateGains)Game.CalculateGains();;Game.Earn(Game.cookiesPs/Game.fps);for(var i in Game.Objects)
{var me=Game.Objects[i];me.totalCookies+=me.storedTotalCps/Game.fps;}
if(Game.cookies&&Game.T%Math.ceil(Game.fps/Math.min(10,Game.cookiesPs))==0&&Game.prefs.numbers)Game.cookieParticleAdd();if(Game.frenzy>0)
{Game.frenzy--;if(Game.frenzy<1)Game.recalculateGains=1;}
if(Game.clickFrenzy>0)
{Game.clickFrenzy--;if(Game.clickFrenzy<1)Game.recalculateGains=1;}
if(Game.T%(Game.fps*5)==0&&Game.ObjectsById.length>0)
{if(Game.Objects['Factory'].amount>=50&&Game.Objects['Factory'].specialUnlocked==0){Game.Objects['Factory'].unlockSpecial();Game.Popup('You have unlocked the factory dungeons!');}
if(isNaN(Game.cookies)){Game.cookies=0;Game.cookiesEarned=0;Game.recalculateGains=1;}
var timePlayed=new Date();timePlayed.setTime(new Date().getTime()-Game.startDate);if(timePlayed<=1000*60*35&&Game.cookiesEarned>=1000000)Game.Win('Speed baking I');if(timePlayed<=1000*60*25&&Game.cookiesEarned>=1000000)Game.Win('Speed baking II');if(timePlayed<=1000*60*15&&Game.cookiesEarned>=1000000)Game.Win('Speed baking III');if(Game.cookiesEarned>=9999999)Game.Unlock(['Oatmeal raisin cookies','Peanut butter cookies','Plain cookies','Sugar cookies']);if(Game.cookiesEarned>=99999999)Game.Unlock(['Coconut cookies','White chocolate cookies','Macadamia nut cookies']);if(Game.cookiesEarned>=999999999)Game.Unlock(['Double-chip cookies','White chocolate macadamia nut cookies','All-chocolate cookies']);if(Game.cookiesEarned>=9999999999)Game.Unlock(['Dark chocolate-coated cookies','White chocolate-coated cookies']);if(Game.cookiesEarned>=99999999999)Game.Unlock(['Eclipse cookies','Zebra cookies']);if(Game.cookiesEarned>=999999999999)Game.Unlock(['Snickerdoodles','Stroopwafels','Macaroons']);if(Game.cookiesEarned>=999999999999&&Game.Has('Snickerdoodles')&&Game.Has('Stroopwafels')&&Game.Has('Macaroons'))
{Game.Unlock('Empire biscuits');if(Game.Has('Empire biscuits'))Game.Unlock('British tea biscuits');if(Game.Has('British tea biscuits'))Game.Unlock('Chocolate british tea biscuits');if(Game.Has('Chocolate british tea biscuits'))Game.Unlock('Round british tea biscuits');if(Game.Has('Round british tea biscuits'))Game.Unlock('Round chocolate british tea biscuits');if(Game.Has('Round chocolate british tea biscuits'))Game.Unlock('Round british tea biscuits with heart motif');if(Game.Has('Round british tea biscuits with heart motif'))Game.Unlock('Round chocolate british tea biscuits with heart motif');}
if(Game.cookiesEarned>=9999999999999)Game.Unlock(['Madeleines','Palmiers','Palets','Sablés']);for(var i=0;i<Game.moneyAchievs.length/2;i++)
{if(Game.cookiesEarned>=Game.moneyAchievs[i*2+1])Game.Win(Game.moneyAchievs[i*2]);}
var buildingsOwned=0;var oneOfEach=1;var mathematician=1;var base10=1;var centennial=1;for(var i in Game.Objects)
{buildingsOwned+=Game.Objects[i].amount;if(!Game.HasAchiev('One with everything')){if(Game.Objects[i].amount==0)oneOfEach=0;}
if(!Game.HasAchiev('Mathematician')){if(Game.Objects[i].amount<Math.min(128,Math.pow(2,(Game.ObjectsById.length-Game.Objects[i].id)-1)))mathematician=0;}
if(!Game.HasAchiev('Base 10')){if(Game.Objects[i].amount<(Game.ObjectsById.length-Game.Objects[i].id)*10)base10=0;}
if(!Game.HasAchiev('Centennial')){if(Game.Objects[i].amount<100)centennial=0;}}
if(oneOfEach==1)Game.Win('One with everything');if(mathematician==1)Game.Win('Mathematician');if(base10==1)Game.Win('Base 10');if(centennial==1)Game.Win('Centennial');if(Game.cookiesEarned>=1000000&&Game.cookieClicks<=15)Game.Win('Neverclick');if(Game.cookiesEarned>=1000000&&Game.cookieClicks<=0)Game.Win('True Neverclick');if(Game.handmadeCookies>=1000){Game.Win('Clicktastic');Game.Unlock('Plastic mouse');}
if(Game.handmadeCookies>=100000){Game.Win('Clickathlon');Game.Unlock('Iron mouse');}
if(Game.handmadeCookies>=10000000){Game.Win('Clickolympics');Game.Unlock('Titanium mouse');}
if(Game.handmadeCookies>=1000000000){Game.Win('Clickorama');Game.Unlock('Adamantium mouse');}
if(Game.cookiesEarned<Game.cookies)Game.Win('Cheated cookies taste awful');if(buildingsOwned>=100)Game.Win('Builder');if(buildingsOwned>=400)Game.Win('Architect');if(buildingsOwned>=800)Game.Win('Engineer');if(Game.UpgradesOwned>=20)Game.Win('Enhancer');if(Game.UpgradesOwned>=50)Game.Win('Augmenter');if(Game.UpgradesOwned>=100)Game.Win('Upgrader');if(Game.UpgradesOwned==0&&Game.cookiesEarned>=1000000000)Game.Win('Hardcore');var grandmas=0;if(Game.Has('Farmer grandmas'))grandmas++;if(Game.Has('Worker grandmas'))grandmas++;if(Game.Has('Miner grandmas'))grandmas++;if(Game.Has('Cosmic grandmas'))grandmas++;if(Game.Has('Transmuted grandmas'))grandmas++;if(Game.Has('Altered grandmas'))grandmas++;if(Game.Has('Grandmas\' grandmas'))grandmas++;if(Game.Has('Antigrandmas'))grandmas++;if(!Game.HasAchiev('Elder')&&grandmas>=7)Game.Win('Elder');if(Game.Objects['Grandma'].amount>=6&&!Game.Has('Bingo center/Research facility')&&Game.HasAchiev('Elder'))Game.Unlock('Bingo center/Research facility');if(Game.pledges>0)Game.Win('Elder nap');if(Game.pledges>=5)Game.Win('Elder slumber');if(Game.pledges>=10)Game.Unlock('Sacrificial rolling pins');if(!Game.HasAchiev('Cookie-dunker')&&l('bigCookie').getBoundingClientRect().bottom>l('milk').getBoundingClientRect().top+16&&Game.milkProgress>0.1)Game.Win('Cookie-dunker');}
Game.cookiesd+=(Game.cookies-Game.cookiesd)*0.3;if(Game.storeToRebuild)Game.RebuildStore();if(Game.upgradesToRebuild)Game.RebuildUpgrades();if(Game.T%(Game.fps)==0)document.title=Beautify(Game.cookies)+' '+(Game.cookies==1?'cookie':'cookies')+' - Cookie Clicker';Game.TickerAge--;if(Game.TickerAge<=0||Game.Ticker=='')Game.getNewTicker();var veilLimit=0;if(Game.veil==1&&Game.cookiesEarned>=veilLimit)Game.veilOff();else if(Game.veil==0&&Game.cookiesEarned<veilLimit)Game.veilOn();Game.goldenCookie.update();if(Game.T%(Game.fps*60)==0&&Game.T>Game.fps*10&&Game.prefs.autosave)Game.WriteSave();if(Game.T%(Game.fps*60*30)==0&&Game.T>Game.fps*10&&Game.prefs.autoupdate)Game.CheckUpdates();Game.T++;}
Game.MilkPics={0:'milkWave',1:'chocolateMilkWave',2:'raspberryWave'};Game.Draw=function()
{if(Math.floor(Game.T%Game.fps/4)==0)Game.DrawGrandmapocalypse();if(Game.prefs.milk)
{var x=Math.floor((Game.T*2+Math.sin(Game.T*0.1)*2+Math.sin(Game.T*0.03)*2-(Game.milkH-Game.milkHd)*2000)%480);var y=0;var m1=l('milkLayer1');var m2=l('milkLayer2');m1.style.backgroundPosition=x+'px '+y+'px';m2.style.backgroundPosition=x+'px '+y+'px';l('milk').style.height=(Game.milkHd*100)+'%';var m1o=1;var m2o=0;var m1i=0;var m2i=0;if(Game.milkProgress<1){m1o=1;m1i=0;m2i=1;}
else if(Game.milkProgress<2){m1o=1-(Game.milkProgress-1);m1i=0;m2i=1;}
else if(Game.milkProgress<3){m1o=1-(Game.milkProgress-2);m1i=1;m2i=2;}
else{m1o=1;m1i=2;m2i=2;}
m2o=1-m1o;m1i=Game.MilkPics[m1i];m2i=Game.MilkPics[m2i];if(m1.style.backgroundImage!='url("img/'+m1i+'.png")')m1.style.backgroundImage='url("img/'+m1i+'.png")';if(m2.style.backgroundImage!='url("img/'+m2i+'.png")')m2.style.backgroundImage='url("img/'+m2i+'.png")';m1.style.opacity=m1o;m2.style.opacity=m2o;}
if(Game.prefs.particles)
{var r=Math.floor((Game.T*0.5)%360);var me=l('cookieShine');me.style.transform='rotate('+r+'deg)';me.style.mozTransform='rotate('+r+'deg)';me.style.webkitTransform='rotate('+r+'deg)';me.style.msTransform='rotate('+r+'deg)';me.style.oTransform='rotate('+r+'deg)';var r=((-Game.T*0.05)%360);var me=l('cookieCursors');me.style.transform='rotate('+r+'deg)';me.style.mozTransform='rotate('+r+'deg)';me.style.webkitTransform='rotate('+r+'deg)';me.style.msTransform='rotate('+r+'deg)';me.style.oTransform='rotate('+r+'deg)';}
if(Game.prefs.particles)
{var amount=Game.Objects['Cursor'].amount;for(var i=0;i<amount;i++)
{var me=l('cursor'+i);var n=Math.floor(i/50);var a=((i+0.5*n)%50)/50;var w=0;w=(Math.sin(Game.T*0.025+(((i+n*12)%25)/25)*Math.PI*2));if(w>0.997)w=1.5;else if(w>0.994)w=0.5;else w=0;w*=-4;var x=(Math.sin(a*Math.PI*2)*(140+n*16+w))-16;var y=(Math.cos(a*Math.PI*2)*(140+n*16+w))-16;var r=Math.floor(-(a)*360);me.style.left=x+'px';me.style.top=y+'px';}}
if(Game.prefs.particles)
{if(Game.elderWrathD<=1.5)
{if(Game.cookiesPs>=1000)l('cookieShower').style.backgroundImage='url(img/cookieShower3.png)';else if(Game.cookiesPs>=500)l('cookieShower').style.backgroundImage='url(img/cookieShower2.png)';else if(Game.cookiesPs>=50)l('cookieShower').style.backgroundImage='url(img/cookieShower1.png)';else l('cookieShower').style.backgroundImage='none';l('cookieShower').style.backgroundPosition='0px '+(Math.floor(Game.T*2)%512)+'px';}
if(Game.elderWrathD>=1&&Game.elderWrathD<1.5)l('cookieShower').style.opacity=1-((Game.elderWrathD-1)/0.5);}
var unit=(Math.round(Game.cookiesd)==1?' cookie':' cookies');if(Math.round(Game.cookiesd).toString().length>11)unit='<br>cookies';l('cookies').innerHTML=Beautify(Math.round(Game.cookiesd))+unit+'<div style="font-size:50%;">per second : '+Beautify(Game.cookiesPs,1)+'</div>';Game.TickerDraw();for(var i in Game.Objects)
{var me=Game.Objects[i];if(Game.cookies>=me.price)l('product'+me.id).className='product enabled';else l('product'+me.id).className='product disabled';if(l('rowInfo'+me.id)&&Game.T%5==0)l('rowInfoContent'+me.id).innerHTML='• '+me.amount+' '+(me.amount==1?me.single:me.plural)+'<br>• producing '+Beautify(me.storedTotalCps,1)+' '+(me.storedTotalCps==1?'cookie':'cookies')+' per second<br>• total : '+Beautify(me.totalCookies)+' '+(Math.floor(me.totalCookies)==1?'cookie':'cookies')+' '+me.actionName;}
for(var i in Game.UpgradesInStore)
{var me=Game.UpgradesInStore[i];if(Game.cookies>=me.basePrice)l('upgrade'+i).className='crate upgrade enabled';else l('upgrade'+i).className='crate upgrade disabled';}
if(Math.floor(Game.T%Game.fps/2)==0)Game.UpdateMenu();Game.cookieParticlesUpdate();Game.cookieNumbersUpdate();Game.particlesUpdate();}
Game.Loop=function()
{Game.catchupLogic=0;Game.Logic();Game.catchupLogic=1;Game.accumulatedDelay+=((new Date().getTime()-Game.time)-1000/Game.fps);Game.accumulatedDelay=Math.min(Game.accumulatedDelay,1000*5);Game.time=new Date().getTime();while(Game.accumulatedDelay>0)
{Game.Logic();Game.accumulatedDelay-=1000/Game.fps;}
Game.catchupLogic=0;Game.Draw();setTimeout(Game.Loop,1000/Game.fps);}}
Game.Launch();window.onload=function()
{if(!Game.ready)Game.Init();};
</script>
</head>
<body>

<div id="topBar">
	<div>
		<b>Cookie Clicker</b> &copy; <a href="http://orteil.dashnet.org" target="_blank">Orteil</a>, 2023 - hosted by <a href="http://dashnet.org" target="_blank">DashNet</a> | <a href="http://twitter.com/orteil42" target="_blank">twitter</a> | <a href="http://orteil42.tumblr.com" target="_blank">tumblr</a> | Help? Bugs? Ideas? Check out the <a href="http://forum.dashnet.org" target="_blank">forum</a>! | Chat with us on <a href="http://forum.dashnet.org/discussion/277/irc-chat-channel/p1" target="_blank">IRC</a> | Getting a black screen? Try pressing ctrl-F5!
		<div id="links" style="display:block;position:absolute;right:8px;top:4px;"></div>
	</div>
</div>

<div id="game">
	<div id="javascriptError">
		<div style="padding:64px 128px;">
			<div class="title">Oops, looks like the game isn't loading right!</div>
			<div>Please make sure your javascript is enabled, then refresh.<br>
			This could also be caused by a problem on our side, in which case - wait a moment, then refresh!</div>
		</div>
	</div>

	<div id="backgroundLayers">
		<div id="backgroundLayer1"></div>
		<div id="backgroundLayer2"></div>
	</div>
	
	<div id="goldenCookie" class="goldenCookie"></div>
	<div id="alert"></div>
	<div id="particles"></div>
	<div id="versionNumber" class="title"></div>
	
	<div id="sectionLeft" class="inset">
		<div id="cookieShower"></div>
		<div class="blackGradient"></div>
		<div class="blackFiller"></div>
		<div id="sectionLeftInfo"></div>
		<div id="cookies" class="title"></div>
		<div id="cookieAnchor">
			<div id="cookieShine"></div>
			<div id="cookieCursors"></div>
			<div id="bigCookie"></div>
			<div id="cookieNumbers"></div>
		</div>
		<div id="milk">
			<div id="milkLayer1" class="milkLayer"></div>
			<div id="milkLayer2" class="milkLayer"></div>
		</div>
	</div>

	<div class="separatorLeft"></div>
	<div class="separatorRight"></div>
		
	<div id="sectionMiddle" class="inset">
		<div id="comments" class="inset title">
			<div id="prefsButton" class="button">Menu</div>
			<div id="statsButton" class="button">Stats</div>
			<div id="logButton" class="button" style="font-size:80%;">Updates</div>
			<div id="commentsText"></div>
			<div class="separatorBottom"></div>
		</div>
		<div id="rows"></div>
		<div id="menu"></div>
		<div id="donateBox">
			<form target="_blank" action="https://www.paypal.com/cgi-bin/webscr" method="post" id="donate" style="margin:0px 16px;">
			<input type="hidden" name="cmd" value="_s-xclick">
			<input type="hidden" name="hosted_button_id" value="BBN2WL3TC6QH4">
			<input type="image" src="https://www.paypalobjects.com/en_GB/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="PayPal — The safer, easier way to pay online.">
			<img alt="" border="0" src="https://www.paypalobjects.com/nl_NL/i/scr/pixel.gif" width="1" height="1">
			</form>
			Help us keep developing the game!
		</div>
	</div>

	<div id="sectionRight" class="inset">
		<div id="store">
			<div id="storeTitle" class="inset title">Store</div>
			<div id="upgrades">
			</div>
			<div id="products">
			</div>
		</div>
		
		<div id="support" style="margin-top:130px;">
			<!--<div id="supportComment">Sponsored links</div>
			<script async src="//wwwwjs"></script>-->
			<!-- Cookie Clicker Rectangle -->
			<!--<ins class="adsbygoogle"
				 style="display:inline-block;width:300px;height:250px"
				 data-ad-client="ca-pub-8491708950677704"
				 data-ad-slot="9349826096"></ins>
			<script>
			(adsbygoogle = window.adsbygoogle || []).push({});
			</script>-->
			<!-- Example.com Worlds banner -->
			<!--<a class="ad" id="aqad" href="http://www.example.com/landing/cookie/?utm_campaign=AQW_CookieClicker&utm_source=CookieClicker" target="_blank" title="AdventureQuest Worlds" style="background:url(img/aqworldsbanner.jpg) no-repeat;width:300px;height:64px;display:block;position:relative;left:-10px;margin:16px 0px;">
			</a>-->
		</div>
	</div>
	
	<div id="tooltipAnchor"><div id="tooltip" onMouseOut="Game.tooltip.hide();"></div></div>

</div>
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
</body>
</html>
